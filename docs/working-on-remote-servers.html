<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Working on remote servers | Practical Computing and Bioinformatics for Conservation and Evolutionary Genomics</title>
  <meta name="description" content="A book example for a Chapman &amp; Hall book." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Working on remote servers | Practical Computing and Bioinformatics for Conservation and Evolutionary Genomics" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A book example for a Chapman &amp; Hall book." />
  <meta name="github-repo" content="yihui/bookdown-crc" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Working on remote servers | Practical Computing and Bioinformatics for Conservation and Evolutionary Genomics" />
  
  <meta name="twitter:description" content="A book example for a Chapman &amp; Hall book." />
  

<meta name="author" content="Eric C. Anderson" />


<meta name="date" content="2021-04-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="sed-awk-and-regular-expressions.html"/>
<link rel="next" href="high-performance-computing-clusters-hpccs.html"/>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">ECA's Bioinformatics Handbook</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="erics-notes-of-what-he-might-do.html"><a href="erics-notes-of-what-he-might-do.html"><i class="fa fa-check"></i><b>2</b> Eric’s Notes of what he might do</a><ul>
<li class="chapter" data-level="2.1" data-path="erics-notes-of-what-he-might-do.html"><a href="erics-notes-of-what-he-might-do.html#table-of-topics"><i class="fa fa-check"></i><b>2.1</b> Table of topics</a></li>
</ul></li>
<li class="part"><span><b>I Part I: Essential Computing Skills</b></span></li>
<li class="chapter" data-level="3" data-path="overview-of-essential-computing-skills.html"><a href="overview-of-essential-computing-skills.html"><i class="fa fa-check"></i><b>3</b> Overview of Essential Computing Skills</a></li>
<li class="chapter" data-level="4" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html"><i class="fa fa-check"></i><b>4</b> Essential Unix/Linux Terminal Knowledge</a><ul>
<li class="chapter" data-level="4.1" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#getting-a-bash-shell-on-your-system"><i class="fa fa-check"></i><b>4.1</b> Getting a bash shell on your system</a></li>
<li class="chapter" data-level="4.2" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#navigating-the-unix-filesystem"><i class="fa fa-check"></i><b>4.2</b> Navigating the Unix filesystem</a><ul>
<li class="chapter" data-level="4.2.1" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#changing-the-working-directory-with-cd"><i class="fa fa-check"></i><b>4.2.1</b> Changing the working directory with <code>cd</code></a></li>
<li class="chapter" data-level="4.2.2" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#comm-prompt"><i class="fa fa-check"></i><b>4.2.2</b> Updating your command prompt</a></li>
<li class="chapter" data-level="4.2.3" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#tab-completion-for-paths"><i class="fa fa-check"></i><b>4.2.3</b> TAB-completion for paths</a></li>
<li class="chapter" data-level="4.2.4" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#listing-the-contents-of-a-directory-with-ls"><i class="fa fa-check"></i><b>4.2.4</b> Listing the contents of a directory with <code>ls</code></a></li>
<li class="chapter" data-level="4.2.5" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#globbing"><i class="fa fa-check"></i><b>4.2.5</b> Globbing</a></li>
<li class="chapter" data-level="4.2.6" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#what-makes-a-good-file-name"><i class="fa fa-check"></i><b>4.2.6</b> What makes a good file-name?</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#the-anatomy-of-a-unix-command"><i class="fa fa-check"></i><b>4.3</b> The anatomy of a Unix command</a><ul>
<li class="chapter" data-level="4.3.1" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#anatomy-command"><i class="fa fa-check"></i><b>4.3.1</b> The <code>command</code></a></li>
<li class="chapter" data-level="4.3.2" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#the-options"><i class="fa fa-check"></i><b>4.3.2</b> The <em>options</em></a></li>
<li class="chapter" data-level="4.3.3" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#arguments"><i class="fa fa-check"></i><b>4.3.3</b> Arguments</a></li>
<li class="chapter" data-level="4.3.4" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#getting-information-about-unix-commands"><i class="fa fa-check"></i><b>4.3.4</b> Getting information about Unix commands</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#handling-manipulating-and-viewing-files-and-streams"><i class="fa fa-check"></i><b>4.4</b> Handling, Manipulating, and Viewing files and streams</a><ul>
<li class="chapter" data-level="4.4.1" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#creating-new-directories"><i class="fa fa-check"></i><b>4.4.1</b> Creating new directories</a></li>
<li class="chapter" data-level="4.4.2" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#fundamental-file-handling-commands"><i class="fa fa-check"></i><b>4.4.2</b> Fundamental file-handling commands</a></li>
<li class="chapter" data-level="4.4.3" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#viewing-files"><i class="fa fa-check"></i><b>4.4.3</b> “Viewing” Files</a></li>
<li class="chapter" data-level="4.4.4" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#redirecting-standard-output-and"><i class="fa fa-check"></i><b>4.4.4</b> Redirecting standard output: <code>&gt;</code> and <code>&gt;&gt;</code></a></li>
<li class="chapter" data-level="4.4.5" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#stdin-and"><i class="fa fa-check"></i><b>4.4.5</b> stdin, <code>&lt;</code> and <code>|</code></a></li>
<li class="chapter" data-level="4.4.6" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#stderr"><i class="fa fa-check"></i><b>4.4.6</b> stderr</a></li>
<li class="chapter" data-level="4.4.7" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#symbolic-links"><i class="fa fa-check"></i><b>4.4.7</b> Symbolic links</a></li>
<li class="chapter" data-level="4.4.8" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#file-permissions"><i class="fa fa-check"></i><b>4.4.8</b> File Permissions</a></li>
<li class="chapter" data-level="4.4.9" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#editing-text-files-at-the-terminal"><i class="fa fa-check"></i><b>4.4.9</b> Editing text files at the terminal</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#unix-env"><i class="fa fa-check"></i><b>4.5</b> Customizing your Environment</a><ul>
<li class="chapter" data-level="4.5.1" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#appearances-matter"><i class="fa fa-check"></i><b>4.5.1</b> Appearances matter</a></li>
<li class="chapter" data-level="4.5.2" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#where-are-my-programscommands-at"><i class="fa fa-check"></i><b>4.5.2</b> Where are my programs/commands at?!</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#a-few-more-important-keystrokes"><i class="fa fa-check"></i><b>4.6</b> A Few More Important Keystrokes</a></li>
<li class="chapter" data-level="4.7" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#a-short-list-of-additional-useful-commands."><i class="fa fa-check"></i><b>4.7</b> A short list of additional useful commands.</a></li>
<li class="chapter" data-level="4.8" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#two-important-computing-concepts"><i class="fa fa-check"></i><b>4.8</b> Two important computing concepts</a><ul>
<li class="chapter" data-level="4.8.1" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#compression"><i class="fa fa-check"></i><b>4.8.1</b> Compression</a></li>
<li class="chapter" data-level="4.8.2" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#hashing"><i class="fa fa-check"></i><b>4.8.2</b> Hashing</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#unix-quick-study-guide"><i class="fa fa-check"></i><b>4.9</b> Unix: Quick Study Guide</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="shell-programming.html"><a href="shell-programming.html"><i class="fa fa-check"></i><b>5</b> Shell programming</a><ul>
<li class="chapter" data-level="5.1" data-path="shell-programming.html"><a href="shell-programming.html#an-example-script"><i class="fa fa-check"></i><b>5.1</b> An example script</a></li>
<li class="chapter" data-level="5.2" data-path="shell-programming.html"><a href="shell-programming.html#the-structure-of-a-bash-script"><i class="fa fa-check"></i><b>5.2</b> The Structure of a Bash Script</a><ul>
<li class="chapter" data-level="5.2.1" data-path="shell-programming.html"><a href="shell-programming.html#paragraph-before-shebang"><i class="fa fa-check"></i><b>5.2.1</b> A bit more on <code>;</code> and <code>&amp;</code></a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="shell-programming.html"><a href="shell-programming.html#variables"><i class="fa fa-check"></i><b>5.3</b> Variables</a><ul>
<li class="chapter" data-level="5.3.1" data-path="shell-programming.html"><a href="shell-programming.html#assigning-values-to-variables"><i class="fa fa-check"></i><b>5.3.1</b> Assigning values to variables</a></li>
<li class="chapter" data-level="5.3.2" data-path="shell-programming.html"><a href="shell-programming.html#accessing-values-from-variables"><i class="fa fa-check"></i><b>5.3.2</b> Accessing values from variables</a></li>
<li class="chapter" data-level="5.3.3" data-path="shell-programming.html"><a href="shell-programming.html#what-does-the-shell-do-with-the-value-substituted-for-a-variable"><i class="fa fa-check"></i><b>5.3.3</b> What does the shell do with the value substituted for a variable?</a></li>
<li class="chapter" data-level="5.3.4" data-path="shell-programming.html"><a href="shell-programming.html#quotes-and-var-subs"><i class="fa fa-check"></i><b>5.3.4</b> Double and Single Quotation Marks and Variable Substitution</a></li>
<li class="chapter" data-level="5.3.5" data-path="shell-programming.html"><a href="shell-programming.html#one-useful-fancy-variable-substitution-method"><i class="fa fa-check"></i><b>5.3.5</b> One useful, fancy, variable-substitution method</a></li>
<li class="chapter" data-level="5.3.6" data-path="shell-programming.html"><a href="shell-programming.html#bash-arithmetic"><i class="fa fa-check"></i><b>5.3.6</b> Integer Arithmetic with Shell Variables</a></li>
<li class="chapter" data-level="5.3.7" data-path="shell-programming.html"><a href="shell-programming.html#variable-arrays"><i class="fa fa-check"></i><b>5.3.7</b> Variable arrays</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="shell-programming.html"><a href="shell-programming.html#evaluate-a-command-and-substitute-the-result-on-the-command-line"><i class="fa fa-check"></i><b>5.4</b> Evaluate a command and substitute the result on the command line</a></li>
<li class="chapter" data-level="5.5" data-path="shell-programming.html"><a href="shell-programming.html#groupingcollecting-output-from-multiple-commands-commands-and-commands"><i class="fa fa-check"></i><b>5.5</b> Grouping/Collecting output from multiple commands: <code>(commands)</code> and <code>{ commands; }</code></a></li>
<li class="chapter" data-level="5.6" data-path="shell-programming.html"><a href="shell-programming.html#exit-status"><i class="fa fa-check"></i><b>5.6</b> Exit Status</a><ul>
<li class="chapter" data-level="5.6.1" data-path="shell-programming.html"><a href="shell-programming.html#combinations-of-exit-statuses"><i class="fa fa-check"></i><b>5.6.1</b> Combinations of exit statuses</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="shell-programming.html"><a href="shell-programming.html#unix-for-loops"><i class="fa fa-check"></i><b>5.7</b> Loops and repetition</a></li>
<li class="chapter" data-level="5.8" data-path="shell-programming.html"><a href="shell-programming.html#more-conditional-evaluation-if-then-else-and-friends"><i class="fa fa-check"></i><b>5.8</b> More Conditional Evaluation: <code>if</code>, <code>then</code>, <code>else</code>, and friends</a></li>
<li class="chapter" data-level="5.9" data-path="shell-programming.html"><a href="shell-programming.html#finallypositional-parameters"><i class="fa fa-check"></i><b>5.9</b> Finally…positional parameters</a></li>
<li class="chapter" data-level="5.10" data-path="shell-programming.html"><a href="shell-programming.html#basename-and-dirname-two-useful-little-utilities"><i class="fa fa-check"></i><b>5.10</b> <code>basename</code> and <code>dirname</code> two useful little utilities</a></li>
<li class="chapter" data-level="5.11" data-path="shell-programming.html"><a href="shell-programming.html#bash-functions"><i class="fa fa-check"></i><b>5.11</b> <code>bash</code> functions</a></li>
<li class="chapter" data-level="5.12" data-path="shell-programming.html"><a href="shell-programming.html#reading-files-line-by-line"><i class="fa fa-check"></i><b>5.12</b> reading files line by line</a></li>
<li class="chapter" data-level="5.13" data-path="shell-programming.html"><a href="shell-programming.html#further-reading"><i class="fa fa-check"></i><b>5.13</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="sed-awk-and-regular-expressions.html"><a href="sed-awk-and-regular-expressions.html"><i class="fa fa-check"></i><b>6</b> Sed, awk, and regular expressions</a><ul>
<li class="chapter" data-level="6.1" data-path="sed-awk-and-regular-expressions.html"><a href="sed-awk-and-regular-expressions.html#awk"><i class="fa fa-check"></i><b>6.1</b> awk</a><ul>
<li class="chapter" data-level="6.1.1" data-path="sed-awk-and-regular-expressions.html"><a href="sed-awk-and-regular-expressions.html#line-cycling-tests-and-actions"><i class="fa fa-check"></i><b>6.1.1</b> Line-cycling, tests and actions</a></li>
<li class="chapter" data-level="6.1.2" data-path="sed-awk-and-regular-expressions.html"><a href="sed-awk-and-regular-expressions.html#column-splitting-fields--f-nf-print-ofs-and-begin"><i class="fa fa-check"></i><b>6.1.2</b> Column splitting, fields, <code>-F</code>, <code>$</code>, <code>NF</code>, <code>print</code>, <code>OFS</code> and <code>BEGIN</code></a></li>
<li class="chapter" data-level="6.1.3" data-path="sed-awk-and-regular-expressions.html"><a href="sed-awk-and-regular-expressions.html#a-brief-introduction-to-regular-expressions"><i class="fa fa-check"></i><b>6.1.3</b> A brief introduction to regular expressions</a></li>
<li class="chapter" data-level="6.1.4" data-path="sed-awk-and-regular-expressions.html"><a href="sed-awk-and-regular-expressions.html#a-variety-of-tests"><i class="fa fa-check"></i><b>6.1.4</b> A variety of tests</a></li>
<li class="chapter" data-level="6.1.5" data-path="sed-awk-and-regular-expressions.html"><a href="sed-awk-and-regular-expressions.html#code-in-the-action-blocks"><i class="fa fa-check"></i><b>6.1.5</b> Code in the action blocks</a></li>
<li class="chapter" data-level="6.1.6" data-path="sed-awk-and-regular-expressions.html"><a href="sed-awk-and-regular-expressions.html#using-awk-to-assign-to-shell-variables"><i class="fa fa-check"></i><b>6.1.6</b> Using <code>awk</code> to assign to shell variables</a></li>
<li class="chapter" data-level="6.1.7" data-path="sed-awk-and-regular-expressions.html"><a href="sed-awk-and-regular-expressions.html#passing-variables-into-awk-with--v"><i class="fa fa-check"></i><b>6.1.7</b> Passing Variables into <code>awk</code> with <code>-v</code></a></li>
<li class="chapter" data-level="6.1.8" data-path="sed-awk-and-regular-expressions.html"><a href="sed-awk-and-regular-expressions.html#writing-awk-scripts-in-files"><i class="fa fa-check"></i><b>6.1.8</b> Writing awk scripts in files</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="sed-awk-and-regular-expressions.html"><a href="sed-awk-and-regular-expressions.html#sed"><i class="fa fa-check"></i><b>6.2</b> sed</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html"><i class="fa fa-check"></i><b>7</b> Working on remote servers</a><ul>
<li class="chapter" data-level="7.1" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#accessing-remote-computers"><i class="fa fa-check"></i><b>7.1</b> Accessing remote computers</a><ul>
<li class="chapter" data-level="7.1.1" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#windows"><i class="fa fa-check"></i><b>7.1.1</b> Windows</a></li>
<li class="chapter" data-level="7.1.2" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#hummingbird"><i class="fa fa-check"></i><b>7.1.2</b> Hummingbird</a></li>
<li class="chapter" data-level="7.1.3" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#summit"><i class="fa fa-check"></i><b>7.1.3</b> Summit</a></li>
<li class="chapter" data-level="7.1.4" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#sedna"><i class="fa fa-check"></i><b>7.1.4</b> Sedna</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#transferring-files-to-remote-computers"><i class="fa fa-check"></i><b>7.2</b> Transferring files to remote computers</a><ul>
<li class="chapter" data-level="7.2.1" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#sftp-via-lftp"><i class="fa fa-check"></i><b>7.2.1</b> <code>sftp</code> (via <code>lftp</code>)</a></li>
<li class="chapter" data-level="7.2.2" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#git"><i class="fa fa-check"></i><b>7.2.2</b> git</a></li>
<li class="chapter" data-level="7.2.3" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#globus"><i class="fa fa-check"></i><b>7.2.3</b> Globus</a></li>
<li class="chapter" data-level="7.2.4" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#interfacing-with-the-cloud"><i class="fa fa-check"></i><b>7.2.4</b> Interfacing with “The Cloud”</a></li>
<li class="chapter" data-level="7.2.5" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#get-seqs"><i class="fa fa-check"></i><b>7.2.5</b> Getting files from a sequencing center</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#tmux"><i class="fa fa-check"></i><b>7.3</b> <code>tmux</code>: the terminal multiplexer</a><ul>
<li class="chapter" data-level="7.3.1" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#an-analogy-for-how-tmux-works"><i class="fa fa-check"></i><b>7.3.1</b> An analogy for how <code>tmux</code> works</a></li>
<li class="chapter" data-level="7.3.2" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#first-steps-with-tmux"><i class="fa fa-check"></i><b>7.3.2</b> First steps with <code>tmux</code></a></li>
<li class="chapter" data-level="7.3.3" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#further-steps-with-tmux"><i class="fa fa-check"></i><b>7.3.3</b> Further steps with <code>tmux</code></a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#tmux-for-mac-users"><i class="fa fa-check"></i><b>7.4</b> <code>tmux</code> for Mac users</a></li>
<li class="chapter" data-level="7.5" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#installing-software-on-an-hpcc"><i class="fa fa-check"></i><b>7.5</b> Installing Software on an HPCC</a><ul>
<li class="chapter" data-level="7.5.1" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#modules"><i class="fa fa-check"></i><b>7.5.1</b> Modules</a></li>
<li class="chapter" data-level="7.5.2" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#miniconda"><i class="fa fa-check"></i><b>7.5.2</b> Miniconda</a></li>
<li class="chapter" data-level="7.5.3" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#installing-java-programs"><i class="fa fa-check"></i><b>7.5.3</b> Installing Java Programs</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#vim-its-time-to-get-serious-with-text-editing"><i class="fa fa-check"></i><b>7.6</b> <code>vim</code>: it’s time to get serious with text editing</a><ul>
<li class="chapter" data-level="7.6.1" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#using-neovim-and-nvim-r-and-tmux-to-use-r-well-on-the-cluster"><i class="fa fa-check"></i><b>7.6.1</b> Using neovim and Nvim-R and tmux to use R well on the cluster</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="high-performance-computing-clusters-hpccs.html"><a href="high-performance-computing-clusters-hpccs.html"><i class="fa fa-check"></i><b>8</b> High Performance Computing Clusters (HPCC’s)</a><ul>
<li class="chapter" data-level="8.1" data-path="high-performance-computing-clusters-hpccs.html"><a href="high-performance-computing-clusters-hpccs.html#an-oversimplified-but-useful-view-of-a-computing-cluster"><i class="fa fa-check"></i><b>8.1</b> An oversimplified, but useful, view of a computing cluster</a></li>
<li class="chapter" data-level="8.2" data-path="high-performance-computing-clusters-hpccs.html"><a href="high-performance-computing-clusters-hpccs.html#cluster-computing-and-the-job-scheduler"><i class="fa fa-check"></i><b>8.2</b> Cluster computing and the job scheduler</a></li>
<li class="chapter" data-level="8.3" data-path="high-performance-computing-clusters-hpccs.html"><a href="high-performance-computing-clusters-hpccs.html#slurm-info"><i class="fa fa-check"></i><b>8.3</b> Learning about the resources on your HPCC</a></li>
<li class="chapter" data-level="8.4" data-path="high-performance-computing-clusters-hpccs.html"><a href="high-performance-computing-clusters-hpccs.html#getting-compute-resources-allocated-to-your-jobs-on-an-hpcc"><i class="fa fa-check"></i><b>8.4</b> Getting compute resources allocated to your jobs on an HPCC</a><ul>
<li class="chapter" data-level="8.4.1" data-path="high-performance-computing-clusters-hpccs.html"><a href="high-performance-computing-clusters-hpccs.html#interactive-sessions"><i class="fa fa-check"></i><b>8.4.1</b> Interactive sessions</a></li>
<li class="chapter" data-level="8.4.2" data-path="high-performance-computing-clusters-hpccs.html"><a href="high-performance-computing-clusters-hpccs.html#slurm-batch"><i class="fa fa-check"></i><b>8.4.2</b> Batch jobs</a></li>
<li class="chapter" data-level="8.4.3" data-path="high-performance-computing-clusters-hpccs.html"><a href="high-performance-computing-clusters-hpccs.html#slurm-job-arrays"><i class="fa fa-check"></i><b>8.4.3</b> SLURM Job Arrays</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="high-performance-computing-clusters-hpccs.html"><a href="high-performance-computing-clusters-hpccs.html#prepation-interlude-an-in-class-exercise-to-make-sure-everything-is-configured-correctly"><i class="fa fa-check"></i><b>8.5</b> PREPATION INTERLUDE: An in-class exercise to make sure everything is configured correctly</a></li>
<li class="chapter" data-level="8.6" data-path="high-performance-computing-clusters-hpccs.html"><a href="high-performance-computing-clusters-hpccs.html#more-boneyard"><i class="fa fa-check"></i><b>8.6</b> More Boneyard…</a></li>
<li class="chapter" data-level="8.7" data-path="high-performance-computing-clusters-hpccs.html"><a href="high-performance-computing-clusters-hpccs.html#the-queue-slurmsgeuge"><i class="fa fa-check"></i><b>8.7</b> The Queue (SLURM/SGE/UGE)</a></li>
<li class="chapter" data-level="8.8" data-path="high-performance-computing-clusters-hpccs.html"><a href="high-performance-computing-clusters-hpccs.html#modules-package"><i class="fa fa-check"></i><b>8.8</b> Modules package</a></li>
<li class="chapter" data-level="8.9" data-path="high-performance-computing-clusters-hpccs.html"><a href="high-performance-computing-clusters-hpccs.html#compiling-programs-without-admin-privileges"><i class="fa fa-check"></i><b>8.9</b> Compiling programs without admin privileges</a></li>
<li class="chapter" data-level="8.10" data-path="high-performance-computing-clusters-hpccs.html"><a href="high-performance-computing-clusters-hpccs.html#job-arrays"><i class="fa fa-check"></i><b>8.10</b> Job arrays</a></li>
<li class="chapter" data-level="8.11" data-path="high-performance-computing-clusters-hpccs.html"><a href="high-performance-computing-clusters-hpccs.html#writing-stdout-and-stderr-to-files"><i class="fa fa-check"></i><b>8.11</b> Writing stdout and stderr to files</a></li>
<li class="chapter" data-level="8.12" data-path="high-performance-computing-clusters-hpccs.html"><a href="high-performance-computing-clusters-hpccs.html#breaking-stuff-down"><i class="fa fa-check"></i><b>8.12</b> Breaking stuff down</a></li>
</ul></li>
<li class="part"><span><b>II Part II: Reproducible Research Strategies</b></span></li>
<li class="chapter" data-level="9" data-path="introduction-to-reproducible-research.html"><a href="introduction-to-reproducible-research.html"><i class="fa fa-check"></i><b>9</b> Introduction to Reproducible Research</a></li>
<li class="chapter" data-level="10" data-path="rstudio-and-project-centered-organization.html"><a href="rstudio-and-project-centered-organization.html"><i class="fa fa-check"></i><b>10</b> Rstudio and Project-centered Organization</a><ul>
<li class="chapter" data-level="10.1" data-path="rstudio-and-project-centered-organization.html"><a href="rstudio-and-project-centered-organization.html#organizing-big-projects"><i class="fa fa-check"></i><b>10.1</b> Organizing big projects</a></li>
<li class="chapter" data-level="10.2" data-path="rstudio-and-project-centered-organization.html"><a href="rstudio-and-project-centered-organization.html#using-rstudio-in-workflows-with-remote-computers-and-hpccs"><i class="fa fa-check"></i><b>10.2</b> Using RStudio in workflows with remote computers and HPCCs</a><ul>
<li class="chapter" data-level="10.2.1" data-path="rstudio-and-project-centered-organization.html"><a href="rstudio-and-project-centered-organization.html#keeping-an-rstudio-project-in-sync-with-github"><i class="fa fa-check"></i><b>10.2.1</b> Keeping an RStudio project “in sync” with GitHub</a></li>
<li class="chapter" data-level="10.2.2" data-path="rstudio-and-project-centered-organization.html"><a href="rstudio-and-project-centered-organization.html#evaluating-scripts-line-by-line-on-a-remote-machine-from-within-rstudio"><i class="fa fa-check"></i><b>10.2.2</b> Evaluating scripts line by line on a remote machine from within RStudio</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="version-control.html"><a href="version-control.html"><i class="fa fa-check"></i><b>11</b> Version control</a><ul>
<li class="chapter" data-level="11.1" data-path="version-control.html"><a href="version-control.html#why-use-version-control"><i class="fa fa-check"></i><b>11.1</b> Why use version control?</a></li>
<li class="chapter" data-level="11.2" data-path="version-control.html"><a href="version-control.html#git-workings"><i class="fa fa-check"></i><b>11.2</b> How git works</a></li>
<li class="chapter" data-level="11.3" data-path="version-control.html"><a href="version-control.html#git-workflow-patterns"><i class="fa fa-check"></i><b>11.3</b> git workflow patterns</a></li>
<li class="chapter" data-level="11.4" data-path="version-control.html"><a href="version-control.html#using-git-with-rstudio"><i class="fa fa-check"></i><b>11.4</b> using git with Rstudio</a></li>
<li class="chapter" data-level="11.5" data-path="version-control.html"><a href="version-control.html#git-on-the-command-line"><i class="fa fa-check"></i><b>11.5</b> git on the command line</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="a-fast-furious-overview-of-the-tidyverse.html"><a href="a-fast-furious-overview-of-the-tidyverse.html"><i class="fa fa-check"></i><b>12</b> A fast, furious overview of the tidyverse</a></li>
<li class="chapter" data-level="13" data-path="authoring-reproducibly-with-rmarkdown.html"><a href="authoring-reproducibly-with-rmarkdown.html"><i class="fa fa-check"></i><b>13</b> Authoring reproducibly with Rmarkdown</a><ul>
<li class="chapter" data-level="13.1" data-path="authoring-reproducibly-with-rmarkdown.html"><a href="authoring-reproducibly-with-rmarkdown.html#notebooks"><i class="fa fa-check"></i><b>13.1</b> Notebooks</a></li>
<li class="chapter" data-level="13.2" data-path="authoring-reproducibly-with-rmarkdown.html"><a href="authoring-reproducibly-with-rmarkdown.html#references"><i class="fa fa-check"></i><b>13.2</b> References</a><ul>
<li class="chapter" data-level="13.2.1" data-path="authoring-reproducibly-with-rmarkdown.html"><a href="authoring-reproducibly-with-rmarkdown.html#zotero-and-rmarkdown"><i class="fa fa-check"></i><b>13.2.1</b> Zotero and Rmarkdown</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="authoring-reproducibly-with-rmarkdown.html"><a href="authoring-reproducibly-with-rmarkdown.html#bookdown"><i class="fa fa-check"></i><b>13.3</b> Bookdown</a></li>
<li class="chapter" data-level="13.4" data-path="authoring-reproducibly-with-rmarkdown.html"><a href="authoring-reproducibly-with-rmarkdown.html#google-docs"><i class="fa fa-check"></i><b>13.4</b> Google Docs</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="managing-workflows-with-snakemake.html"><a href="managing-workflows-with-snakemake.html"><i class="fa fa-check"></i><b>14</b> Managing Workflows with Snakemake</a><ul>
<li class="chapter" data-level="14.1" data-path="managing-workflows-with-snakemake.html"><a href="managing-workflows-with-snakemake.html#a-simple-snakemake-example"><i class="fa fa-check"></i><b>14.1</b> A Simple Snakemake Example</a><ul>
<li class="chapter" data-level="14.1.1" data-path="managing-workflows-with-snakemake.html"><a href="managing-workflows-with-snakemake.html#snakefile-1-a-simple-rule-to-trimmomcawesome-the-files-from-001"><i class="fa fa-check"></i><b>14.1.1</b> Snakefile #1: A simple rule to TrimmoMcAwesome the files from 001</a></li>
<li class="chapter" data-level="14.1.2" data-path="managing-workflows-with-snakemake.html"><a href="managing-workflows-with-snakemake.html#snakefile-2-a-single-trimmomcawesome-rule-using-wildcards"><i class="fa fa-check"></i><b>14.1.2</b> Snakefile #2: A single TrimmoMcAwesome rule using wildcards</a></li>
<li class="chapter" data-level="14.1.3" data-path="managing-workflows-with-snakemake.html"><a href="managing-workflows-with-snakemake.html#snakefile-3-add-trim_stupendous-in-there"><i class="fa fa-check"></i><b>14.1.3</b> Snakefile #3: Add <code>trim_stupendous</code> in there</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="managing-workflows-with-snakemake.html"><a href="managing-workflows-with-snakemake.html#ugly-complex-file-namesa-job-for-snakemake-input-functions"><i class="fa fa-check"></i><b>14.2</b> Ugly, complex file names…a job for Snakemake input functions!</a><ul>
<li class="chapter" data-level="14.2.1" data-path="managing-workflows-with-snakemake.html"><a href="managing-workflows-with-snakemake.html#playing-with-pandas"><i class="fa fa-check"></i><b>14.2.1</b> Playing with Pandas</a></li>
<li class="chapter" data-level="14.2.2" data-path="managing-workflows-with-snakemake.html"><a href="managing-workflows-with-snakemake.html#spoofing-a-snakemake-input-function"><i class="fa fa-check"></i><b>14.2.2</b> Spoofing a Snakemake input function</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Part III: Bioinformatic Analyses</b></span></li>
<li class="chapter" data-level="15" data-path="overview-of-bioinformatic-analyses.html"><a href="overview-of-bioinformatic-analyses.html"><i class="fa fa-check"></i><b>15</b> Overview of Bioinformatic Analyses</a></li>
<li class="chapter" data-level="16" data-path="dna-sequences-and-sequencing.html"><a href="dna-sequences-and-sequencing.html"><i class="fa fa-check"></i><b>16</b> DNA Sequences and Sequencing</a><ul>
<li class="chapter" data-level="16.1" data-path="dna-sequences-and-sequencing.html"><a href="dna-sequences-and-sequencing.html#dna-stuff"><i class="fa fa-check"></i><b>16.1</b> DNA Stuff</a><ul>
<li class="chapter" data-level="16.1.1" data-path="dna-sequences-and-sequencing.html"><a href="dna-sequences-and-sequencing.html#dna-replication-with-dna-polymerase"><i class="fa fa-check"></i><b>16.1.1</b> DNA Replication with DNA Polymerase</a></li>
<li class="chapter" data-level="16.1.2" data-path="dna-sequences-and-sequencing.html"><a href="dna-sequences-and-sequencing.html#the-importance-of-the-3-hydroxyl"><i class="fa fa-check"></i><b>16.1.2</b> The importance of the 3’ hydroxyl…</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="dna-sequences-and-sequencing.html"><a href="dna-sequences-and-sequencing.html#sanger-sequencing"><i class="fa fa-check"></i><b>16.2</b> Sanger sequencing</a></li>
<li class="chapter" data-level="16.3" data-path="dna-sequences-and-sequencing.html"><a href="dna-sequences-and-sequencing.html#illumina-sequencing-by-synthesis"><i class="fa fa-check"></i><b>16.3</b> Illumina Sequencing by Synthesis</a></li>
<li class="chapter" data-level="16.4" data-path="dna-sequences-and-sequencing.html"><a href="dna-sequences-and-sequencing.html#library-prep-protocols"><i class="fa fa-check"></i><b>16.4</b> Library Prep Protocols</a><ul>
<li class="chapter" data-level="16.4.1" data-path="dna-sequences-and-sequencing.html"><a href="dna-sequences-and-sequencing.html#wgs"><i class="fa fa-check"></i><b>16.4.1</b> WGS</a></li>
<li class="chapter" data-level="16.4.2" data-path="dna-sequences-and-sequencing.html"><a href="dna-sequences-and-sequencing.html#rad-seq-methods"><i class="fa fa-check"></i><b>16.4.2</b> RAD-Seq methods</a></li>
<li class="chapter" data-level="16.4.3" data-path="dna-sequences-and-sequencing.html"><a href="dna-sequences-and-sequencing.html#amplicon-sequencing"><i class="fa fa-check"></i><b>16.4.3</b> Amplicon Sequencing</a></li>
<li class="chapter" data-level="16.4.4" data-path="dna-sequences-and-sequencing.html"><a href="dna-sequences-and-sequencing.html#capture-arrays-rapture-etc."><i class="fa fa-check"></i><b>16.4.4</b> Capture arrays, RAPTURE, etc.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html"><i class="fa fa-check"></i><b>17</b> Bioinformatic file formats</a><ul>
<li class="chapter" data-level="17.1" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#sequences"><i class="fa fa-check"></i><b>17.1</b> Sequences</a></li>
<li class="chapter" data-level="17.2" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#fastq"><i class="fa fa-check"></i><b>17.2</b> FASTQ</a><ul>
<li class="chapter" data-level="17.2.1" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#illumina-ids"><i class="fa fa-check"></i><b>17.2.1</b> Line 1: Illumina identifier lines</a></li>
<li class="chapter" data-level="17.2.2" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#bqscores"><i class="fa fa-check"></i><b>17.2.2</b> Line 4: Base quality scores</a></li>
<li class="chapter" data-level="17.2.3" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#a-fastq-tidyverse-interlude"><i class="fa fa-check"></i><b>17.2.3</b> A FASTQ ‘tidyverse’ Interlude</a></li>
<li class="chapter" data-level="17.2.4" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#comparing-read-1-to-read-2"><i class="fa fa-check"></i><b>17.2.4</b> Comparing read 1 to read 2</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#fasta"><i class="fa fa-check"></i><b>17.3</b> FASTA</a><ul>
<li class="chapter" data-level="17.3.1" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#genomic-ranges"><i class="fa fa-check"></i><b>17.3.1</b> Genomic ranges</a></li>
<li class="chapter" data-level="17.3.2" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#extracting-genomic-ranges-from-a-fasta-file"><i class="fa fa-check"></i><b>17.3.2</b> Extracting genomic ranges from a FASTA file</a></li>
<li class="chapter" data-level="17.3.3" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#downloading-reference-genomes-from-ncbi"><i class="fa fa-check"></i><b>17.3.3</b> Downloading reference genomes from NCBI</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#alignments"><i class="fa fa-check"></i><b>17.4</b> Alignments</a><ul>
<li class="chapter" data-level="17.4.1" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#how-might-i-align-to-thee-let-me-count-the-ways"><i class="fa fa-check"></i><b>17.4.1</b> How might I align to thee? Let me count the ways…</a></li>
<li class="chapter" data-level="17.4.2" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#play-with-simple-alignments"><i class="fa fa-check"></i><b>17.4.2</b> Play with simple alignments</a></li>
<li class="chapter" data-level="17.4.3" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#sam-flags"><i class="fa fa-check"></i><b>17.4.3</b> SAM Flags</a></li>
<li class="chapter" data-level="17.4.4" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#cigar"><i class="fa fa-check"></i><b>17.4.4</b> The CIGAR string</a></li>
<li class="chapter" data-level="17.4.5" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#the-seq-and-qual-columns"><i class="fa fa-check"></i><b>17.4.5</b> The SEQ and QUAL columns</a></li>
<li class="chapter" data-level="17.4.6" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#sam-headers"><i class="fa fa-check"></i><b>17.4.6</b> SAM File Headers</a></li>
<li class="chapter" data-level="17.4.7" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#the-bam-format"><i class="fa fa-check"></i><b>17.4.7</b> The BAM format</a></li>
<li class="chapter" data-level="17.4.8" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#quick-self-study"><i class="fa fa-check"></i><b>17.4.8</b> Quick self study</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#variants"><i class="fa fa-check"></i><b>17.5</b> Variants</a><ul>
<li class="chapter" data-level="17.5.1" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#vcf-format-the-body"><i class="fa fa-check"></i><b>17.5.1</b> VCF Format – The Body</a></li>
<li class="chapter" data-level="17.5.2" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#vcf-format-the-header"><i class="fa fa-check"></i><b>17.5.2</b> VCF Format – The Header</a></li>
<li class="chapter" data-level="17.5.3" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#boneyard"><i class="fa fa-check"></i><b>17.5.3</b> Boneyard</a></li>
</ul></li>
<li class="chapter" data-level="17.6" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#segments"><i class="fa fa-check"></i><b>17.6</b> Segments</a></li>
<li class="chapter" data-level="17.7" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#conversionextractions-between-different-formats"><i class="fa fa-check"></i><b>17.7</b> Conversion/Extractions between different formats</a></li>
<li class="chapter" data-level="17.8" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#visualization-of-genomic-data"><i class="fa fa-check"></i><b>17.8</b> Visualization of Genomic Data</a><ul>
<li class="chapter" data-level="17.8.1" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#sample-data"><i class="fa fa-check"></i><b>17.8.1</b> Sample Data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="genome-assembly.html"><a href="genome-assembly.html"><i class="fa fa-check"></i><b>18</b> Genome Assembly</a></li>
<li class="chapter" data-level="19" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><i class="fa fa-check"></i><b>19</b> Alignment of sequence data to a reference genome (and associated steps)</a><ul>
<li class="chapter" data-level="19.1" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#the-journey-of-each-dna-fragment-from-organism-to-sequencing-read"><i class="fa fa-check"></i><b>19.1</b> The Journey of each DNA Fragment from Organism to Sequencing Read</a></li>
<li class="chapter" data-level="19.2" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#read-groups"><i class="fa fa-check"></i><b>19.2</b> Read Groups</a></li>
<li class="chapter" data-level="19.3" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#aligning-reads-with-bwa"><i class="fa fa-check"></i><b>19.3</b> Aligning reads with <code>bwa</code></a><ul>
<li class="chapter" data-level="19.3.1" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#indexing-the-genome-for-alignment"><i class="fa fa-check"></i><b>19.3.1</b> Indexing the genome for alignment</a></li>
<li class="chapter" data-level="19.3.2" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#mapping-reads-with-bwa-mem"><i class="fa fa-check"></i><b>19.3.2</b> Mapping reads with <code>bwa mem</code></a></li>
<li class="chapter" data-level="19.3.3" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#hold-it-right-there-buddy-what-about-the-read-groups"><i class="fa fa-check"></i><b>19.3.3</b> Hold it Right There, Buddy! What about the Read Groups?</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#processing-alignment-output-with-samtools"><i class="fa fa-check"></i><b>19.4</b> Processing alignment output with <code>samtools</code></a><ul>
<li class="chapter" data-level="19.4.1" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#samtools-subcommands"><i class="fa fa-check"></i><b>19.4.1</b> <code>samtools</code> subcommands</a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#boneyard-below-here"><i class="fa fa-check"></i><b>19.5</b> BONEYARD BELOW HERE</a></li>
<li class="chapter" data-level="19.6" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#preprocess"><i class="fa fa-check"></i><b>19.6</b> Preprocess ?</a></li>
<li class="chapter" data-level="19.7" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#quick-notes-to-self-on-chaining-things"><i class="fa fa-check"></i><b>19.7</b> Quick notes to self on chaining things:</a></li>
<li class="chapter" data-level="19.8" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#merging-bam-files"><i class="fa fa-check"></i><b>19.8</b> Merging BAM files</a></li>
<li class="chapter" data-level="19.9" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#divide-and-conquer-strategies"><i class="fa fa-check"></i><b>19.9</b> Divide and Conquer Strategies</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="variant-calling.html"><a href="variant-calling.html"><i class="fa fa-check"></i><b>20</b> Variant calling</a><ul>
<li class="chapter" data-level="20.1" data-path="variant-calling.html"><a href="variant-calling.html#genotype-likelihoods"><i class="fa fa-check"></i><b>20.1</b> Genotype Likelihoods</a><ul>
<li class="chapter" data-level="20.1.1" data-path="variant-calling.html"><a href="variant-calling.html#basic-sketch-of-genotype-likelihood-calculations"><i class="fa fa-check"></i><b>20.1.1</b> Basic Sketch of Genotype Likelihood Calculations</a></li>
<li class="chapter" data-level="20.1.2" data-path="variant-calling.html"><a href="variant-calling.html#specifics-of-different-genotype-likelihoods"><i class="fa fa-check"></i><b>20.1.2</b> Specifics of different genotype likelihoods</a></li>
<li class="chapter" data-level="20.1.3" data-path="variant-calling.html"><a href="variant-calling.html#computing-genotype-likelihoods-with-three-different-softwares"><i class="fa fa-check"></i><b>20.1.3</b> Computing genotype likelihoods with three different softwares</a></li>
<li class="chapter" data-level="20.1.4" data-path="variant-calling.html"><a href="variant-calling.html#a-directed-acyclic-graph-for-genotype-likelihoods"><i class="fa fa-check"></i><b>20.1.4</b> A Directed Acyclic Graph For Genotype Likelihoods</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="21" data-path="boneyard-1.html"><a href="boneyard-1.html"><i class="fa fa-check"></i><b>21</b> Boneyard</a></li>
<li class="chapter" data-level="22" data-path="basic-handling-of-vcf-files.html"><a href="basic-handling-of-vcf-files.html"><i class="fa fa-check"></i><b>22</b> Basic Handling of VCF files</a><ul>
<li class="chapter" data-level="22.1" data-path="basic-handling-of-vcf-files.html"><a href="basic-handling-of-vcf-files.html#bcftools"><i class="fa fa-check"></i><b>22.1</b> bcftools</a><ul>
<li class="chapter" data-level="22.1.1" data-path="basic-handling-of-vcf-files.html"><a href="basic-handling-of-vcf-files.html#tell-me-about-my-vcf-file"><i class="fa fa-check"></i><b>22.1.1</b> Tell me about my VCF file!</a></li>
<li class="chapter" data-level="22.1.2" data-path="basic-handling-of-vcf-files.html"><a href="basic-handling-of-vcf-files.html#get-fragmentsparts-of-my-vcf-file"><i class="fa fa-check"></i><b>22.1.2</b> Get fragments/parts of my VCF file</a></li>
<li class="chapter" data-level="22.1.3" data-path="basic-handling-of-vcf-files.html"><a href="basic-handling-of-vcf-files.html#combine-vcf-files-in-various-ways"><i class="fa fa-check"></i><b>22.1.3</b> Combine VCF files in various ways</a></li>
<li class="chapter" data-level="22.1.4" data-path="basic-handling-of-vcf-files.html"><a href="basic-handling-of-vcf-files.html#filter-out-variants-for-a-variety-of-reasons"><i class="fa fa-check"></i><b>22.1.4</b> Filter out variants for a variety of reasons</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="23" data-path="bioinformatics-for-rad-seq-data-with-and-without-a-reference-genome.html"><a href="bioinformatics-for-rad-seq-data-with-and-without-a-reference-genome.html"><i class="fa fa-check"></i><b>23</b> Bioinformatics for RAD seq data with and without a reference genome</a></li>
<li class="chapter" data-level="24" data-path="processing-amplicon-sequencing-data.html"><a href="processing-amplicon-sequencing-data.html"><i class="fa fa-check"></i><b>24</b> Processing amplicon sequencing data</a></li>
<li class="chapter" data-level="25" data-path="genome-annotation.html"><a href="genome-annotation.html"><i class="fa fa-check"></i><b>25</b> Genome Annotation</a></li>
<li class="chapter" data-level="26" data-path="whole-genome-alignment-strategies.html"><a href="whole-genome-alignment-strategies.html"><i class="fa fa-check"></i><b>26</b> Whole genome alignment strategies</a><ul>
<li class="chapter" data-level="26.1" data-path="whole-genome-alignment-strategies.html"><a href="whole-genome-alignment-strategies.html#mapping-of-scaffolds-to-a-closely-related-genome"><i class="fa fa-check"></i><b>26.1</b> Mapping of scaffolds to a closely related genome</a></li>
<li class="chapter" data-level="26.2" data-path="whole-genome-alignment-strategies.html"><a href="whole-genome-alignment-strategies.html#obtaining-ancestral-states-from-an-outgroup-genome"><i class="fa fa-check"></i><b>26.2</b> Obtaining Ancestral States from an Outgroup Genome</a><ul>
<li class="chapter" data-level="26.2.1" data-path="whole-genome-alignment-strategies.html"><a href="whole-genome-alignment-strategies.html#using-lastz-to-align-coho-to-the-chinook-genome"><i class="fa fa-check"></i><b>26.2.1</b> Using LASTZ to align coho to the chinook genome</a></li>
<li class="chapter" data-level="26.2.2" data-path="whole-genome-alignment-strategies.html"><a href="whole-genome-alignment-strategies.html#try-on-the-chinook-chromosomes"><i class="fa fa-check"></i><b>26.2.2</b> Try on the chinook chromosomes</a></li>
<li class="chapter" data-level="26.2.3" data-path="whole-genome-alignment-strategies.html"><a href="whole-genome-alignment-strategies.html#explore-the-other-parameters-more"><i class="fa fa-check"></i><b>26.2.3</b> Explore the other parameters more</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Part IV: Analysis of Big Variant Data</b></span></li>
<li class="chapter" data-level="27" data-path="bioinformatic-analysis-on-variant-data.html"><a href="bioinformatic-analysis-on-variant-data.html"><i class="fa fa-check"></i><b>27</b> Bioinformatic analysis on variant data</a></li>
<li class="part"><span><b>V Part V: Population Genomics</b></span></li>
<li class="chapter" data-level="28" data-path="topics-in-pop-gen.html"><a href="topics-in-pop-gen.html"><i class="fa fa-check"></i><b>28</b> Topics in pop gen</a><ul>
<li class="chapter" data-level="28.1" data-path="topics-in-pop-gen.html"><a href="topics-in-pop-gen.html#coalescent"><i class="fa fa-check"></i><b>28.1</b> Coalescent</a></li>
<li class="chapter" data-level="28.2" data-path="topics-in-pop-gen.html"><a href="topics-in-pop-gen.html#measures-of-genetic-diversity-and-such"><i class="fa fa-check"></i><b>28.2</b> Measures of genetic diversity and such</a></li>
<li class="chapter" data-level="28.3" data-path="topics-in-pop-gen.html"><a href="topics-in-pop-gen.html#demographic-inference-with-partial-a-partial-i-and-moments"><i class="fa fa-check"></i><b>28.3</b> Demographic inference with <span class="math inline">\(\partial a \partial i\)</span> and <em>moments</em></a></li>
<li class="chapter" data-level="28.4" data-path="topics-in-pop-gen.html"><a href="topics-in-pop-gen.html#balls-in-boxes"><i class="fa fa-check"></i><b>28.4</b> Balls in Boxes</a></li>
<li class="chapter" data-level="28.5" data-path="topics-in-pop-gen.html"><a href="topics-in-pop-gen.html#some-landscape-genetics"><i class="fa fa-check"></i><b>28.5</b> Some landscape genetics</a></li>
<li class="chapter" data-level="28.6" data-path="topics-in-pop-gen.html"><a href="topics-in-pop-gen.html#relationship-inference"><i class="fa fa-check"></i><b>28.6</b> Relationship Inference</a></li>
<li class="chapter" data-level="28.7" data-path="topics-in-pop-gen.html"><a href="topics-in-pop-gen.html#tests-for-selection"><i class="fa fa-check"></i><b>28.7</b> Tests for Selection</a></li>
<li class="chapter" data-level="28.8" data-path="topics-in-pop-gen.html"><a href="topics-in-pop-gen.html#multivariate-associations-gea-etc."><i class="fa fa-check"></i><b>28.8</b> Multivariate Associations, GEA, etc.</a></li>
<li class="chapter" data-level="28.9" data-path="topics-in-pop-gen.html"><a href="topics-in-pop-gen.html#estimating-heritability-in-the-wild"><i class="fa fa-check"></i><b>28.9</b> Estimating heritability in the wild</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-1.html"><a href="references-1.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Practical Computing and Bioinformatics for Conservation and Evolutionary Genomics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="working-on-remote-servers" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> Working on remote servers</h1>
<div id="accessing-remote-computers" class="section level2">
<h2><span class="header-section-number">7.1</span> Accessing remote computers</h2>
<p>The primary protocol for accessing remote computers in this day and age
is <code>ssh</code> which stands for “Secure Shell.” In the protocol, your computer
and the remote computer talk to one another and then choose to have a “shared
secret” which they can use as a key to encrypt data traffic from one to the other.
The amazing thing is that the two computers can actually tell each other what
that shared secret is by having a conversation “in the open” with one another.
That is a topic for another day, but if you are interested, you could
read about it <a href="https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange">here</a>.</p>
<p>At any rate, the SSH protocal allows for secure access to a remote server. It involves
using a username and a password, and, in many cases today, some form of two-factor
authentication (i.e., you need to have your phone involved, too!). Different
remote servers have different routines for logging in to them, and they are also
all configured a little differently. The main servers we are concerned about in
these teaching materials are:</p>
<ol style="list-style-type: decimal">
<li>The Hummingbird cluster at UCSC, which is accessible by anyone with a UCSC blue username/password.</li>
<li>The Summit Supercomputer at CU Boulder which is accessible by all graduate students and
faculty at CSU.</li>
<li>The Sedna cluster housed at the National Marine Fisheries Service, Northwest Fisheries Science
Center. This is accessible only by those Federal NMFS employees whom have been granted access.</li>
</ol>
<p>Happily, all of these systems use SLURM for job scheduling (much more about that in the
next chapter); however are a few vagaries to each of these systems that we will cover below.</p>
<div id="windows" class="section level3">
<h3><span class="header-section-number">7.1.1</span> Windows</h3>
<p>If you are on a Windows machine, you can use the <code>ssh</code> utility from your Git Bash shell, but
that is a bit of a hassle from RStudio. And a better terminal emulator is available if you
are going to be accessing remote computers. It is recommended that you install and
use the program <a href="https://www.ssh.com/ssh/putty">PuTTy</a>. The steps are pretty self-explanatory
and well documented. Instead of using <code>ssh</code> on a command line you put a host name into
a dialog box, etc.</p>
<p>WHOA! I’m not a Windows person, but I just Matthew Hopken working on Windows using <a href="https://mobaxterm.mobatek.net/">MobaXterm</a> to connect to the server and it looks
pretty nice.</p>
</div>
<div id="hummingbird" class="section level3">
<h3><span class="header-section-number">7.1.2</span> Hummingbird</h3>
<p>Directions for UCSC students and staff to login to Hummingbird are available
at <a href="https://www.hb.ucsc.edu/getting-started/">https://www.hb.ucsc.edu/getting-started/</a>.
If you are not on the UCSC campus network, you need to use the UCSC VPN to connect.</p>
<p>By default, this cluster uses <code>tcsh</code> for a shell rather than <code>bash</code>. To keep things
consistent with what you have learned about <code>bash</code>, you will want to automatically switch
to <code>bash</code> upon login. You can do this by adding a file <code>~/.tcshrc</code> whose contents are:</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb180-1"><a href="working-on-remote-servers.html#cb180-1"></a><span class="ex">setenv</span> SHELL /usr/bin/bash</span>
<span id="cb180-2"><a href="working-on-remote-servers.html#cb180-2"></a><span class="bu">exec</span> /usr/bin/bash --login</span></code></pre></div>
<p>Then, configure your <code>bash</code> environment with your <code>~/.bashrc</code> and <code>~/.bash_profile</code> as
described in Chapter <a href="essential-unixlinux-terminal-knowledge.html#unix-env">4.5</a>.</p>
<p>The <code>tmux</code> settings (See section <a href="working-on-remote-servers.html#tmux">7.3</a>) in hummingbird are a little messed up as well, making
it hard to set window names that don’t get changed the moment you make another command. Therefore,
you must make a file called <code>~/.tmux.conf</code> and put this line in it:</p>
<pre><code>set-option -g allow-rename off</code></pre>
</div>
<div id="summit" class="section level3">
<h3><span class="header-section-number">7.1.3</span> Summit</h3>
<p>To get an account on Summit, see <a href="https://www.acns.colostate.edu/hpc/summit-get-started/">https://www.acns.colostate.edu/hpc/summit-get-started/</a>. Account creation is automatic for graduate students and faculty. This setup requires
that you get an app called Duo on your phone for doing two-factor authentication.</p>
<p>Instructions for logging into Summit are at <a href="https://www.acns.colostate.edu/hpc/#remote-login">https://www.acns.colostate.edu/hpc/#remote-login</a>.</p>
<p>On your local machine (i.e., laptop), you might consider adding an alias to your
<code>.bashrc</code> that will let you type <code>summit</code> to issue the login command. For example:</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb182-1"><a href="working-on-remote-servers.html#cb182-1"></a><span class="bu">alias</span> summit=<span class="st">&#39;ssh csu_eid@colostate.edu@login.rc.colorado.edu&#39;</span></span></code></pre></div>
<p>where you replace <code>csu_eid</code> with your actual CSU eID.</p>
</div>
<div id="sedna" class="section level3">
<h3><span class="header-section-number">7.1.4</span> Sedna</h3>
<p>To connect to this cluster you must be on the NMFS network, or
connected to it via the VPN, then <code>ssh</code> with, for example:</p>
<pre><code>ssh eanderson@sedna.nwfsc2.noaa.gov</code></pre>
<p>but using your own username.</p>
</div>
</div>
<div id="transferring-files-to-remote-computers" class="section level2">
<h2><span class="header-section-number">7.2</span> Transferring files to remote computers</h2>
<div id="sftp-via-lftp" class="section level3">
<h3><span class="header-section-number">7.2.1</span> <code>sftp</code> (via <code>lftp</code>)</h3>
<p>Most Unix systems have a command called <code>scp</code>, which works like <code>cp</code>, but which is
designed for copying files to and from
remote servers using the SSH protocol for security. This works really well
if you have set up a public/private key pair to allow SSH access to your server
without constantly having to type in your password. Use of public-private keypairs is unfortunately, not
an option (as far as I can tell) on new NSF-funded clusters that use 2-factor authentication (like SUMMIT
at CU Boulder). Trying to use <code>scp</code> in such a context becomes an endless cycle of
entering your password and checking your phone for a DUO push. Fortunately, there are
alternatives.</p>
<p>The administrators of the SUMMIT supercomputer at CU Boulder recommend
the <code>sftp</code> utility for transferring files from your laptop to the server.
This works reasonably well. The syntax for a CSU student or affiliate connecting to the server is</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb184-1"><a href="working-on-remote-servers.html#cb184-1"></a><span class="ex">sftp</span> csu_userEID@colostate.edu@login.rc.colorado.edu</span>
<span id="cb184-2"><a href="working-on-remote-servers.html#cb184-2"></a></span>
<span id="cb184-3"><a href="working-on-remote-servers.html#cb184-3"></a><span class="co"># for example, here is mine:</span></span>
<span id="cb184-4"><a href="working-on-remote-servers.html#cb184-4"></a><span class="ex">sftp</span> eriq@colostate.edu@login.rc.colorado.edu</span></code></pre></div>
<p>After doing this you have to give your eID password followed by <code>,push</code>, and then
approve the DUO push request on your phone. Once that is done, you have a “line open”
to the server and can use the commands of <code>sftp</code> to transfer files around.
However, the vanilla version of <code>sftp</code> (at least on a Mac) is unbelievably limited,
because there is simply no good support for TAB completion within
the utility for navigating directories on the server or upon your laptop.
It must have been developed by troglodytes…consequently, I won’t describe
vanilla <code>sftp</code> further.</p>
<p>If you are on Windows, it looks like the makers of PuTTY also bring you
<a href="https://www.ssh.com/ssh/putty/putty-manuals/0.68/Chapter6.html#psftp">PSFTP</a> which
might be useful for you for file transfer. Go for it!</p>
<p>If you are on a Mac, you can install <code>lftp</code> (<code>brew install lftp</code>: note that I need to write
a section about installing command line utilities via homebrew somewhere in this handbook).
<code>lftp</code> provides the sort of TAB completion of paths that you, by now, will have come to
know and love and expect.</p>
<p>Before you connect to your server with <code>lftp</code> there are a few customizations that you will
want to do in order to get nicely colored output, and to avoid having to login repeatedly
during your <code>lftp</code> session. You must make a file on your laptop called <code>~/.lftprc</code> and put
the following lines in it:</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb185-1"><a href="working-on-remote-servers.html#cb185-1"></a><span class="kw">set</span> <span class="ex">color</span>:dir-colors <span class="st">&quot;rs=0:di=01;36:fi=01;32:ln=01;31:*.txt=01;35:*.html=00;35:&quot;</span></span>
<span id="cb185-2"><a href="working-on-remote-servers.html#cb185-2"></a><span class="kw">set</span> <span class="ex">color</span>:use-color true</span>
<span id="cb185-3"><a href="working-on-remote-servers.html#cb185-3"></a></span>
<span id="cb185-4"><a href="working-on-remote-servers.html#cb185-4"></a><span class="kw">set</span> <span class="ex">net</span>:idle 5h</span>
<span id="cb185-5"><a href="working-on-remote-servers.html#cb185-5"></a><span class="kw">set</span> <span class="ex">net</span>:timeout 5h</span></code></pre></div>
<p>Now, to connect to SUMMIT with <code>lftp</code>, you use this syntax (shown for my username):</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb186-1"><a href="working-on-remote-servers.html#cb186-1"></a><span class="ex">lftp</span> sftp://eriq@colostate.edu@login.rc.colorado.edu</span></code></pre></div>
<p>That can be a lot to type, so I would recommend putting something this in your
<code>.bashrc</code>:</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb187-1"><a href="working-on-remote-servers.html#cb187-1"></a><span class="bu">alias</span> summit_ftp=<span class="st">&#39;lftp sftp://eriq@colostate.edu@login.rc.colorado.edu&#39;</span></span></code></pre></div>
<p>so you can just type <code>summit_ftp</code> (which will TAB complete…) to launch that command.</p>
<p>After you issue that command, you put in your password (on SUMMIT, followed by <code>,push</code>). <code>lftp</code> then caches your
password, and will re-issue it, if necessary, to execute commands. It doesn’t actually send your
password until you try a command like <code>cls</code>. On the SUMMIT system, with the default <code>lftp</code> settings,
after 3 minutes of idle time, when you issue an <code>sftp</code> command on the server, you will have to approve
access with the DUO app on your phone again. However, the line last two lines in the
<code>~/.lftprc</code> file listed above ensure that your connection to SUMMIT will stay active even
through 5 hours of idle time, so you don’t have to keep clicking DUO pushes on your phone.
After 5 hours, if you try issuing a command to the server in <code>lftp</code>, it will use your cached
password to reconnect to the server. On SUMMIT, this means that you only need to deal with
approving a DUO push again—not re-entering your password. If you are working on SUMMIT daily,
it makes sense to just keep one Terminal window open, running <code>lftp</code>, all the time.</p>
<p>Once you have started your <code>lftp/sftp</code> session this way, there are some important things to keep in mind.
The most important of which is that the <code>lftp</code> session you are in maintains a <em>current working directory</em>
on both the server and on your laptop. We will call these the <em>server working directory</em> and
the <em>laptop working directory</em>, respectively, (Technically, we ought to call the laptop working directory the <em>client working directory</em>
but I find that is confusing for people, we we will stick with <em>laptop</em>.)
There are two different commands to see what each
current working directory is:</p>
<ul>
<li><code>pwd</code> : print the <em>server working directory</em></li>
<li><code>lpwd</code> : print <em>laptop working directory</em> (the preceding <code>l</code> stands
for <em>local</em>).</li>
</ul>
<p>If you want to change either the server or the laptop current working directory you use:</p>
<ul>
<li><code>cd</code> <em>path</em> : change the server working directory to <em>path</em></li>
<li><code>lcd</code> <em>path</em> : change the laptop working directory to <em>path</em>.</li>
</ul>
<p>Following <code>lcd</code>, TAB-completion is done for paths <em>on the laptop</em>, while following
<code>cd</code>, TAB-completion is done for paths <em>on the server</em>.</p>
<p>If you want to list the contents of the different directories <em>on the servers</em> you use:</p>
<ul>
<li><code>cls</code> : list things in the server working directory, or</li>
<li><code>cls</code> <em>path</em> : list things in <em>path</em> on the server.</li>
</ul>
<p>Note that <code>cls</code> is a little different than the <code>ls</code> command that comes
with <code>sftp</code>. The latter command always prints in long format and does not play
nicely with colorized output. By contrast, <code>cls</code> is part of <code>lftp</code> and it
behaves mostly like your typical Unix <code>ls</code> command, taking options like <code>-a</code>, <code>-l</code> and <code>-d</code>, and
it will even do <code>cls -lrt</code>. Type <code>help cls</code> at the <code>lftp</code> prompt for more information.</p>
<p>If you want to list the contents of the different directories on your laptop, you
use <code>ls</code> <em>but you preface it with a</em> <code>!</code>, which means “execute the following on my
laptop, not the server.” So, we have:</p>
<ul>
<li><code>!ls</code> : list the contents of the laptop working directory.</li>
<li><code>!ls</code> <em>path</em> : list the contents of the laptop path <em>path</em>.</li>
</ul>
<p>When you use the <code>!</code> at the beginning of the line, then all the TAB completion occurs
in the context of the laptop current working directory. Note that with the <code>!</code>
you can do all sorts of typical shell commands on your laptop from within the <code>lftp</code>
session. For example <code>!mkdir this_on_my_laptop</code> or <code>!cat that_file</code>, etc.</p>
<p>If you wish to make a directory on the <em>server</em>, just use <code>mkdir</code>. If you wish to
remove a file from the server, just use <code>rm</code>. The latter works much like it does in
bash, but does not seem to support globbing (use <code>mrm</code> for that!) In fact, you can
do a lot of things (like <code>cat</code> and <code>less</code>) on the server
<em>as if you had a bash shell running on it</em> through an
SSH connection. Just type those commands at the <code>lftp</code> prompt.</p>
<div id="transferring-files-using-lftp" class="section level4">
<h4><span class="header-section-number">7.2.1.1</span> Transferring files using <code>lftp</code></h4>
<p>To this point, we haven’t even talked about our original goal with <code>lftp</code>, which
was to <em>transfer files from our laptop to the server</em> or from <em>the server to our laptop</em>.
The main <code>lftp</code> commands for those tasks are: <code>get</code>, <code>put</code>, <code>mget</code>, <code>mput</code>, and <code>mirror</code>—it is
not too much to have to remember.</p>
<p>As the name suggests, <code>put</code> is for <em>putting</em> files from your laptop onto the server. By default it
puts files into the server working directory. Here is an example:</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb188-1"><a href="working-on-remote-servers.html#cb188-1"></a><span class="ex">put</span> laptopFile_1 laptopFile_2</span></code></pre></div>
<p>If you want to put the file into a different directory on the server (that must already exist)
you can use the <code>-O</code> option:</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb189-1"><a href="working-on-remote-servers.html#cb189-1"></a><span class="ex">put</span> -O server_dest_dir laptopFile_1 laptopFile_2</span></code></pre></div>
<p>The command <code>get</code> works in much the same way, but in reverse: you are <em>getting</em> things
<em>from the server to your laptop</em>. For example:</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb190-1"><a href="working-on-remote-servers.html#cb190-1"></a><span class="co"># copy to laptop working directory</span></span>
<span id="cb190-2"><a href="working-on-remote-servers.html#cb190-2"></a><span class="ex">get</span> serverFile_1 serverFile1_2</span>
<span id="cb190-3"><a href="working-on-remote-servers.html#cb190-3"></a></span>
<span id="cb190-4"><a href="working-on-remote-servers.html#cb190-4"></a><span class="co"># copy to existing directory laptop_dest_dir </span></span>
<span id="cb190-5"><a href="working-on-remote-servers.html#cb190-5"></a><span class="ex">get</span> -O laptop_dest_dir serverFile_1 serverFile1_2</span></code></pre></div>
<p>Neither of the commands <code>get</code> or <code>put</code> do any of the pathname expansion (or “globbing” as it
we have called it) that you will be familiar with from the <code>bash</code> shell. To effect that sort
of functionality you must use <code>mput</code> and <code>mget</code>, which, as the <code>m</code> prefix in the
command names suggests, are the “multi-file” versions of <code>put</code> and <code>get</code>. Both of these
commands also take the -O option, if desired, so that the above commands could be
rewritten like this:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb191-1"><a href="working-on-remote-servers.html#cb191-1"></a><span class="ex">mput</span> -O server_dest_dir laptopFile_[12]</span>
<span id="cb191-2"><a href="working-on-remote-servers.html#cb191-2"></a><span class="co"># and</span></span>
<span id="cb191-3"><a href="working-on-remote-servers.html#cb191-3"></a><span class="ex">mget</span> -O laptop_dest_dir serverFile_[12]</span></code></pre></div>
<p>Finally, there is not a <em>recursive</em> option, like there is with <code>cp</code>, to any of <code>get</code>, <code>put</code>, <code>mget</code>,
or <code>mput</code>. Thus, you cannot use any of those four to put/get entire directories on/from the
server. For that purpose, <code>lftp</code> has reserved the <code>mirror</code> command. It does what it sounds like:
it mirrors a directory from the server to the laptop. The <code>mirror</code> command can actually
be used in a lot of different configurations (between two remote servers, for example) and
with different settings (for example to change only pre-existing files older than
a certain date).
However, here, we will demonstrate only its common use case
of copying directories between a server and laptop here.</p>
<p>To copy a directory <code>dir</code>, and its contents, from your server to your
laptop current directory you use:</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb192-1"><a href="working-on-remote-servers.html#cb192-1"></a><span class="ex">mirror</span> dir</span></code></pre></div>
<p>To copy a directory <code>ldir</code> from your laptop to your server current directory you
use <code>-R</code> which transmits the directory in the reverse direction:</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb193-1"><a href="working-on-remote-servers.html#cb193-1"></a><span class="ex">mirror</span> -R ldir</span></code></pre></div>
<p>Learning to use <code>lftp</code> will require a little bit more of your time, but it is worth
it, allowing you to keep a dedicated terminal window open for file transfers with sensible
TAB-completion capability.</p>
</div>
</div>
<div id="git" class="section level3">
<h3><span class="header-section-number">7.2.2</span> git</h3>
<p>Most remote servers you work on will have <code>git</code> by default.
If you are doing all your work on a project within a single
repository, you can use <code>git</code> to keep scripts and other files
version-controlled on the server. You can also push and pull files
(not big data or output files!) to GitHub, thus keeping things backed up
and version controlled, and providing a useful way to synchronize scripts
and other files in your project between the server and your laptop.</p>
<p>Example:</p>
<ol style="list-style-type: decimal">
<li>write and test scripts on your laptop in a repo called <code>my-project</code></li>
<li>commit scripts on your laptop and push them to GitHub in a repo also
called <code>my-project</code></li>
<li>pull <code>my-project</code> from GitHub to the server.</li>
<li>Try running your scripts in <code>my-project</code> on your server. In the process,
you may discover that you need to change/fix some things so they will
run correctly on the server. Fix them!</li>
<li>Once things are fixed and successfully running on the server, commit
those changes and push them to GitHub.</li>
<li>Update the files on your laptop so that they reflect the changes you
had to make on the server, by pulling <code>my-project</code> from GitHub to your
laptop.</li>
</ol>
<div id="configuring-git-on-the-remote-server" class="section level4">
<h4><span class="header-section-number">7.2.2.1</span> Configuring git on the remote server</h4>
<p>In order to make this sort of worklow successful, you first need
to ensure that you have set up git on your remote server. Doing
so involves:</p>
<ol style="list-style-type: decimal">
<li>establishing your name and email that will be used with your git commits
made from the server.</li>
<li>Ensuring that git password caching is set up so you don’t always have
to type your GitHub password when you push and pull.</li>
<li>configuring your git text editor to be something that you know how
to use.</li>
</ol>
<p>It can be useful give yourself a git name on the server that reflects
the fact that the changes you are committing were made on the server.</p>
<p>For example, for my own setup on the Summit cluster at Boulder, I might
do my git configurations by issuing these commands on the
command line on the server:</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb194-1"><a href="working-on-remote-servers.html#cb194-1"></a><span class="fu">git</span> config --global user.name <span class="st">&quot;Eric C. Anderson (From Summit)&quot;</span></span>
<span id="cb194-2"><a href="working-on-remote-servers.html#cb194-2"></a><span class="fu">git</span> config --global user.email eriq@rams.colostate.edu</span>
<span id="cb194-3"><a href="working-on-remote-servers.html#cb194-3"></a><span class="fu">git</span> config --global credential.helper cache</span>
<span id="cb194-4"><a href="working-on-remote-servers.html#cb194-4"></a><span class="fu">git</span> config --global core.editor nano</span></code></pre></div>
<p>In all actuality, I would set my editor to be <code>vim</code> or <code>emacs</code>, because those are
more powerful editors and I am familiar with then; however, if you are new to Unix,
then <code>nano</code> is an easy-to-use editor.</p>
<p>You should set configurations on your server appropriate to yourself
(i.e., with your name and email and preferred text editor). Once these configurations are set, you are ready to start cloning
repositories from GitHub and then pushing and pulling them, as well.</p>
<p>To this point, we have always done those actions from within
RStudio. On a remote server, however, you will have to do all these
actions from the command line. That is OK, it just requires learning
a few new things.</p>
<p>The first, and most important, issue to understand is that if you want
to push new changes back to a repository that is on your GitHub account,
GitHub needs to know that you have privileges to do so. One way to
do this is by making sure, when you initially clone the repository,
that you do so whilst letting GitHub know that you are the user that
“owns” your GitHub account. This is done by inserting your GitHub
username into your <code>git clone</code> request with the following syntax:</p>
<pre><code>git clone https://username@github.com/username/repository.git</code></pre>
<p>For example, if I want to <code>clone</code> a repository whose URL is:</p>
<pre><code>https://github.com/eriqande/alignment-play</code></pre>
<p>I would issue this command:</p>
<pre><code>git clone https://eriqande@github.com/eriqande/alignment-play</code></pre>
<p>This clones the repository to my server, and makes
a note of the fact that you did so as the GitHub user <code>eriqande</code>,
so that if I try to push something back to that GitHub repository,
it will ask me for me proper <code>eriqande</code> GitHub password.</p>
</div>
<div id="using-git-on-the-remote-server" class="section level4">
<h4><span class="header-section-number">7.2.2.2</span> Using git on the remote server</h4>
<p>When on the server, you don’t have the convenient RStudio interface
to git, so you have to use git commands on the command line. Fortunately
these provide straightforward, command-line analogies to the RStudio
GUI git interface you have become familiar with.</p>
<p>Intead of having an RStudio Git panel that shows you files that are new or
have been modified, etc., you use <code>git status</code> in your repo to give
a text report of the same.</p>
For example, imagine that Figure <a href="working-on-remote-servers.html#fig:git-window">7.1</a> shows an RStudio project Git window describing the status of files in the repository.
<div class="figure" style="text-align: center"><span id="fig:git-window"></span>
<img src="figs/git-window.png" alt="An example of what an RStudio git window might look like." width="482" />
<p class="caption">
FIGURE 7.1: An example of what an RStudio git window might look like.
</p>
</div>
<p>That view is merely showing you a graphical view of the output of
the <code>git status</code> command run at the top level of the repository which
looks like this:</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb198-1"><a href="working-on-remote-servers.html#cb198-1"></a><span class="ex">%</span> git status</span>
<span id="cb198-2"><a href="working-on-remote-servers.html#cb198-2"></a><span class="ex">On</span> branch master</span>
<span id="cb198-3"><a href="working-on-remote-servers.html#cb198-3"></a><span class="ex">Changes</span> not staged for commit:</span>
<span id="cb198-4"><a href="working-on-remote-servers.html#cb198-4"></a>  <span class="kw">(</span><span class="ex">use</span> <span class="st">&quot;git add &lt;file&gt;...&quot;</span> to update what will be committed<span class="kw">)</span></span>
<span id="cb198-5"><a href="working-on-remote-servers.html#cb198-5"></a>  <span class="kw">(</span><span class="ex">use</span> <span class="st">&quot;git checkout -- &lt;file&gt;...&quot;</span> to discard changes in working directory<span class="kw">)</span></span>
<span id="cb198-6"><a href="working-on-remote-servers.html#cb198-6"></a></span>
<span id="cb198-7"><a href="working-on-remote-servers.html#cb198-7"></a>    <span class="ex">modified</span>:   .gitignore</span>
<span id="cb198-8"><a href="working-on-remote-servers.html#cb198-8"></a>    <span class="ex">modified</span>:   002-homeologue-permutation-with-bedr.Rmd</span>
<span id="cb198-9"><a href="working-on-remote-servers.html#cb198-9"></a></span>
<span id="cb198-10"><a href="working-on-remote-servers.html#cb198-10"></a><span class="ex">Untracked</span> files:</span>
<span id="cb198-11"><a href="working-on-remote-servers.html#cb198-11"></a>  <span class="kw">(</span><span class="ex">use</span> <span class="st">&quot;git add &lt;file&gt;...&quot;</span> to include in what will be committed<span class="kw">)</span></span>
<span id="cb198-12"><a href="working-on-remote-servers.html#cb198-12"></a></span>
<span id="cb198-13"><a href="working-on-remote-servers.html#cb198-13"></a>    <span class="ex">002-homeologue-permutation-with-bedr.nb.html</span></span>
<span id="cb198-14"><a href="working-on-remote-servers.html#cb198-14"></a>    <span class="ex">data/</span></span>
<span id="cb198-15"><a href="working-on-remote-servers.html#cb198-15"></a>    <span class="ex">mykiss-rad-project-with-mac-and-devon.Rproj</span></span>
<span id="cb198-16"><a href="working-on-remote-servers.html#cb198-16"></a>    <span class="ex">reconcile/</span></span>
<span id="cb198-17"><a href="working-on-remote-servers.html#cb198-17"></a></span>
<span id="cb198-18"><a href="working-on-remote-servers.html#cb198-18"></a><span class="ex">no</span> changes added to commit (use <span class="st">&quot;git add&quot;</span> and/or <span class="st">&quot;git commit -a&quot;</span>)</span></code></pre></div>
<p>Aha! Be sure to read that and understand that the output tells you which
files are tracked by git and Modified (blue M in RStudio) and which
are untracked (Yellow ? in RStudio).</p>
<p>Of you wanted to see a report of the changes in the files relative
to the currently committed version, you could use <code>git diff</code>, passing
it the file name as an argument. We will see an example of that below…</p>
Now, recall, that in order to commit files to <code>git</code> you first must
<em>stage</em> them. In RStudio you do that by clicking the little button to
the left of the file or directory in the Git window. For example,
if we clicked the buttons for the <code>data/</code> directory, as well as for
<code>.gitignore</code> and <code>002-homeologue-permutation-with-bedr.Rmd</code>, we would
have staged them and it would look like Figure <a href="working-on-remote-servers.html#fig:git-staged">7.2</a>.
<div class="figure" style="text-align: center"><span id="fig:git-staged"></span>
<img src="figs/git-staged.png" alt="An example of what an RStudio git window might look like." width="483" />
<p class="caption">
FIGURE 7.2: An example of what an RStudio git window might look like.
</p>
</div>
<p>In order to do the equivalent operations with <code>git</code> on the command line
you would use the <code>git add</code> command, explicitly naming the files you wish to
<em>stage</em> for committing:</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb199-1"><a href="working-on-remote-servers.html#cb199-1"></a><span class="fu">git</span> add .gitignore 002-homeologue-permutation-with-bedr.Rmd data</span></code></pre></div>
<p>Now, if you check <code>git status</code> you will see:</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb200-1"><a href="working-on-remote-servers.html#cb200-1"></a><span class="ex">%</span> git status</span>
<span id="cb200-2"><a href="working-on-remote-servers.html#cb200-2"></a><span class="ex">On</span> branch master</span>
<span id="cb200-3"><a href="working-on-remote-servers.html#cb200-3"></a><span class="ex">Changes</span> to be committed:</span>
<span id="cb200-4"><a href="working-on-remote-servers.html#cb200-4"></a>  <span class="kw">(</span><span class="ex">use</span> <span class="st">&quot;git reset HEAD &lt;file&gt;...&quot;</span> to unstage<span class="kw">)</span></span>
<span id="cb200-5"><a href="working-on-remote-servers.html#cb200-5"></a></span>
<span id="cb200-6"><a href="working-on-remote-servers.html#cb200-6"></a>    <span class="ex">modified</span>:   .gitignore</span>
<span id="cb200-7"><a href="working-on-remote-servers.html#cb200-7"></a>    <span class="ex">modified</span>:   002-homeologue-permutation-with-bedr.Rmd</span>
<span id="cb200-8"><a href="working-on-remote-servers.html#cb200-8"></a>    <span class="ex">new</span> file:   data/Pearse_Barson_etal_Supp_Table_7.tsv</span>
<span id="cb200-9"><a href="working-on-remote-servers.html#cb200-9"></a>    <span class="ex">new</span> file:   data/high-fst-rad-locus-indices.txt</span>
<span id="cb200-10"><a href="working-on-remote-servers.html#cb200-10"></a></span>
<span id="cb200-11"><a href="working-on-remote-servers.html#cb200-11"></a><span class="ex">Untracked</span> files:</span>
<span id="cb200-12"><a href="working-on-remote-servers.html#cb200-12"></a>  <span class="kw">(</span><span class="ex">use</span> <span class="st">&quot;git add &lt;file&gt;...&quot;</span> to include in what will be committed<span class="kw">)</span></span>
<span id="cb200-13"><a href="working-on-remote-servers.html#cb200-13"></a></span>
<span id="cb200-14"><a href="working-on-remote-servers.html#cb200-14"></a>    <span class="ex">002-homeologue-permutation-with-bedr.nb.html</span></span>
<span id="cb200-15"><a href="working-on-remote-servers.html#cb200-15"></a>    <span class="ex">mykiss-rad-project-with-mac-and-devon.Rproj</span></span>
<span id="cb200-16"><a href="working-on-remote-servers.html#cb200-16"></a>    <span class="ex">reconcile/</span></span></code></pre></div>
<p>It tells you which files are ready to be committed!</p>
<p>In order to commit the files to git you do:</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb201-1"><a href="working-on-remote-servers.html#cb201-1"></a><span class="fu">git</span> commit</span></code></pre></div>
<p>And then, to push them back to GitHub (if you cloned this repository
from GitHub), you can simply do:</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb202-1"><a href="working-on-remote-servers.html#cb202-1"></a><span class="fu">git</span> push origin master</span></code></pre></div>
<p>That syntax is telling git to push the <code>master</code> branch (which is
the default branch in a git repository), to the repository labeled as
<code>origin</code>, which will be the GitHub repository if you cloned the repository
from GitHub. (If you are working with a different git branch than master,
you would need to specify its name here. That is not difficult, but is
beyond the scope of this chapter.)</p>
<p>Now, assuming that we cloned the <code>alignment-play</code> repository to our
server, here are the steps involved in editing a file, committing the
changes, and then pushing them back to GitHub. The command in the following
is written as <code>[alignment-play]--%</code> which is telling us that we are in the
<code>alignment-play</code> repository.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb203-1"><a href="working-on-remote-servers.html#cb203-1"></a><span class="co"># check git status</span></span>
<span id="cb203-2"><a href="working-on-remote-servers.html#cb203-2"></a>[<span class="ex">alignment-play</span>]--% git status</span>
<span id="cb203-3"><a href="working-on-remote-servers.html#cb203-3"></a></span>
<span id="cb203-4"><a href="working-on-remote-servers.html#cb203-4"></a><span class="co"># On branch master</span></span>
<span id="cb203-5"><a href="working-on-remote-servers.html#cb203-5"></a><span class="ex">nothing</span> to commit, working directory clean</span>
<span id="cb203-6"><a href="working-on-remote-servers.html#cb203-6"></a></span>
<span id="cb203-7"><a href="working-on-remote-servers.html#cb203-7"></a><span class="co"># Aha! That says nothing has been modified.</span></span>
<span id="cb203-8"><a href="working-on-remote-servers.html#cb203-8"></a><span class="co"># But, now we edit the file alignment-play.Rmd</span></span>
<span id="cb203-9"><a href="working-on-remote-servers.html#cb203-9"></a>[<span class="ex">alignment-play</span>]--% nano alignment-play.Rmd</span>
<span id="cb203-10"><a href="working-on-remote-servers.html#cb203-10"></a></span>
<span id="cb203-11"><a href="working-on-remote-servers.html#cb203-11"></a><span class="co"># In this case I merely added a line to the YAML header.</span></span>
<span id="cb203-12"><a href="working-on-remote-servers.html#cb203-12"></a></span>
<span id="cb203-13"><a href="working-on-remote-servers.html#cb203-13"></a><span class="co"># Now, check status of the files:</span></span>
<span id="cb203-14"><a href="working-on-remote-servers.html#cb203-14"></a>[<span class="ex">alignment-play</span>]--% git status</span>
<span id="cb203-15"><a href="working-on-remote-servers.html#cb203-15"></a></span>
<span id="cb203-16"><a href="working-on-remote-servers.html#cb203-16"></a><span class="co"># On branch master</span></span>
<span id="cb203-17"><a href="working-on-remote-servers.html#cb203-17"></a><span class="co"># Changes not staged for commit:</span></span>
<span id="cb203-18"><a href="working-on-remote-servers.html#cb203-18"></a><span class="co">#   (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span></span>
<span id="cb203-19"><a href="working-on-remote-servers.html#cb203-19"></a><span class="co">#   (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span></span>
<span id="cb203-20"><a href="working-on-remote-servers.html#cb203-20"></a><span class="co">#</span></span>
<span id="cb203-21"><a href="working-on-remote-servers.html#cb203-21"></a><span class="co">#   modified:   alignment-play.Rmd</span></span>
<span id="cb203-22"><a href="working-on-remote-servers.html#cb203-22"></a><span class="co">#</span></span>
<span id="cb203-23"><a href="working-on-remote-servers.html#cb203-23"></a><span class="ex">no</span> changes added to commit (use <span class="st">&quot;git add&quot;</span> and/or <span class="st">&quot;git commit -a&quot;</span>)</span>
<span id="cb203-24"><a href="working-on-remote-servers.html#cb203-24"></a></span>
<span id="cb203-25"><a href="working-on-remote-servers.html#cb203-25"></a><span class="co"># We see that the file has been modified.</span></span>
<span id="cb203-26"><a href="working-on-remote-servers.html#cb203-26"></a></span>
<span id="cb203-27"><a href="working-on-remote-servers.html#cb203-27"></a><span class="co"># Now we can use git diff to see what the changes were</span></span>
<span id="cb203-28"><a href="working-on-remote-servers.html#cb203-28"></a>[<span class="ex">alignment-play</span>]--% git diff alignment-play.Rmd </span>
<span id="cb203-29"><a href="working-on-remote-servers.html#cb203-29"></a></span>
<span id="cb203-30"><a href="working-on-remote-servers.html#cb203-30"></a><span class="fu">diff</span> --git a/alignment-play.Rmd b/alignment-play.Rmd</span>
<span id="cb203-31"><a href="working-on-remote-servers.html#cb203-31"></a><span class="ex">index</span> 9f75ebb..b389fae 100644</span>
<span id="cb203-32"><a href="working-on-remote-servers.html#cb203-32"></a><span class="ex">---</span> a/alignment-play.Rmd</span>
<span id="cb203-33"><a href="working-on-remote-servers.html#cb203-33"></a><span class="ex">+++</span> b/alignment-play.Rmd</span>
<span id="cb203-34"><a href="working-on-remote-servers.html#cb203-34"></a><span class="ex">@@</span> -3,6 +3,7 @@ title: <span class="st">&quot;Alignment Play!&quot;</span></span>
<span id="cb203-35"><a href="working-on-remote-servers.html#cb203-35"></a> <span class="ex">output</span>: </span>
<span id="cb203-36"><a href="working-on-remote-servers.html#cb203-36"></a>   <span class="ex">html_notebook</span>:</span>
<span id="cb203-37"><a href="working-on-remote-servers.html#cb203-37"></a>     <span class="ex">toc</span>: true</span>
<span id="cb203-38"><a href="working-on-remote-servers.html#cb203-38"></a><span class="ex">+</span>    toc_float: true</span>
<span id="cb203-39"><a href="working-on-remote-servers.html#cb203-39"></a> <span class="ex">---</span></span>
<span id="cb203-40"><a href="working-on-remote-servers.html#cb203-40"></a> </span>
<span id="cb203-41"><a href="working-on-remote-servers.html#cb203-41"></a><span class="co"># The output above is a little hard to parse, but it shows</span></span>
<span id="cb203-42"><a href="working-on-remote-servers.html#cb203-42"></a><span class="co"># the line that has been added: &quot;  toc_float: true&quot; with a</span></span>
<span id="cb203-43"><a href="working-on-remote-servers.html#cb203-43"></a><span class="co"># &quot;+&quot; sign.</span></span>
<span id="cb203-44"><a href="working-on-remote-servers.html#cb203-44"></a></span>
<span id="cb203-45"><a href="working-on-remote-servers.html#cb203-45"></a><span class="co"># In order to commit the changes, we do:</span></span>
<span id="cb203-46"><a href="working-on-remote-servers.html#cb203-46"></a>[<span class="ex">alignment-play</span>]--% git add alignment-play.Rmd </span>
<span id="cb203-47"><a href="working-on-remote-servers.html#cb203-47"></a>[<span class="ex">alignment-play</span>]--% git commit</span>
<span id="cb203-48"><a href="working-on-remote-servers.html#cb203-48"></a></span>
<span id="cb203-49"><a href="working-on-remote-servers.html#cb203-49"></a><span class="co"># after that, we are bumped into the nano text editor</span></span>
<span id="cb203-50"><a href="working-on-remote-servers.html#cb203-50"></a><span class="co"># to write a short message about the commit. After exiting</span></span>
<span id="cb203-51"><a href="working-on-remote-servers.html#cb203-51"></a><span class="co"># from the editor, it tells us:</span></span>
<span id="cb203-52"><a href="working-on-remote-servers.html#cb203-52"></a>[<span class="ex">master</span> 001e650] yaml change</span>
<span id="cb203-53"><a href="working-on-remote-servers.html#cb203-53"></a> <span class="ex">1</span> file changed, 1 insertion(+)</span>
<span id="cb203-54"><a href="working-on-remote-servers.html#cb203-54"></a> </span>
<span id="cb203-55"><a href="working-on-remote-servers.html#cb203-55"></a><span class="co"># Now, to send that new commit to GitHub, we use git push origin master</span></span>
<span id="cb203-56"><a href="working-on-remote-servers.html#cb203-56"></a>[<span class="ex">alignment-play</span>]--% git push origin master</span>
<span id="cb203-57"><a href="working-on-remote-servers.html#cb203-57"></a><span class="ex">Password</span> for <span class="st">&#39;https://eriqande@github.com&#39;</span>:</span>
<span id="cb203-58"><a href="working-on-remote-servers.html#cb203-58"></a></span>
<span id="cb203-59"><a href="working-on-remote-servers.html#cb203-59"></a><span class="ex">Counting</span> objects: 5, done.</span>
<span id="cb203-60"><a href="working-on-remote-servers.html#cb203-60"></a><span class="ex">Delta</span> compression using up to 24 threads.</span>
<span id="cb203-61"><a href="working-on-remote-servers.html#cb203-61"></a><span class="ex">Compressing</span> objects: 100% (3/3), <span class="kw">done</span><span class="ex">.</span></span>
<span id="cb203-62"><a href="working-on-remote-servers.html#cb203-62"></a><span class="ex">Writing</span> objects: 100% (3/3), <span class="ex">325</span> bytes <span class="kw">|</span> <span class="ex">0</span> bytes/s, done.</span>
<span id="cb203-63"><a href="working-on-remote-servers.html#cb203-63"></a><span class="ex">Total</span> 3 (delta 2), <span class="ex">reused</span> 0 (delta 0)</span>
<span id="cb203-64"><a href="working-on-remote-servers.html#cb203-64"></a><span class="ex">remote</span>: Resolving deltas: 100% (2/2), <span class="ex">completed</span> with 2 local objects.</span>
<span id="cb203-65"><a href="working-on-remote-servers.html#cb203-65"></a><span class="ex">To</span> https://eriqande@github.com/eriqande/alignment-play</span>
<span id="cb203-66"><a href="working-on-remote-servers.html#cb203-66"></a>   <span class="ex">0c1707f..001e650</span>  master -<span class="op">&gt;</span> master</span></code></pre></div>
<p>When pushing to a GitHub repository for the first
time from your remote server you
will be asked for your GitHub password. Once you have successfully
provided your password, if you set password caching up correctly, then
you should not have to provide your password for subsequent pushes.</p>
<p>Finally, if after pushing those changes to GitHub, we then pull them
down to our laptop, and make more changes on top of them and push those
back to GitHub, we can retrieve from GitHub to the server those changes we
made on our laptop with <code>git pull origin master</code>. In other words, from the
server we simply issue the command:</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb204-1"><a href="working-on-remote-servers.html#cb204-1"></a>[<span class="ex">alignment-play</span>]--% git pull origin master</span></code></pre></div>
</div>
</div>
<div id="globus" class="section level3">
<h3><span class="header-section-number">7.2.3</span> Globus</h3>
</div>
<div id="interfacing-with-the-cloud" class="section level3">
<h3><span class="header-section-number">7.2.4</span> Interfacing with “The Cloud”</h3>
<p>Increasingly, data scientists and tech companies alike are keeping their
data “in the cloud.” This means that they
pay a large tech firm like Amazon, Dropbox, or Google to store their data for them in
a place that can be accessed via the internet. There are many advantages to this
model. For one thing, the company that serves the data often will create multiple copies
of the data for backup and redundancy: a fire in a single data center is not a calamity
because the data are also stored elsewhere, and can often be accessed seamlessly from those
other locations with no apparent disruption of service. For another, companies that are
in the business of storing and serving
data to multiple clients have data centers that are well-networked, so that getting
data onto and off of their storage systems can be done very quickly over the internet
by an end-user with a good internet connection.</p>
<p>Five years ago, the idea of storing next generation sequencing data might have
sounded a little
crazy—it always seemed a laborious task getting the data off of the remote server at the
sequencing center, so why not just keep the data in-house once you have it?
To be sure, keeping a copy of your
data in-house still can make sense for long-term data archiving needs, but, today, cloud
storage for your sequencing data can make a lot of sense. A few reasons are:</p>
<ol style="list-style-type: decimal">
<li>Transferring your data from the cloud to the remote HPC system
that you use to process the data can be very fast.</li>
<li>As above, your data can be redundantly backed up.</li>
<li>If your institution (university, agency, etc.) has an agreement with a cloud storage
service that provides you with unlimited storage and free network access, then storing
your sequencing data in the cloud will cost considerably less than buying a dedicated
large system of hard drives for data backup. (One must wonder if service
agreements might not be at risk of renegotiation if many researchers start using their
unlimited institutional cloud storage space to store and/or archive their
next generation sequencing data sets. My own agency’s contract with Google runs
through 2021…but I have to think that these services are making plenty of money, even
if a handful of researchers store big sequence data in the cloud. Nonetheless, you
should be careful not to put multiple copies of data sets, or intermediate files that
are easily regenerated, up in the cloud.)</li>
<li>If you are a PI with many lab members wishing to access the same data set, or even if
you are just a regular Joe/Joanna researcher but you wish to share your data, it is
possible to effect that using your cloud service’s sharing settings. We will discuss
how to do this with Google Drive.</li>
</ol>
<p>There are clearly advantages to using the cloud, but one small hurdle remains. Most
of the time, working in an HPC environment, we are using Unix, which provides a consistent
set of tools for interfacing with other computers using SSH-based protocols (like <code>scp</code>
for copying files from one remote computer to another). Unfortunately, many common
cloud storage services do not offer an SSH based interface. Rather, they typically process
requests from clients using an HTTPS protocol. This protocol, which effectively runs the
world-wide web, is a natural choice for cloud services that most people will access
using a web browser; however, Unix does not traditionally come with a utility or command
to easily process the types of HTTPS transactions needed to network with
cloud storage. Furthermore, there must be some security when it comes to accessing
your cloud-based storage—you don’t want everyone to be able to access your files, so
your cloud service needs to have some way of authenticating people
(you and your labmates for example) that are authorized to access your data.</p>
<p>These problems have been overcome by a utility called <code>rclone</code>, the product of a
comprehensive open-source software project that brings the functionality of the
<code>rsync</code> utility (a common Unix tool used to synchronize and mirror file systems)
to cloud-based storage. (Note: <code>rclone</code> has nothing to do with the R programming
language, despite its name that looks like an R package.)
Currently <code>rclone</code> provides a consistent interface for accessing
files from over 35 different cloud storage providers, including Box, Dropbox, Google Drive,
and Microsoft OneDrive. Binaries for <code>rclone</code> can be downloaded for your desktop
machine from <a href="https://rclone.org/downloads/">https://rclone.org/downloads/</a>. We will
talk about how to install it on your HPC system later.</p>
<p>Once <code>rclone</code> is installed and in your <code>PATH</code>, you invoke it in your terminal
with the command <code>rclone</code>. Before we get into the details of the various <code>rclone</code> subcommands,
it will be helpful to take a glance at the information <code>rclone</code> records when it
configures itself to talk to your cloud service. To do so, it creates a file called <code>~/.config/rclone/rclone.conf</code>, where it stores information about all the different
connections to cloud services you have set up. For example, that
file on my system looks like this:</p>
<pre><code>[gdrive-rclone]
type = drive
scope = drive
root_folder_id = 1I2EDV465N5732Tx1FFAiLWOqZRJcAzUd
token = {&quot;access_token&quot;:&quot;bs43.94cUFOe6SjjkofZ&quot;,&quot;token_type&quot;:&quot;Bearer&quot;,&quot;refresh_token&quot;:&quot;1/MrtfsRoXhgc&quot;,&quot;expiry&quot;:&quot;2019-04-29T22:51:58.148286-06:00&quot;}
client_id = 2934793-oldk97lhld88dlkh301hd.apps.googleusercontent.com
client_secret = MMq3jdsjdjgKTGH4rNV_y-NbbG</code></pre>
<p>In this configuration:</p>
<ul>
<li><code>gdrive-rclone</code> is the name by which rclone refers to this cloud storage location</li>
<li><code>root_folder_id</code> is the ID of the Google Drive folder that can be thought of as the root directory of <code>gdrive-rclone</code>. This ID is not the simple name of that directory on
your Google Drive, rather it is the unique name given by Google Drive to that directory.
You can see it by navigating in your browser to the directory you want and finding it
after the last slash in the URL. For example, in the above case, the URL is:
<code>https://drive.google.com/drive/u/1/folders/1I2EDV465N5732Tx1FFAiLWOqZRJcAzUd</code></li>
<li><code>client_id</code> and <code>client_secret</code> are like a username and a shared secret that <code>rclone</code> uses
to authenticate the user to Google Drive as who they say they are.</li>
<li><code>token</code> are the credentials used by <code>rclone</code> to make requests of Google Drive on the basis
of the user.</li>
</ul>
<p>Note: the above does not include my
real credentials, as then anyone could use them to access my Google Drive!</p>
<p>To set up your own configuration file to use Google Drive, you will use the <code>rclone config</code>
command, but before you do that, you will want to wrangle a client_id from Google. Follow
the directions at <a href="https://rclone.org/drive/#making-your-own-client-id">https://rclone.org/drive/#making-your-own-client-id</a>. Things are a little different from in their step
by step, but you can muddle through to get to a screen with a client_ID and a client
secret that you can copy onto your clipboard.</p>
<p>Once you have done that, then run <code>rclone config</code> and follow the prompts. A
typical session of <code>rclone config</code> for Google Drive access is given
<a href="https://rclone.org/drive/">here</a>. Don’t choose to do the advanced setup; however
do use “auto config,” which will bounce up a web page and let you authenticate rclone
to your Google account.</p>
<p>It is worthwhile first setting up a config file on your laptop, and making sure
that it is working. After that, you can copy that config file to other remote
servers you work on and immediately have the same functionality.</p>
<div id="encrypting-your-config-file" class="section level4">
<h4><span class="header-section-number">7.2.4.1</span> Encrypting your config file</h4>
<p>While it is a powerful thing to be able to copy a config file from
one computer to the next and immediately be able to access your Google
Drive account. That might (and should) also make you a little bit
uneasy. It means that if the config file falls into the wrong hands,
whoever has it can gain access to everything on your Google Drive. Clearly
this is not good. Consequently, once you have created your rclone config
file, and well before you transfer it to another computer, you must
encrypt it. This makes sense, and fortunately it is fairly easy: you can
use <code>rclone config</code> and see that encryption is one of
the options. When it is encrypted, use <code>rclone config show</code> to see what
it looks like in clear text.</p>
<p>The downside of using encryption is that you have to enter your password
every time you make an rclone command, but it is worth it to have the
security.</p>
<p>Here is what it looks like when choosing to encrypt one’s config file:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb206-1"><a href="working-on-remote-servers.html#cb206-1"></a><span class="ex">%</span> rclone config</span>
<span id="cb206-2"><a href="working-on-remote-servers.html#cb206-2"></a><span class="ex">Current</span> remotes:</span>
<span id="cb206-3"><a href="working-on-remote-servers.html#cb206-3"></a></span>
<span id="cb206-4"><a href="working-on-remote-servers.html#cb206-4"></a><span class="ex">Name</span>                 Type</span>
<span id="cb206-5"><a href="working-on-remote-servers.html#cb206-5"></a>====                 ====</span>
<span id="cb206-6"><a href="working-on-remote-servers.html#cb206-6"></a><span class="ex">gdrive-rclone</span>        drive</span>
<span id="cb206-7"><a href="working-on-remote-servers.html#cb206-7"></a></span>
<span id="cb206-8"><a href="working-on-remote-servers.html#cb206-8"></a><span class="ex">e</span>) <span class="ex">Edit</span> existing remote</span>
<span id="cb206-9"><a href="working-on-remote-servers.html#cb206-9"></a><span class="ex">n</span>) <span class="ex">New</span> remote</span>
<span id="cb206-10"><a href="working-on-remote-servers.html#cb206-10"></a><span class="ex">d</span>) <span class="ex">Delete</span> remote</span>
<span id="cb206-11"><a href="working-on-remote-servers.html#cb206-11"></a><span class="ex">r</span>) <span class="ex">Rename</span> remote</span>
<span id="cb206-12"><a href="working-on-remote-servers.html#cb206-12"></a><span class="ex">c</span>) <span class="ex">Copy</span> remote</span>
<span id="cb206-13"><a href="working-on-remote-servers.html#cb206-13"></a><span class="ex">s</span>) <span class="ex">Set</span> configuration password</span>
<span id="cb206-14"><a href="working-on-remote-servers.html#cb206-14"></a><span class="ex">q</span>) <span class="ex">Quit</span> config</span>
<span id="cb206-15"><a href="working-on-remote-servers.html#cb206-15"></a><span class="ex">e/n/d/r/c/s</span>/<span class="ex">q</span><span class="op">&gt;</span> s </span>
<span id="cb206-16"><a href="working-on-remote-servers.html#cb206-16"></a><span class="ex">Your</span> configuration is not encrypted.</span>
<span id="cb206-17"><a href="working-on-remote-servers.html#cb206-17"></a><span class="ex">If</span> you add a password, you will protect your login information to cloud services.</span>
<span id="cb206-18"><a href="working-on-remote-servers.html#cb206-18"></a><span class="ex">a</span>) <span class="ex">Add</span> Password</span>
<span id="cb206-19"><a href="working-on-remote-servers.html#cb206-19"></a><span class="ex">q</span>) <span class="ex">Quit</span> to main menu</span>
<span id="cb206-20"><a href="working-on-remote-servers.html#cb206-20"></a><span class="ex">a</span>/<span class="ex">q</span><span class="op">&gt;</span> a</span>
<span id="cb206-21"><a href="working-on-remote-servers.html#cb206-21"></a><span class="ex">Enter</span> NEW configuration password:</span>
<span id="cb206-22"><a href="working-on-remote-servers.html#cb206-22"></a><span class="ex">password</span>:</span>
<span id="cb206-23"><a href="working-on-remote-servers.html#cb206-23"></a><span class="ex">Confirm</span> NEW configuration password:</span>
<span id="cb206-24"><a href="working-on-remote-servers.html#cb206-24"></a><span class="ex">password</span>:</span>
<span id="cb206-25"><a href="working-on-remote-servers.html#cb206-25"></a><span class="ex">Password</span> set</span>
<span id="cb206-26"><a href="working-on-remote-servers.html#cb206-26"></a><span class="ex">Your</span> configuration is encrypted.</span>
<span id="cb206-27"><a href="working-on-remote-servers.html#cb206-27"></a><span class="ex">c</span>) <span class="ex">Change</span> Password</span>
<span id="cb206-28"><a href="working-on-remote-servers.html#cb206-28"></a><span class="ex">u</span>) <span class="ex">Unencrypt</span> configuration</span>
<span id="cb206-29"><a href="working-on-remote-servers.html#cb206-29"></a><span class="ex">q</span>) <span class="ex">Quit</span> to main menu</span>
<span id="cb206-30"><a href="working-on-remote-servers.html#cb206-30"></a><span class="ex">c/u</span>/<span class="ex">q</span><span class="op">&gt;</span> q</span>
<span id="cb206-31"><a href="working-on-remote-servers.html#cb206-31"></a><span class="ex">Current</span> remotes:</span>
<span id="cb206-32"><a href="working-on-remote-servers.html#cb206-32"></a></span>
<span id="cb206-33"><a href="working-on-remote-servers.html#cb206-33"></a><span class="ex">Name</span>                 Type</span>
<span id="cb206-34"><a href="working-on-remote-servers.html#cb206-34"></a>====                 ====</span>
<span id="cb206-35"><a href="working-on-remote-servers.html#cb206-35"></a><span class="ex">gdrive-rclone</span>        drive</span>
<span id="cb206-36"><a href="working-on-remote-servers.html#cb206-36"></a></span>
<span id="cb206-37"><a href="working-on-remote-servers.html#cb206-37"></a><span class="ex">e</span>) <span class="ex">Edit</span> existing remote</span>
<span id="cb206-38"><a href="working-on-remote-servers.html#cb206-38"></a><span class="ex">n</span>) <span class="ex">New</span> remote</span>
<span id="cb206-39"><a href="working-on-remote-servers.html#cb206-39"></a><span class="ex">d</span>) <span class="ex">Delete</span> remote</span>
<span id="cb206-40"><a href="working-on-remote-servers.html#cb206-40"></a><span class="ex">r</span>) <span class="ex">Rename</span> remote</span>
<span id="cb206-41"><a href="working-on-remote-servers.html#cb206-41"></a><span class="ex">c</span>) <span class="ex">Copy</span> remote</span>
<span id="cb206-42"><a href="working-on-remote-servers.html#cb206-42"></a><span class="ex">s</span>) <span class="ex">Set</span> configuration password</span>
<span id="cb206-43"><a href="working-on-remote-servers.html#cb206-43"></a><span class="ex">q</span>) <span class="ex">Quit</span> config</span>
<span id="cb206-44"><a href="working-on-remote-servers.html#cb206-44"></a><span class="ex">e/n/d/r/c/s</span>/<span class="ex">q</span><span class="op">&gt;</span> q</span></code></pre></div>
<p>Once that file is encrypted, you can copy it to other machines for use.</p>
</div>
<div id="basic-maneuvers" class="section level4">
<h4><span class="header-section-number">7.2.4.2</span> Basic Maneuvers</h4>
<p>The syntax for use is:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb207-1"><a href="working-on-remote-servers.html#cb207-1"></a><span class="ex">rclone</span> [options] subcommand  parameter1 [parameter 2...]</span></code></pre></div>
<p>The “subcommand” part tells <code>rclone</code> what you want to do, like <code>copy</code> or <code>sync</code>, and
the “parameter” part of the above syntax is typically a path
specification to a directory or a file. In using rclone to access the
cloud there is not a root directory, like <code>/</code> in Unix. Instead, each remote
cloud access point is treated as the root directory, and you refer to it
by the name of the configuration followed by a colon. In our example,
<code>gdrive-rclone:</code> is the root, and we don’t need to add a <code>/</code> after it to
start a path with it. Thus <code>gdrive-rclone:this_dir/that_dir</code> is a
valid path for <code>rclone</code> to a location on my Google Drive.</p>
<p>Very often when moving, copying, or syncing files, the parameters
consist of:</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode s"><code class="sourceCode gnuassembler"><span id="cb208-1"><a href="working-on-remote-servers.html#cb208-1"></a>source-directory  destination-directory</span></code></pre></div>
<p>One very important point is that, unlike the Unix commands <code>cp</code> and <code>mv</code>, rclone
likes to operate on directories, not on multiple named files.</p>
<p>A few key subcommands:</p>
<ul>
<li><code>ls</code>, <code>lsd</code>, and <code>lsl</code> are like <code>ls</code>, <code>ls -d</code> and <code>ls -l</code></li>
</ul>
<div class="sourceCode" id="cb209"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb209-1"><a href="working-on-remote-servers.html#cb209-1"></a><span class="ex">rclone</span>  lsd gdrive-rclone:</span>
<span id="cb209-2"><a href="working-on-remote-servers.html#cb209-2"></a><span class="ex">rclone</span>  lsd gdrive-rclone:NOFU</span></code></pre></div>
<ul>
<li><code>copy</code>: copy the <em>contents</em> of a source <em>directory</em> to a destination <em>directory</em>. One super cool
thing about this is that <code>rclone</code> won’t re-copy files that are already on the destination and which
are identical to those in the source directory.</li>
</ul>
<div class="sourceCode" id="cb210"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb210-1"><a href="working-on-remote-servers.html#cb210-1"></a><span class="ex">rclone</span> copy bams gdrive-rclone:NOFU/bams</span></code></pre></div>
<p>Note that the destination directory will be created if it does not already exist.<br />
- <code>sync</code>: make the contents of the destination directory look just like the
contents of the source directory. <em>WARNING</em> This will delete files in the destination
directory that do not appear in the source directory.</p>
<p>A few key options:</p>
<ul>
<li><code>--dry-run</code>: don’t actually copy, sync, or move anything. Just tell me what you would have done.</li>
<li><code>--progress</code>: give me progress information when files are being copied.
This will tell you which file is being transferred, the rate at which
files are being transferred, and and estimated amount of time for all the
files to be transferred.</li>
<li><code>--tpslimit 10</code>: don’t make any more than 10 transactions a second with Google Drive (should always be used when transferring files)</li>
<li><code>---fast-list</code>: combine multiple transactions together. Should always be used with Google Drive,
especially when handling lots of files.</li>
<li><code>--drive-shared-with-me</code>: make the “root” directory a directory that shows all
of the Google Drive folders that people have shared with you. This is key for accessing
folders that have been shared with you.</li>
</ul>
<p>For example, try something like:</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb211-1"><a href="working-on-remote-servers.html#cb211-1"></a><span class="ex">rclone</span> --drive-shared-with-me lsd gdrive-rclone:</span></code></pre></div>
<p><strong>Important Configuration Notes!!</strong> Rather than always giving the <code>--progress</code>
option on the command line, or always having to remember to use
<code>--fast-list</code> and <code>--tpslimit 10</code> (and remember what they should be…),
you can set those options to be invoked “by default” whenever you use
rclone. The developers of <code>rclone</code> have made this possible
by setting <em>environment variables</em> in your <code>~/.bashrc</code>.</p>
<p>If you have an rclone option called <code>--fast-limit</code>, then the corresponding
environment variable is named <code>RCLONE_FAST_LIMIT</code>—basically, you
start with <code>RCLONE_</code> then you just
drop the first two dashes of the option name, replace the remaining dashes
with underscores, and turn it all into uppercase to make the
environment variable. So, you should, at a minimum add these
lines to your <code>~/.bashrc</code>:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb212-1"><a href="working-on-remote-servers.html#cb212-1"></a><span class="co"># Environment variables to use with rclone/google drive always</span></span>
<span id="cb212-2"><a href="working-on-remote-servers.html#cb212-2"></a><span class="bu">export</span> <span class="va">RCLONE_TPSLIMIT=</span>10</span>
<span id="cb212-3"><a href="working-on-remote-servers.html#cb212-3"></a><span class="bu">export</span> <span class="va">RCLONE_FAST_LIST=</span>true</span>
<span id="cb212-4"><a href="working-on-remote-servers.html#cb212-4"></a><span class="bu">export</span> <span class="va">RCLONE_PROGRESS=</span>true</span></code></pre></div>
</div>
<div id="rclone-filter" class="section level4">
<h4><span class="header-section-number">7.2.4.3</span> filtering: Be particular about the files you transfer</h4>
<p><code>rclone</code> works a little differently than the Unix utility <code>cp</code>. In particular,
<code>rclone</code> is not set up very well to copy individual files. While there is a
an <code>rclone</code> command known as <code>copyto</code> that will allow you copy a single file,
you cannot (apparently) specify multiple, individual files that you wish to copy.</p>
<p>In other words, you can’t do:</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb213-1"><a href="working-on-remote-servers.html#cb213-1"></a><span class="ex">rclone</span> copyto this_file.txt that_file.txt another_file.bam gdrive-rclone:dest_dir</span></code></pre></div>
<p>In general, you will be better off using <code>rclone</code> to copy the <em>contents</em> of a directory
to the inside of the destination directory. However, there are options in <code>rclone</code> that
can keep you from being totally indiscriminate about the files you transfer. In other words,
you can <em>filter</em> the files that get transferred. You can read about that at
<a href="https://rclone.org/filtering/">https://rclone.org/filtering/</a>.</p>
<p>For a quick example, imagine that you have a directory called <code>Data</code> on you Google Drive
that contains both VCF and BAM files. You want to get only the VCF files (ending with <code>.vcf.gz</code>, say)
onto the current working directory on your cluster. Then something like this works:</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb214-1"><a href="working-on-remote-servers.html#cb214-1"></a><span class="ex">rclone</span> copy --include *.vcf.gz gdrive-rclone:Data ./</span></code></pre></div>
<p>Note that, if you are issuing this command on a Unix system in a directory
where the pattern <code>*.vcf.gz</code> will expand (by globbing) to multiple files, you will
get an error. In that case, wrap the pattern in a pair of single quotes to keep
the shell from expanding it, like this:</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb215-1"><a href="working-on-remote-servers.html#cb215-1"></a><span class="ex">rclone</span> copy --include <span class="st">&#39;*.vcf.gz&#39;</span> gdrive-rclone:Data ./</span></code></pre></div>
</div>
<div id="feel-free-to-make-lots-of-configurations" class="section level4">
<h4><span class="header-section-number">7.2.4.4</span> Feel free to make lots of configurations</h4>
<p>You might want to configure a remote for each directory-specific project.
You can do that by just editing the configuration file. For example,
if I had a directory deep within my Google Drive, inside a chain of folders that
looked like, say, <code>Projects/NGS/Species/Salmon/Chinook/CentralValley/WinterRun</code>
where I was keeping
all my data on a project concerning winter-run Chinook salmon, then it would be
quite inconvenient to type <code>Projects/NGS/Species/Salmon/Chinook/CentralValley/WinterRun</code>
every time I wanted to copy or sync something within that directory. Instead,
I could add the following
lines to my configuration file, essentially copying the existing configuration and
then modifying the configuration name and the <code>root_folder_id</code> to be the
Google Drive identifier for the folder <code>Projects/NGS/Species/Salmon/Chinook/CentralValley/WinterRun</code> (which
one can find by navigating to that folder in a web browser and pulling the ID from the
end of the URL.) The updated configuration could look like:</p>
<pre><code>[gdrive-winter-run]
type = drive
scope = drive
root_folder_id = 1MjOrclmP1udhxOTvLWDHFBVET1dF6CIn
token = {&quot;access_token&quot;:&quot;bs43.94cUFOe6SjjkofZ&quot;,&quot;token_type&quot;:&quot;Bearer&quot;,&quot;refresh_token&quot;:&quot;1/MrtfsRoXhgc&quot;,&quot;expiry&quot;:&quot;2019-04-29T22:51:58.148286-06:00&quot;}
client_id = 2934793-oldk97lhld88dlkh301hd.apps.googleusercontent.com
client_secret = MMq3jdsjdjgKTGH4rNV_y-NbbG</code></pre>
<p>As long as the directory is still within the same Google Drive account, you can re-use
all the authorization information, and just change the <code>[name]</code> part and the <code>root_folder_id</code>.
Now this:</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb217-1"><a href="working-on-remote-servers.html#cb217-1"></a><span class="ex">rclone</span> copy src_dir gdrive-winter-run: </span></code></pre></div>
<p>puts items into <code>Projects/NGS/Species/Salmon/Chinook/CentralValley/WinterRun</code> on the Google Drive
without having to type that God-awful long path name.</p>
</div>
<div id="installing-rclone-on-a-remote-machine-without-sudo-access" class="section level4">
<h4><span class="header-section-number">7.2.4.5</span> Installing rclone on a remote machine without sudo access</h4>
<p>The instructions on the website require root access. You don’t have to have root
access to install rclone locally in your home directory somewhere.
Copy the download link from <a href="https://rclone.org/downloads/">https://rclone.org/downloads/</a> for
the type of operating system your remote machine uses (most likely Linux if it is a cluster).
Then transfer that with <code>wget</code>, unzip it and put the binary in your PATH. It will look
something like this:</p>
<pre><code>wget https://downloads.rclone.org/rclone-current-linux-amd64.zip
unzip rclone-current-linux-amd64.zip
cp rclone-current-linux-amd64/rclone ~/bin</code></pre>
<p>You won’t get manual pages on your system, but you can always find the docs on the web.</p>
</div>
<div id="setting-up-configurations-on-the-remote-machine" class="section level4">
<h4><span class="header-section-number">7.2.4.6</span> Setting up configurations on the remote machine…</h4>
<p>Is as easy as copying your config file to where it should go, which
is easy to find using the command:</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb219-1"><a href="working-on-remote-servers.html#cb219-1"></a><span class="ex">rclone</span> config file</span></code></pre></div>
</div>
<div id="some-other-usage-tips" class="section level4">
<h4><span class="header-section-number">7.2.4.7</span> Some other usage tips</h4>
<p>Following an email exchange with Ren, I should mention how to do an md5
checksum on the remote server to make sure that everything is correctly there.</p>
</div>
</div>
<div id="get-seqs" class="section level3">
<h3><span class="header-section-number">7.2.5</span> Getting files from a sequencing center</h3>
<p>Very often sequencing centers will post all the data from a single
run of a machine at a secured (or unsecured) http address. You will
need to download those files to operate on them on your cluster or
local machine. However some of the files available on the server
will likely belong to other researchers and you don’t want to waste time
downloading them.</p>
<p>Let’s take an example. Suppose you are sent an email from the sequencing
center that says something like:</p>
<blockquote>
<p>Your samples are AW_F1 (female) and AW_M1 (male).
You should be able to access the data from this link provided by YCGA:
<a href="http://sysg1.cs.yale.edu:3010/5lnO9bs3zfa8LOhESfsYfq3Dc/061719/" class="uri">http://sysg1.cs.yale.edu:3010/5lnO9bs3zfa8LOhESfsYfq3Dc/061719/</a></p>
</blockquote>
<p>You can easily access this web address using <code>rclone</code>. You could set up a new
remote in your rclone config to point to <code>http://sysg1.cs.yale.edu</code>,
but, since you will only be using this once, to get your data, it makes
more sense to just specify the remote on the command line. This can be
done by passing <code>rclone</code> the URL address via the <code>--http-url</code> option, and
then, after that, telling it what protocol to use by adding <code>:http:</code> to
the command. Here is what you would use to list the directories available
at the sequencing center URL:</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb220-1"><a href="working-on-remote-servers.html#cb220-1"></a><span class="co"># here is the command</span></span>
<span id="cb220-2"><a href="working-on-remote-servers.html#cb220-2"></a><span class="ex">%</span> rclone lsd --http-url http://sysg1.cs.yale.edu:3010/5lnO9bs3zfa8LOhESfsYfq3Dc/061719/ :http:</span>
<span id="cb220-3"><a href="working-on-remote-servers.html#cb220-3"></a></span>
<span id="cb220-4"><a href="working-on-remote-servers.html#cb220-4"></a><span class="co"># and here is the output</span></span>
<span id="cb220-5"><a href="working-on-remote-servers.html#cb220-5"></a>          <span class="ex">-1</span> 1969-12-31 16:00:00        -1 sjg73_fqs</span>
<span id="cb220-6"><a href="working-on-remote-servers.html#cb220-6"></a>          <span class="ex">-1</span> 1969-12-31 16:00:00        -1 sjg73_supernova_fqs</span></code></pre></div>
<p>Aha! There are two directories that might hold our sequencing data.
I wonder what is in those diretories? The <code>rclone tree</code> command is the
perfect way to drill down into those diretories and look at their contents:</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb221-1"><a href="working-on-remote-servers.html#cb221-1"></a><span class="ex">%</span> rclone tree --http-url http://sysg1.cs.yale.edu:3010/5lnO9bs3zfa8LOhESfsYfq3Dc/061719/ :http:</span>
<span id="cb221-2"><a href="working-on-remote-servers.html#cb221-2"></a><span class="ex">/</span></span>
<span id="cb221-3"><a href="working-on-remote-servers.html#cb221-3"></a>├── <span class="ex">sjg73_fqs</span></span>
<span id="cb221-4"><a href="working-on-remote-servers.html#cb221-4"></a>│   ├── <span class="ex">AW_F1</span></span>
<span id="cb221-5"><a href="working-on-remote-servers.html#cb221-5"></a>│   │   ├── <span class="ex">AW_F1_S2_L001_I1_001.fastq.gz</span></span>
<span id="cb221-6"><a href="working-on-remote-servers.html#cb221-6"></a>│   │   ├── <span class="ex">AW_F1_S2_L001_R1_001.fastq.gz</span></span>
<span id="cb221-7"><a href="working-on-remote-servers.html#cb221-7"></a>│   │   └── <span class="ex">AW_F1_S2_L001_R2_001.fastq.gz</span></span>
<span id="cb221-8"><a href="working-on-remote-servers.html#cb221-8"></a>│   ├── <span class="ex">AW_M1</span></span>
<span id="cb221-9"><a href="working-on-remote-servers.html#cb221-9"></a>│   │   ├── <span class="ex">AW_M1_S3_L001_I1_001.fastq.gz</span></span>
<span id="cb221-10"><a href="working-on-remote-servers.html#cb221-10"></a>│   │   ├── <span class="ex">AW_M1_S3_L001_R1_001.fastq.gz</span></span>
<span id="cb221-11"><a href="working-on-remote-servers.html#cb221-11"></a>│   │   └── <span class="ex">AW_M1_S3_L001_R2_001.fastq.gz</span></span>
<span id="cb221-12"><a href="working-on-remote-servers.html#cb221-12"></a>│   └── <span class="ex">ESP_A1</span></span>
<span id="cb221-13"><a href="working-on-remote-servers.html#cb221-13"></a>│       ├── <span class="ex">ESP_A1_S1_L001_I1_001.fastq.gz</span></span>
<span id="cb221-14"><a href="working-on-remote-servers.html#cb221-14"></a>│       ├── <span class="ex">ESP_A1_S1_L001_R1_001.fastq.gz</span></span>
<span id="cb221-15"><a href="working-on-remote-servers.html#cb221-15"></a>│       └── <span class="ex">ESP_A1_S1_L001_R2_001.fastq.gz</span></span>
<span id="cb221-16"><a href="working-on-remote-servers.html#cb221-16"></a>└── <span class="ex">sjg73_supernova_fqs</span></span>
<span id="cb221-17"><a href="working-on-remote-servers.html#cb221-17"></a>    ├── <span class="ex">AW_F1</span></span>
<span id="cb221-18"><a href="working-on-remote-servers.html#cb221-18"></a>    │   ├── <span class="ex">AW_F1_S2_L001_I1_001.fastq.gz</span></span>
<span id="cb221-19"><a href="working-on-remote-servers.html#cb221-19"></a>    │   ├── <span class="ex">AW_F1_S2_L001_R1_001.fastq.gz</span></span>
<span id="cb221-20"><a href="working-on-remote-servers.html#cb221-20"></a>    │   └── <span class="ex">AW_F1_S2_L001_R2_001.fastq.gz</span></span>
<span id="cb221-21"><a href="working-on-remote-servers.html#cb221-21"></a>    ├── <span class="ex">AW_M1</span></span>
<span id="cb221-22"><a href="working-on-remote-servers.html#cb221-22"></a>    │   ├── <span class="ex">AW_M1_S3_L001_I1_001.fastq.gz</span></span>
<span id="cb221-23"><a href="working-on-remote-servers.html#cb221-23"></a>    │   ├── <span class="ex">AW_M1_S3_L001_R1_001.fastq.gz</span></span>
<span id="cb221-24"><a href="working-on-remote-servers.html#cb221-24"></a>    │   └── <span class="ex">AW_M1_S3_L001_R2_001.fastq.gz</span></span>
<span id="cb221-25"><a href="working-on-remote-servers.html#cb221-25"></a>    └── <span class="ex">ESP_A1</span></span>
<span id="cb221-26"><a href="working-on-remote-servers.html#cb221-26"></a>        ├── <span class="ex">ESP_A1_S1_L001_I1_001.fastq.gz</span></span>
<span id="cb221-27"><a href="working-on-remote-servers.html#cb221-27"></a>        ├── <span class="ex">ESP_A1_S1_L001_R1_001.fastq.gz</span></span>
<span id="cb221-28"><a href="working-on-remote-servers.html#cb221-28"></a>        └── <span class="ex">ESP_A1_S1_L001_R2_001.fastq.gz</span></span>
<span id="cb221-29"><a href="working-on-remote-servers.html#cb221-29"></a></span>
<span id="cb221-30"><a href="working-on-remote-servers.html#cb221-30"></a><span class="ex">8</span> directories, 18 files</span></code></pre></div>
<p>Whoa! That is pretty cool!. From this output we see that there are
subdirectories named <code>AW_F1</code> and <code>AW_M1</code> that hold the files that
we want. And, of course, the <code>ESP_A1</code> samples must belong to someone
else. It would be great if we could just download the files we wanted,
excluding the ones in the <code>ESP_A1</code> directories. It turns out that there is!
<code>rclone</code> has an <code>--exclude</code> option to exclude paths that match certain
patterns (see Section <a href="working-on-remote-servers.html#rclone-filter">7.2.4.3</a>, above). We can
experiment by giving <code>rclone copy</code> the <code>--dry-run</code> command to see which
files will be transferred. If we don’t do any filtering, we see this
when we try to dry-run copy the directories to our local directory <code>Alewife/fastqs</code>:</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb222-1"><a href="working-on-remote-servers.html#cb222-1"></a><span class="ex">%</span> rclone copy --dry-run --http-url http://sysg1.cs.yale.edu:3010/5lnO9bs3zfa8LOhESfsYfq3Dc/061719/ :http: Alewife/fastqs/</span>
<span id="cb222-2"><a href="working-on-remote-servers.html#cb222-2"></a><span class="ex">2019/07/11</span> 10:33:43 NOTICE: sjg73_fqs/ESP_A1/ESP_A1_S1_L001_I1_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb222-3"><a href="working-on-remote-servers.html#cb222-3"></a><span class="ex">2019/07/11</span> 10:33:43 NOTICE: sjg73_fqs/ESP_A1/ESP_A1_S1_L001_R1_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb222-4"><a href="working-on-remote-servers.html#cb222-4"></a><span class="ex">2019/07/11</span> 10:33:43 NOTICE: sjg73_fqs/ESP_A1/ESP_A1_S1_L001_R2_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb222-5"><a href="working-on-remote-servers.html#cb222-5"></a><span class="ex">2019/07/11</span> 10:33:43 NOTICE: sjg73_supernova_fqs/AW_M1/AW_M1_S3_L001_I1_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb222-6"><a href="working-on-remote-servers.html#cb222-6"></a><span class="ex">2019/07/11</span> 10:33:43 NOTICE: sjg73_supernova_fqs/AW_M1/AW_M1_S3_L001_R1_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb222-7"><a href="working-on-remote-servers.html#cb222-7"></a><span class="ex">2019/07/11</span> 10:33:43 NOTICE: sjg73_supernova_fqs/AW_M1/AW_M1_S3_L001_R2_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb222-8"><a href="working-on-remote-servers.html#cb222-8"></a><span class="ex">2019/07/11</span> 10:33:43 NOTICE: sjg73_supernova_fqs/AW_F1/AW_F1_S2_L001_I1_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb222-9"><a href="working-on-remote-servers.html#cb222-9"></a><span class="ex">2019/07/11</span> 10:33:43 NOTICE: sjg73_supernova_fqs/AW_F1/AW_F1_S2_L001_R1_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb222-10"><a href="working-on-remote-servers.html#cb222-10"></a><span class="ex">2019/07/11</span> 10:33:43 NOTICE: sjg73_supernova_fqs/AW_F1/AW_F1_S2_L001_R2_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb222-11"><a href="working-on-remote-servers.html#cb222-11"></a><span class="ex">2019/07/11</span> 10:33:43 NOTICE: sjg73_supernova_fqs/ESP_A1/ESP_A1_S1_L001_I1_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb222-12"><a href="working-on-remote-servers.html#cb222-12"></a><span class="ex">2019/07/11</span> 10:33:43 NOTICE: sjg73_supernova_fqs/ESP_A1/ESP_A1_S1_L001_R1_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb222-13"><a href="working-on-remote-servers.html#cb222-13"></a><span class="ex">2019/07/11</span> 10:33:43 NOTICE: sjg73_supernova_fqs/ESP_A1/ESP_A1_S1_L001_R2_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb222-14"><a href="working-on-remote-servers.html#cb222-14"></a><span class="ex">2019/07/11</span> 10:33:43 NOTICE: sjg73_fqs/AW_F1/AW_F1_S2_L001_I1_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb222-15"><a href="working-on-remote-servers.html#cb222-15"></a><span class="ex">2019/07/11</span> 10:33:43 NOTICE: sjg73_fqs/AW_F1/AW_F1_S2_L001_R1_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb222-16"><a href="working-on-remote-servers.html#cb222-16"></a><span class="ex">2019/07/11</span> 10:33:43 NOTICE: sjg73_fqs/AW_F1/AW_F1_S2_L001_R2_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb222-17"><a href="working-on-remote-servers.html#cb222-17"></a><span class="ex">2019/07/11</span> 10:33:43 NOTICE: sjg73_fqs/AW_M1/AW_M1_S3_L001_I1_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb222-18"><a href="working-on-remote-servers.html#cb222-18"></a><span class="ex">2019/07/11</span> 10:33:43 NOTICE: sjg73_fqs/AW_M1/AW_M1_S3_L001_R1_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb222-19"><a href="working-on-remote-servers.html#cb222-19"></a><span class="ex">2019/07/11</span> 10:33:43 NOTICE: sjg73_fqs/AW_M1/AW_M1_S3_L001_R2_001.fastq.gz: Not copying as --dry-run</span></code></pre></div>
<p>Since we do not want to copy the <code>ESP_A1</code> files we see if we can exclude
them:</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb223-1"><a href="working-on-remote-servers.html#cb223-1"></a><span class="ex">%</span> rclone copy --exclude */ESP_A1/* --dry-run --http-url http://sysg1.cs.yale.edu:3010/5lnO9bs3zfa8LOhESfsYfq3Dc/061719/ :http: Alewife/fastqs/</span>
<span id="cb223-2"><a href="working-on-remote-servers.html#cb223-2"></a><span class="ex">2019/07/11</span> 10:37:22 NOTICE: sjg73_fqs/AW_F1/AW_F1_S2_L001_I1_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb223-3"><a href="working-on-remote-servers.html#cb223-3"></a><span class="ex">2019/07/11</span> 10:37:22 NOTICE: sjg73_fqs/AW_F1/AW_F1_S2_L001_R2_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb223-4"><a href="working-on-remote-servers.html#cb223-4"></a><span class="ex">2019/07/11</span> 10:37:22 NOTICE: sjg73_fqs/AW_F1/AW_F1_S2_L001_R1_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb223-5"><a href="working-on-remote-servers.html#cb223-5"></a><span class="ex">2019/07/11</span> 10:37:22 NOTICE: sjg73_fqs/AW_M1/AW_M1_S3_L001_I1_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb223-6"><a href="working-on-remote-servers.html#cb223-6"></a><span class="ex">2019/07/11</span> 10:37:22 NOTICE: sjg73_fqs/AW_M1/AW_M1_S3_L001_R2_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb223-7"><a href="working-on-remote-servers.html#cb223-7"></a><span class="ex">2019/07/11</span> 10:37:22 NOTICE: sjg73_fqs/AW_M1/AW_M1_S3_L001_R1_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb223-8"><a href="working-on-remote-servers.html#cb223-8"></a><span class="ex">2019/07/11</span> 10:37:22 NOTICE: sjg73_supernova_fqs/AW_F1/AW_F1_S2_L001_I1_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb223-9"><a href="working-on-remote-servers.html#cb223-9"></a><span class="ex">2019/07/11</span> 10:37:22 NOTICE: sjg73_supernova_fqs/AW_F1/AW_F1_S2_L001_R2_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb223-10"><a href="working-on-remote-servers.html#cb223-10"></a><span class="ex">2019/07/11</span> 10:37:22 NOTICE: sjg73_supernova_fqs/AW_F1/AW_F1_S2_L001_R1_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb223-11"><a href="working-on-remote-servers.html#cb223-11"></a><span class="ex">2019/07/11</span> 10:37:22 NOTICE: sjg73_supernova_fqs/AW_M1/AW_M1_S3_L001_I1_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb223-12"><a href="working-on-remote-servers.html#cb223-12"></a><span class="ex">2019/07/11</span> 10:37:22 NOTICE: sjg73_supernova_fqs/AW_M1/AW_M1_S3_L001_R1_001.fastq.gz: Not copying as --dry-run</span>
<span id="cb223-13"><a href="working-on-remote-servers.html#cb223-13"></a><span class="ex">2019/07/11</span> 10:37:22 NOTICE: sjg73_supernova_fqs/AW_M1/AW_M1_S3_L001_R2_001.fastq.gz: Not copying as --dry-run</span></code></pre></div>
<p>Booyah! That gets us just what we want. So, then we remove the <code>--dry-run</code> option,
and maybe add <code>-v -P</code> to give us verbose output and progress information, and copy all of our files:</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb224-1"><a href="working-on-remote-servers.html#cb224-1"></a><span class="ex">%</span> rclone copy --exclude */ESP_A1/* -v -P  --http-url http://sysg1.cs.yale.edu:3010/5lnO9bs3zfa8LOhESfsYfq3Dc/061719/ :http: Alewife/fastqs/</span></code></pre></div>
</div>
</div>
<div id="tmux" class="section level2">
<h2><span class="header-section-number">7.3</span> <code>tmux</code>: the terminal multiplexer</h2>
<p>Many universities have recently implemented a two-factor
authentication requirement for access to their computing resources
(like remote servers and clusters). This means that every time
you login to a server on campus (using <code>ssh</code> for example) you must
type your password, and also fiddle with your phone. Such systems
preclude the use of public/private key pairs that historically allowed
you to access a server from a trusted client (i.e., your own secured
laptop) without having to type in a password. As a consequence, today,
opening multiple sessions on a server using <code>ssh</code> and two-factor
authentication requires a ridiculous amount of additional typing and
phone-fiddling, and is a huge hassle. But, when working on a remote
server it is often very convenient to have multiple separate shells that
you are working on and can quickly switch between.</p>
<p>At the same time. When you are working on the shell of a remote machine
and your network connection goes down, then, typically the bash session on
your remote machine will be forcibly quit, killing any jobs that you might
have been in the middle of (however, this is not the case of you submitted
those jobs through a job scheduler like SLURM. Much more on that in the
next chapter.). And, finally, in a traditional
<code>ssh</code> session to a remote machine, when you close your laptop, or put it
to sleep, or quit the Terminal application, all of your active bash sessions
on the remote machine will get shut down. Consequently, the next time
you want to work on that project, after you have logged
onto that remote machine you will have to go through the laborious steps
of navigating to your desired working directory, starting up any processes
that might have gotten killed, and generally getting yourself
set up to work again. That is a serious buzz kill!</p>
<p>Fortunately, there is an awesome utility called <code>tmux</code>, which is short for
“terminal multiplexer” that solves most of the problems we just described.
<code>tmux</code> is similar in function to a utility called <code>screen</code>, but it is easier
to use while at the same time being more customizable and configurable
(in my opinion). <code>tmux</code> is basically your ticket to working <em>way</em> more
efficiently on remote computers, while at the same time looking
(to friends and colleagues, at least) like
the full-on, bad-ass Unix user.</p>
<p>In full confession, I didn’t actually start using <code>tmux</code> until some
five years after a speaker at a workshop delivered an incredibly
enthusiastic presentation about <code>tmux</code> and how much he was in love
with it. In somewhat the same fashion that I didn’t adopt RStudio shortly
after its release, because I had my own R workflows that I had hacked
together myself, I thought to myself: “I have public/private key pairs
so it is super easy for me to just start another terminal window and login
to the server for a new session. Why would I need <code>tmux</code>?” I also didn’t
quite understand how <code>tmux</code> worked initially: I thought that I had to
run <code>tmux</code> simultaneously on my laptop and on the server, and that those
two processes would talk to one another. That is not the case! You
just have to run <code>tmux</code> on the server and all will work fine!
The upshot of that confession is that you should <em>not</em> be a bozo like me,
and you should learn to use <code>tmux</code> <em>right now</em>! You will thank yourself
for it many times over down the road.</p>
<div id="an-analogy-for-how-tmux-works" class="section level3">
<h3><span class="header-section-number">7.3.1</span> An analogy for how <code>tmux</code> works</h3>
<p>Imagine that the first time you log in to your remote server
you also have the option of speaking on the phone to a super
efficient IT guy who has a desk in the server room.
This dude never takes a break, but sits at his desk
24/7. He probably has mustard stains on his dingy white T-shirt
from eating ham sandwiches non-stop while he works super hard. This guy is Tmux.</p>
<p>When you <em>first</em> speak to this guy after logging in, you have to preface your
commands with <code>tmux</code> (as in, “Hey Tmux!”). He is there to help you
manage different terminal windows with different bash shells or
processes going on in them. In fact, you can think of it this way: you can
ask him to set up
a terminal (i.e., like a monitor), right there on his desk, and then create
a bunch of windows on that terminal for you—each
one with its own bash shell—without having to do a separate login for
each one. He has created all those windows, but you still get to use them.
It is like he has a miracle-mirroring device that lets you operate
the windows that are on the terminal he set up for you on his desk.</p>
<p>When you are done working on all those windows, you can tell Tmux that you
want to <em>detach</em> from the special terminal he set up for you at the server.
In response he says, “Cool!” and shuts down his miracle-mirroring device, so
you no longer see those different windows. However, he <em>does not</em> shut down the
terminal on his desk that he set up for you. That terminal stays on, and any of your processes
happening on it keep chugging away…even after you logout from the server entirely,
throw the lid down on your laptop,
have drinks with your friends at Social, downtown, watch an episode
of Parks and Rec, and then get a good night’s sleep.</p>
<p>All through the night, Tmux is munching ham sandwiches and keeping an eye on that
terminal he set up for you. When you log back onto the server in the morning, you
can say “Hey Tmux! I want to attach back to that terminal you set up for me.” He
says, “No problem!”, turns his miracle-mirroring device back on, and in an instant
you have all of the windows on that terminal back on your laptop with all the processes
still running in them—in all the same working directories—just as you left it all
(except that if you were running jobs in those windows, some of those jobs might already
be done!).</p>
<p>Not only that, but, further, if you are working on the server when a local thunderstorm
fries the motherboard on your laptop, you can get a new laptop, log back into the
server and ask Tmux to reconnect you to that terminal and get back to all of those
windows and jobs, etc. as if you didn’t get zapped. The same goes for the case of
a backhoe operator accidentally digging up the fiber optic cable in your yard. Your
network connection can go down completely. But, when you get it up and running again,
you can say “Hey Tmux! Hook me up!” and he’ll say, “No problem!” and reconnect you
to all those windows you had open on the server.</p>
<p>Finally, when you are done with all the windows and jobs on the terminal that Tmux set
up for you, you can ask him to kill it, and he will shut it down, unplug it, and, straight
out of <em>Office Space</em>, chuck it out the window. But he will gladly install a new one
if you want to start another <em>session</em> with him.</p>
<p>That dude is super helpful!</p>
</div>
<div id="first-steps-with-tmux" class="section level3">
<h3><span class="header-section-number">7.3.2</span> First steps with <code>tmux</code></h3>
<p>The first thing you want to
do to make sure Tmux is ready to help you is to simply type:</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb225-1"><a href="working-on-remote-servers.html#cb225-1"></a><span class="ex">%</span> which tmux</span></code></pre></div>
<p>This should return something like:</p>
<pre><code>/usr/bin/tmux</code></pre>
<p>If, instead, you get a response like <code>tmux: Command not found.</code> then <code>tmux</code>
is apparently not installed
on your remote server, so you
will have to install it yourself, or beg your sysadmin to do so (we will cover
that in a later chapter). If you
are working on the Summit supercomptuer in Colorado or on Hummingbird at
UCSC, then <code>tmux</code> is installed already. (As of Feb 16, 2020, <code>tmux</code> was
not installed on the Sedna cluster at the NWFSC, but I will request that it
be installed.)</p>
<p>In the analogy, above, we talked about Tmux setting up a terminal
in the server room. In <code>tmux</code> parlance, such a “terminal” is called
a <em>session</em>. In order to be able to tell Tmux that you want to reconnect
to a session, you
will <em>always</em> want to name your sessions so you will request a new
session with this syntax:</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb227-1"><a href="working-on-remote-servers.html#cb227-1"></a><span class="ex">%</span> tmux new -s froggies</span></code></pre></div>
<p>You can think of the <code>-s</code> as being short for “session.” So it is basically a short
way of saying, “Hey Tmux, give me a new session named <code>froggies</code>.”
That creates a new session called <code>froggies</code>, and you can imagine we’ve
named it that because we will use it for work on a frog genomics project.</p>
<p>The effect of this
is like Tmux firing up a new terminal in his server room, making a
window on it for you, starting a new bash shell in that window,
<em>and then giving you control of this new terminal</em>.
In other words, it is sort of like he has opened a new shell window on a
terminal for you, and is letting you see and use it on your computer at the same time.</p>
<p>One very cool thing about this is that you just got a new bash shell
without having to login with your password and two-factor authentication again.
That much is cool in itself, but is only the beginning.</p>
<p>The new window that you get looks a little different. For one thing, it
has a section, one line tall, that is green (by default) on the bottom.
In our case, on the left side it gives the name of the session (in square
brackets) and then the name of the current <em>window</em> within that session. On
the right side you see the <em>hostname</em> (the name of the remote computer
you are working on) in quotes, followed by the date and time. The contents
in that green band will look something
like:</p>
<pre><code>[froggies] 0:bash*                                               &quot;login11&quot; 20:02 15-Feb-20</code></pre>
This little line of information is the sweet sauce that will let you
find your way around all the new windows that
<code>tmux</code> can spawn for you.<br />

<div class="rmdcaution">
If you are working on a cluster, please pay special attention to the hostname.
(In the above case the hostname is <code>login11</code>). Many clusters have multiple <em>login</em>
or <em>head</em> nodes, as they are called. The next time you login to the cluster, you
might be assigned to a different login node which will have no idea about your
<code>tmux</code> sessions. If that were the case in this example I would have to use <code>slogin login11</code> and
authenticate again to get logged into <code>login11</code> to reconnect to my
<code>tmux</code> session, <code>froggies</code>. Or, if you were a CSU student and wanted to login specifically to
the <code>login11</code> node on Summit the next time you logged on you could do
<code>ssh username@colostate.edu@login11.rc.colorado.edu</code>. Note the specific <code>login11</code> in that
statement.
</div>

<p>Now, imagine that we want to use this <em>window</em> in our <code>froggies</code> <em>session</em>, to look at some
frog data we have. Accordingly, we might navigate to the directory where those data live
and look at the data with <code>head</code> and <code>less</code>, etc. That is all great, until we realize that
we also want to edit some scripts that we wrote for processing our froggy data. These scripts
might be in a directory far removed from the data directory we are currently in, and we don’t really
want to keep navigating back and forth between those two directories within a single bash shell.
Clearly, we would like to have two windows that we could switch between: one for inspecting
our data, and the other for editing our scripts.</p>
<p>We are in luck! We can do this with <code>tmux</code>. However, now that we are safely working in a <em>session</em>
that <code>tmux</code> started for us, we no longer have to shout “Hey Tmux!” Rather we can just “ring a little
bell” to get his attention. In the default <code>tmux</code> configuration, you do that by pressing
<code>&lt;cntrl&gt;-b</code> from anywhere within a <code>tmux</code> window. This is easy to remember because it is like
a “b” for the “bell” that we ring to get our faithful servant’s attention. <code>&lt;cntrl&gt;-b</code> is known
as the “prefix” sequence that starts all requests to <code>tmux</code> from within a session.</p>
<p>The first thing that we are going to do is ask <code>tmux</code> to let us assign a more descriptive,
name—<code>data</code> to be specific—to the current window. We do this with</p>
<pre><code>&lt;cntrl&gt;-b ,</code></pre>
<p>(That’s right! It’s a control-b and then a comma. <code>tmux</code> likes to get by on a minimum number
of keystrokes.) When you do that, the green band at the bottom of the window changes color
and tells you that you can rename the current window. We simply use our keyboard to
change the name to “data”. That was super easy!</p>
<p>Now, to make a new window with a new bash shell that we can use for writing scripts
we do <code>&lt;cntrl&gt;-b c</code>. Try it! That gives you a new <em>window</em> within the <code>froggies</code> session
and switches your focus to it. It is as if Tmux (in his mustard-stained shirt) has created
a new window on the <code>froggies</code> terminal, brought it to the front, and shared it with you.
The left side of the green <code>tmux</code> status bar at the bottom of the screen now says:</p>
<pre><code>[froggies] 0:data- 1:bash*</code></pre>
<p>Holy Moly! This is telling you that the <code>froggies</code> session has two windows in it: the first
numbered 0 and named <code>data</code>, and the second numbered 1 and named <code>bash</code>. The <code>-</code> at the end
of <code>0:data-</code> is telling you that <code>data</code> is the window you were previously focused on, but that
now you are currently focused on the window with the <code>*</code> after its name: <code>1:bash*</code>.</p>
<p>So, the name <code>bash</code> is not as informative as it could be. Since we will be using this
new window for editing scripts, let’s rename it to <code>edit</code>. You can do that with
<code>&lt;cntrl&gt;-b ,</code>. Do it!</p>
<p>OK! Now, if you have been paying attention, you probably realize that <code>tmux</code> has given us
two windows (with two different bash shells) in this session called <code>froggies</code>. Not only that
but it has associated a single-digit number with each window. If you are all about keyboard
shortcuts, then you probably have already imagined that <code>tmux</code> will let you switch between
these two windows with <code>&lt;cntrl&gt;-b</code> plus a digit (0 or 1 in this case). Play with that.
Do <code>&lt;cntrl&gt;-b 0</code> and <code>&lt;cntrl&gt;-b 1</code> and feel the power!</p>
<p>Now, for fun, imagine that we want to have another window and a bash shell for launching
jobs. Make a new window, name it <code>launch</code>, and then switch between those three windows.</p>
<p>Finally. When you are done with all that, you tell Tmux to detach from this session
by typing:</p>
<pre><code>&lt;cntrl&gt;-b d</code></pre>
<p>(The <code>d</code> is for “detach”). This should kick you back to the shell from which you
first shouted “Hey Tmux!” by issuing the <code>tmux a -t froggies</code> command. So, you
can’t see the windows of your <code>froggies</code> session any longer, <em>but do not despair</em>!
Those windows are still on the monitor Tmux set up for you, casting an eerie glow
on his mustard stained shirt.</p>
<p>If you want to get back in the driver’s seat with all of those windows, you simply need to
tell Tmux that you want to be attached again via his miracle-mirroring device. Since we
are no longer in a <code>tmux</code> window, we don’t use our <code>&lt;cntrl-b&gt;</code> bell to get Tmux’s attention.
We have to shout:</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb232-1"><a href="working-on-remote-servers.html#cb232-1"></a><span class="ex">%</span> tmux attach -t froggies</span></code></pre></div>
<p>The <code>-t</code> flag stands for “target.” The <code>froggies</code> session is the target of our
attach request. Note that if you don’t like typing that much, you can shorten this to:</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb233-1"><a href="working-on-remote-servers.html#cb233-1"></a><span class="ex">%</span> tmux a -t froggies</span></code></pre></div>
<p>Of course, sometimes, when you log back onto the server, you won’t remember the name
of the <code>tmux</code> session(s) you started. Use this command to list them all:</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb234-1"><a href="working-on-remote-servers.html#cb234-1"></a><span class="ex">%</span> tmux ls</span></code></pre></div>
<p>The <code>ls</code> here stands for “list-sessions.” This can be particularly useful if you
actually have multiple sessions. For example, suppose you are a poly-taxa genomicist,
with projects not only on a frog species, but also on a fish and a bird species. You
might have a separate session for each of those, so that when you issue <code>tmux ls</code> the
result could look something like:</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb235-1"><a href="working-on-remote-servers.html#cb235-1"></a><span class="ex">%</span> tmux ls</span>
<span id="cb235-2"><a href="working-on-remote-servers.html#cb235-2"></a><span class="ex">birdies</span>: 4 windows (created Sun Feb 16 07:23:30 2020) [<span class="ex">203x59</span>]</span>
<span id="cb235-3"><a href="working-on-remote-servers.html#cb235-3"></a><span class="ex">fishies</span>: 2 windows (created Sun Feb 16 07:23:55 2020) [<span class="ex">203x59</span>]</span>
<span id="cb235-4"><a href="working-on-remote-servers.html#cb235-4"></a><span class="ex">froggies</span>: 3 windows (created Sun Feb 16 07:22:36 2020) [<span class="ex">203x59</span>]</span></code></pre></div>
<p>That is enough to remind you of which session you might wish to reattach to.</p>
<p>Finally, if you are all done with a <code>tmux</code> session, and you have detached from it,
then from your shell prompt (not within a <code>tmux</code> session) you can do, for example:</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb236-1"><a href="working-on-remote-servers.html#cb236-1"></a><span class="ex">tmux</span> kill-session -t  birdies</span></code></pre></div>
<p>to kill the session. There are other ways to kill sessions while you
are in them, but that is not so much needed.</p>
<p>Table <a href="working-on-remote-servers.html#tab:minimal-tmux">7.1</a> reviews the minimal set of
<code>tmux</code> commands just described. Though there is much more that
can be done with <code>tmux</code>, those commands will get you started.</p>
<table>
<caption><span id="tab:minimal-tmux">TABLE 7.1: </span> A bare bones set of commands for using <code>tmux</code> The first column says whether the command is given within a <code>tmux</code> session rather than at the shell outside of a <code>tmux</code> session</caption>
<colgroup>
<col width="19%" />
<col width="38%" />
<col width="41%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Within tmux?</th>
<th align="left">Command</th>
<th align="left">Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">N</td>
<td align="left"><code>tmux ls</code></td>
<td align="left">List any tmux sessions the
server knows about</td>
</tr>
<tr class="even">
<td align="left">N</td>
<td align="left"><code>tmux new -s name</code></td>
<td align="left">Create a new tmux session
named “name”</td>
</tr>
<tr class="odd">
<td align="left">N</td>
<td align="left"><code>tmux attach -t name</code></td>
<td align="left">Attach to the existing tmux
session “name”</td>
</tr>
<tr class="even">
<td align="left">N</td>
<td align="left"><code>tmux a -t name</code></td>
<td align="left">Same as “attach” but shorter.</td>
</tr>
<tr class="odd">
<td align="left">N</td>
<td align="left"><code>tmux kill-session -t</code> name</td>
<td align="left">Kill the tmux session named
“name”</td>
</tr>
<tr class="even">
<td align="left">Y</td>
<td align="left"><code>&lt;cntrl&gt;-b ,</code></td>
<td align="left">Edit the name of the current
window</td>
</tr>
<tr class="odd">
<td align="left">Y</td>
<td align="left"><code>&lt;cntrl&gt;-b c</code></td>
<td align="left">Create a new window</td>
</tr>
<tr class="even">
<td align="left">Y</td>
<td align="left"><code>&lt;cntrl&gt;-b 3</code></td>
<td align="left">Move focus to window 3</td>
</tr>
<tr class="odd">
<td align="left">Y</td>
<td align="left"><code>&lt;cntrl&gt;-b &amp;</code></td>
<td align="left">Kill current window</td>
</tr>
<tr class="even">
<td align="left">Y</td>
<td align="left"><code>&lt;cntrl&gt;-b d</code></td>
<td align="left">Detach from current session</td>
</tr>
<tr class="odd">
<td align="left">Y</td>
<td align="left"><code>&lt;cntrl&gt;-l</code></td>
<td align="left">Clear screen current window</td>
</tr>
</tbody>
</table>
</div>
<div id="further-steps-with-tmux" class="section level3">
<h3><span class="header-section-number">7.3.3</span> Further steps with <code>tmux</code></h3>
<p>The previous section merely scratched the surface of what is possible with <code>tmux</code>.<br />
Indeed, that is the case with this section. But here I just want to leave you with a
taste for how to configure <code>tmux</code> to your liking, and also with the ability to create
different <em>panes</em> within a window within a session. You guessed it! A pane is made by
splitting a <em>window</em> (which is itself a part of a <em>session</em>) into two different
sections, each one running its own bash shell.</p>
<p>Before we start making panes, we set some configurations that make the
establishment of panes more intuitive (by using keystrokes that are easier
to remember) and others that make it easier to quickly adjust the size of the panes.
So, first, add these lines to <code>~/.tmux.conf</code>:</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb237-1"><a href="working-on-remote-servers.html#cb237-1"></a><span class="co"># splitting panes</span></span>
<span id="cb237-2"><a href="working-on-remote-servers.html#cb237-2"></a><span class="bu">bind</span> <span class="dt">\ </span>split-window -h -c <span class="st">&#39;#{pane_current_path}&#39;</span></span>
<span id="cb237-3"><a href="working-on-remote-servers.html#cb237-3"></a><span class="bu">bind</span> - split-window -v -c <span class="st">&#39;#{pane_current_path}&#39;</span></span>
<span id="cb237-4"><a href="working-on-remote-servers.html#cb237-4"></a></span>
<span id="cb237-5"><a href="working-on-remote-servers.html#cb237-5"></a><span class="co"># easily resize panes with &lt;C-b&gt; + one of j, k, h, l</span></span>
<span id="cb237-6"><a href="working-on-remote-servers.html#cb237-6"></a><span class="ex">bind-key</span> j resize-pane -D 10</span>
<span id="cb237-7"><a href="working-on-remote-servers.html#cb237-7"></a><span class="ex">bind-key</span> k resize-pane -U 10</span>
<span id="cb237-8"><a href="working-on-remote-servers.html#cb237-8"></a><span class="ex">bind-key</span> h resize-pane -L 10</span>
<span id="cb237-9"><a href="working-on-remote-servers.html#cb237-9"></a><span class="ex">bind-key</span> l resize-pane -R 10</span></code></pre></div>
<p>Once you have updated <code>~/.tmux.conf</code> you need to reload that
configuration file in <code>tmux</code>. So, from within a <code>tmux</code> session,
you do <code>&lt;cntrl&gt;-b :</code>. This let’s you type a <code>tmux</code> command in the lower
left (where the cursor has become active). Type <code>source-file ~/.tmux.conf</code></p>
<p>The comments show what each line is intended to do, and you
can see that the configuration “language” for <code>tmux</code> is relatively
unintimidating. In plain language, these configurations are saying that, after this
configuration is made active, <code>&lt;cntrl&gt;-b /</code> will split a window (or a pane),
vertically, in to two panes. (Note that this is easy to remember
because on an American keyboard, the <code>\</code> and the <code>|</code>, share a key. The latter
looks like a vertical separator, and would thus be a good key stroke
to split a screen vertically, but why force ourselves to hit the shift key as well?).
Likewise, <code>&lt;cntrl&gt;-b -</code> will split a window (or a pane) into two panes.</p>
What do we mean by splitting a window into multiple panes? A picture is
worth a thousand words. Figure <a href="working-on-remote-servers.html#fig:tmux-4-panes">7.3</a> shows a <code>tmux</code>
window with four panes. The two vertical ones on the left show a yaml
file and a shell script being edited in <code>vim</code>, and the remaining two
house shells for looking at files in two different directories.
<div class="figure" style="text-align: center"><span id="fig:tmux-4-panes"></span>
<img src="figs/tmux-4-panes.png" alt="A tmux window with four panes." width="1107" />
<p class="caption">
FIGURE 7.3: A tmux window with four panes.
</p>
</div>
<p>This provides almost endless opportunities for customizing the
appearance of your terminal workspace on a remote machine for maximum
efficiency. Of course, doing so requires you know a few more
keystrokes for handling panes. These are summarized in Table <a href="working-on-remote-servers.html#tab:tmux-pane-strokes">7.2</a>.</p>
<table style="width:94%;">
<caption><span id="tab:tmux-pane-strokes">TABLE 7.2: </span> Important keystrokes within a <code>tmux</code> session for handling panes</caption>
<colgroup>
<col width="20%" />
<col width="27%" />
<col width="45%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Within tmux?</th>
<th align="left">Command</th>
<th align="left">Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Y</td>
<td align="left"><code>&lt;cntrl&gt;-b /</code></td>
<td align="left">Split current window/pane
vertically into two panes</td>
</tr>
<tr class="even">
<td align="left">Y</td>
<td align="left"><code>&lt;cntrl&gt;-b -</code></td>
<td align="left">Split current window/pane
horizontally into two panes</td>
</tr>
<tr class="odd">
<td align="left">Y</td>
<td align="left"><code>&lt;cntrl&gt;-b arrow</code></td>
<td align="left">Use <code>&lt;cntrl&gt;-b</code> + an arrow key
to move sequentially amongst
panes</td>
</tr>
<tr class="even">
<td align="left">Y</td>
<td align="left"><code>&lt;cntrl&gt;-b x</code></td>
<td align="left">Kill current the current pane</td>
</tr>
<tr class="odd">
<td align="left">Y</td>
<td align="left"><code>&lt;cntrl&gt;-b q</code></td>
<td align="left">Paint big ID numbers (from 0
up) on the panes for a few
seconds. Hitting a number
before it disappears moves
focus to that pane.</td>
</tr>
<tr class="even">
<td align="left">Y</td>
<td align="left"><cntrl>-b [hjkl]</td>
<td align="left">Resize the current pane, h =
Left, j = Down, k = Up, l =
Right. It takes a while to
understand which boundary will
move.</td>
</tr>
<tr class="odd">
<td align="left">Y</td>
<td align="left"><cntrl>-b z</td>
<td align="left">Zoom current pane to full
size. <code>&lt;cntrl&gt;-b z</code> again
restores it to original size.</td>
</tr>
</tbody>
</table>
<p>Now that you have seen all these keystrokes, use <code>&lt;cntrl&gt;-b \</code> and <code>&lt;cntrl&gt;-b -</code> to split your windows
up into a few panes and try them out. It takes a while to get used to it, but once you get
the hang of it, it’s quite nice.</p>
</div>
</div>
<div id="tmux-for-mac-users" class="section level2">
<h2><span class="header-section-number">7.4</span> <code>tmux</code> for Mac users</h2>
<p>I put this in an entirely different section, because, if you are comfortable in
Mac-world, already, working with tmux by way of the extraordinary Mac application
<strong>iTerm2</strong> feels like home and it is a completely different experience than
working in <code>tmux</code> the way we have, so far.</p>
<p>iTerm2 is a sort of fully customizable and <em>way</em> better replacement for the
standard Mac Terminal application. It can be downloaded for free
from its web page <a href="https://www.iterm2.com/">https://www.iterm2.com/</a>. You can
donate to the project there as well. If you find that you really like iTerm2,
I recommend a donation to support the developers.</p>
<p>There are far too many features in iTerm2 to cover here, but I just want to describe
one very important feature: iTerm2 integration with <code>tmux</code>. If you have survived the
last section, and have gotten comfortable with hitting <code>&lt;cntrl&gt;-b</code> and then a series
of different letters to effect various changes, then that is a good thing, and will
serve you well. However, as you continue your journey with <code>tmux</code>, you may have found that
you can’t scroll up through the screen the way you might be used to when working in Terminal
on a Mac. Further, you may have discovered that copying text from the screen, when you
finally figured out how to scroll up in it, involves a series of emacs-like keystrokes.
This is fine if you are up for it, but it is understandable that a Mac user might yearn
for a more Mac-like experience. Fortunately, the developers of iTerm2 have made your tmux experience
much better! They exploit <code>tmux</code>’s <code>-CC</code> option, which puts <code>tmux</code> into “control mode” such that
iTerm2 can send its own simple text commands to control <code>tmux</code>, rather than the user sending
commands prefaced by <code>&lt;cntrl&gt;-b</code>. The consequence of this is that iTerm2 has a series of menu options
for doing <code>tmux</code> actions, and all of these have keyboard shortcuts that seem more natural to
a Mac user. You can establish sessions, open new windows (as tabs in iTerm, if desired) and
even carve windows up into multiple panels—all from a Mac-style interface that is quite forgiving
in case you happen to forget the exact key sequence to do something in <code>tmux</code>.
Finally, using <code>tmux</code> via iTerm2 you get mouse interaction like you expect: you can use the
mouse to select different panes and move the dividers between them, and you can scroll back
and select text with the mouse, if desired.</p>
<p>On top of that, iTerm2 has great support for creating different profiles that you can
assign to different remote servers. These can be customized with different login actions
(including storage of remote server passwords in the Apple keychain, so you don’t have
to type in your long, complex passwords every time you log in to a remote server you
can’t set a public/private keypair on), and with different color schemes that can help you
to keep various windows attached to various remote servers straight.</p>
<p>You can read about it all at the iTerm2 website. I will just add that using
iTerm with <code>tmux</code> might require a later version of <code>tmux</code> than is installed
on your remote server or cluster. I recommend that you use Miniconda (see Section <a href="working-on-remote-servers.html#miniconda">7.5.2</a>)
to install tmux version 2.9 into your base environment with <code>conda install -c conda-forge tmux=2.9</code>.
Before you do that, be sure to kill all existing tmux sessions on your remote server.
Then, you could make a profile named, say <code>summit-tmux</code>, that launched with a command
that was like this:</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb238-1"><a href="working-on-remote-servers.html#cb238-1"></a><span class="fu">ssh</span> -t eriq@colostate.edu@login11.rc.colorado.edu <span class="st">&quot;/projects/eriq@colostate.edu/miniconda3/bin/tmux -CC attach -t summit || /projects/eriq@colostate.edu/miniconda3/bin/tmux -CC new -s summit&quot;</span></span></code></pre></div>
But customized to your own account name. What that does when you open a <code>summit-tmux</code> session is
<code>ssh</code> to SUMMIT, and immediately run the command in the double quotes. That command says,
“try to attach to a <code>tmux</code> session named <code>summit</code>. If that fails, then create a new
<code>tmux</code> session called <code>summit</code>.” To get the password manager set up for that profile,
you need to add to the password manager an account (call it <code>summit</code>) and store your summit
password in that manager. Then, in your summit-tmux profile, set a trigger (Profile-&gt;Advanced-&gt;Triggers (Edit))
which looks for the regular expression <code>^Password:</code>, does the action “Open Password Manager”, and does so
instantly. Figure <a href="working-on-remote-servers.html#fig:iterm-trigger">7.4</a> is a screen shot of what that setup looks like in my SUMMIT profile:
<div class="figure"><span id="fig:iterm-trigger"></span>
<img src="figs/iterm-pw-trigger.png" alt="How to set a trigger to open the password manager in iTerm to be able to pass in your password.  This is telling iTerm to open the Password Manager whenever it finds `Password:` at the beginning of a line in the terminal." width="923" />
<p class="caption">
FIGURE 7.4: How to set a trigger to open the password manager in iTerm to be able to pass in your password. This is telling iTerm to open the Password Manager whenever it finds <code>Password:</code> at the beginning of a line in the terminal.
</p>
</div>
<p>If you are a Mac user, spend a weekend getting to know iTerm2. It will be time well spent.</p>
</div>
<div id="installing-software-on-an-hpcc" class="section level2">
<h2><span class="header-section-number">7.5</span> Installing Software on an HPCC</h2>
<p>In order to do anything useful on a remote computer or a
high-performance computing cluster (called a “cluster” or an “HPCC”)
you will need to have software programs
for analyzing data. As we have seen, a lot of the nuts and bolts of writing command
lines uses utilities that are found on every Unix computer. However almost always
your bioinformatic analyses will require programs or software that
do not come “standard” with Unix. For example, the specialized programs for
sequence assembly and alignment will have to be <em>installed</em> on the cluster
in order for you to be able to use them.</p>
<p>It turns out that installing software on a Unix machine (or cluster) has not
always been a particularly easy thing to do for a number or reasons. First, for
a long time, Unix software was largely distributed in the form of <em>source code</em>: the
actual programming code (text) written by the developers that describes the actions
that a program takes. Such computer code cannot be run directly, it first must be
<em>compiled</em> into a <em>binary</em> or <em>executable</em> program. Doing this can be a challenging
process. First, computer code compilation can be very time consuming (if you use R
on Linux, and install all your packages from CRAN—which requires compilation—you
will know that!). Secondly, vexing errors and failures can occur when the
compiler or the computer architecture is in conflict with the program code. (I have lost
entire days trying to solve compiling problems). On top of that, in order to run, most
programs do not operate in a standalone fashion; rather, while a program is running, it
typically depends on computer code and routines that must be stored in separate <em>libraries</em> on your
Unix computer. These libraries are known as program <em>dependencies</em>. So, installing a program
requires not just installing the program itself, but also ensuring that the program’s dependencies
are installed <em>and</em> that the program knows where they are installed. As if that were not enough,
the dependencies of some programs can conflict (be incompatible) with the dependencies of other
programs, and particular versions of a program might require particular versions of
the dependencies. Additionally, some versions of some programs might not work with particular
versions (types of chips) of some computer systems. Finally, most systems for installing
software that were in place on Unix
machines a decade ago required that whoever was installing software have <em>administrative privileges</em>
on the computer. On an HPCC, none of the typical users have administrative privileges which are,
as you might guess, reserved for the system administrators.</p>
<p>For all the reasons above, installing software on an HPCC used to be a harrowing
affair: you either had to be fluent in compilers and libraries to do it yourself in your
home directory or you had to beg your system administrator. (Though our cluster computing
sysadmins at NMFS are wonderful, that is not always the case…<a href="https://www.wiw.org/~chris/archive/dilbert/">see Dilbert</a>).
On HPCC’s the system administrators have to contend with requests from multiple users
for different software and different versions. They solve this (somewhat headachey)
problem by installing software into separate “compartments” that allow different software
and versions to be maintained on the system without all of it being accessible at once.
Doing so, they create <em>modules</em> of software. This is discussed in the following section.</p>
<p>Today, however, a large group of motivated people have created a software management
system called Miniconda that tries to solve many of the problems encountered in maintaining
software on a computer system. First, Miniconda maintains a huge repository of
programs that are already <em>pre-compiled</em> for a number of different chip architectures, so that
programs can usually be installed without the time-consuming compiling process. Second, the repository
maintains critical information on the dependencies for each software program, and about
conflicts and incompatibilities between different versions of programs, architectures and
dependencies. Third, the Miniconda system is built from the ground up to make it easy to maintain
separate software <em>environments</em> on your system. These different environments have different
software programs or different versions of different software programs. Such an approach
was originally used so developers could use a single computer to test any new code
they had written in a number of different
computing environments; however, it has become an incredibly valuable tool for ensuring
that your analyses are reproducible: you can give people not just the data and scripts that you
used for the analysis, but also the computing/software environment (with all the same
software versions) that you used for the analysis. And, finally, all of this
can be done with Miniconda without having administrative privileges. Effectively,
Miniconda manages all these software programs and dependencies <em>within your home directory</em>.
Section <a href="working-on-remote-servers.html#miniconda">7.5.2</a> provides details about Miniconda and describes how to use it
to install bioinformatics software.</p>
<div id="modules" class="section level3">
<h3><span class="header-section-number">7.5.1</span> Modules</h3>
<p>The easiest way to install software on a remote computer of HPCC is to have someone
else do it! On HPCCs it is common for the system administrators to install software into
different “compartments” using the <code>module</code> utility. This allows for a large number of
different software packages to be “pre-installed” on the computer, but the software
is not accessible/usable until the user explicitly asks for the software to be made
available in a shell. Users ask for software to be made available in the shell
with the <code>module load</code> <em>modulefile</em> command. The main action of such a command is to
modify the user’s PATH variable to include the software’s location. (Sometimes, additional
shell environment variables are set). By managing software in this way, system administrators
can keep dependency conflicts
between different software programs that are seldom used together from causing problems.</p>
<p>If you work on an HPCC with administrators who are attuned to people doing bioinformatic
work, then all the software you might need could alread be available using in modules. To
see what software is available you can use <code>module avail</code>. For example, on the SEDNA cluster
which was developed for genomic research, <code>module avail</code> shows a wide range of different
software specific to sequence assembly, alignment, and analysis:</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb239-1"><a href="working-on-remote-servers.html#cb239-1"></a><span class="ex">%</span> module avail</span>
<span id="cb239-2"><a href="working-on-remote-servers.html#cb239-2"></a></span>
<span id="cb239-3"><a href="working-on-remote-servers.html#cb239-3"></a><span class="ex">-------------------------</span> /usr/share/Modules/modulefiles --------------------------</span>
<span id="cb239-4"><a href="working-on-remote-servers.html#cb239-4"></a><span class="ex">dot</span>         module-git  module-info modules     null        use.own</span>
<span id="cb239-5"><a href="working-on-remote-servers.html#cb239-5"></a></span>
<span id="cb239-6"><a href="working-on-remote-servers.html#cb239-6"></a><span class="ex">--------------------------------</span> /act/modulefiles ---------------------------------</span>
<span id="cb239-7"><a href="working-on-remote-servers.html#cb239-7"></a><span class="ex">impi</span>                mvapich2-2.2/gcc    openmpi-1.8/gcc     openmpi-3.0.1/gcc</span>
<span id="cb239-8"><a href="working-on-remote-servers.html#cb239-8"></a><span class="ex">intel</span>               mvapich2-2.2/intel  openmpi-1.8/intel   openmpi-3.0.1/intel</span>
<span id="cb239-9"><a href="working-on-remote-servers.html#cb239-9"></a><span class="ex">mpich/gcc</span>           openmpi-1.6/gcc     openmpi-2.1.3/gcc</span>
<span id="cb239-10"><a href="working-on-remote-servers.html#cb239-10"></a><span class="ex">mpich/intel</span>         openmpi-1.6/intel   openmpi-2.1.3/intel</span>
<span id="cb239-11"><a href="working-on-remote-servers.html#cb239-11"></a></span>
<span id="cb239-12"><a href="working-on-remote-servers.html#cb239-12"></a><span class="ex">-------------------------</span> /opt/bioinformatics/modulefiles -------------------------</span>
<span id="cb239-13"><a href="working-on-remote-servers.html#cb239-13"></a><span class="ex">aligners/bowtie2/2.3.5.1</span> bio/fastqc/0.11.9        bio/stacks/2.5</span>
<span id="cb239-14"><a href="working-on-remote-servers.html#cb239-14"></a><span class="ex">aligners/bwa/0.7.17</span>      bio/gatk/4.1.5.0         compilers/gcc/4.9.4</span>
<span id="cb239-15"><a href="working-on-remote-servers.html#cb239-15"></a><span class="ex">assemblers/trinity/2.9.1</span> bio/hmmer/3.2.1          compilers/gcc/8.3.0</span>
<span id="cb239-16"><a href="working-on-remote-servers.html#cb239-16"></a><span class="ex">bio/angsd/0.931</span>          bio/jellyfish/2.3.0      lib64/mpc-1.1.0</span>
<span id="cb239-17"><a href="working-on-remote-servers.html#cb239-17"></a><span class="ex">bio/augustus/3.2.3</span>       bio/mothur/1.43.0        R/3.6.2</span>
<span id="cb239-18"><a href="working-on-remote-servers.html#cb239-18"></a><span class="ex">bio/bamtools/2.5.1</span>       bio/picard/2.22.0        tools/cmake/3.16.4</span>
<span id="cb239-19"><a href="working-on-remote-servers.html#cb239-19"></a><span class="ex">bio/bcftools/1.10.2</span>      bio/prodigal/2.6.3       tools/pigz/2.4</span>
<span id="cb239-20"><a href="working-on-remote-servers.html#cb239-20"></a><span class="ex">bio/blast/2.10.0+</span>        bio/salmon/1.1.0</span>
<span id="cb239-21"><a href="working-on-remote-servers.html#cb239-21"></a><span class="ex">bio/blast/2.2.31+</span>        bio/samtools/1.10</span></code></pre></div>
<p>Most of the bioinformatics tools are stored in the directory
<code>/opt/bioinformatics/modulefiles</code>, which is not a standard storage location for
modules, so, if you are using SEDNA, and you want to use these modules,
you must include that path in the <code>MODULEPATH</code> shell environment variable.
This can be done by updating the <code>MODULEPATH</code> in your <code>~/.bashrc</code> file, adding
the line:</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb240-1"><a href="working-on-remote-servers.html#cb240-1"></a><span class="bu">export</span> <span class="va">MODULEPATH=${MODULEPATH}</span>:/opt/bioinformatics/modulefiles</span></code></pre></div>
<p>Once that is accomplished, every time you open a new shell, your <code>MODULEPATH</code> will be
set appropriately.</p>
<p>If you work on an HPCC that is not heavily focused on bioinformatics (for example, the SUMMIT
supercomputer at UC Boulder) then you might not find any bioinformatics utilities available in
the modules. You will then have to install your own software as described in
Section <a href="working-on-remote-servers.html#miniconda">7.5.2</a>; however, you will still be able to use the modules system
to run java-based programs, so it is good to understand the <code>module</code> command.</p>
<p>The <code>module</code> command has a large number of subcommands which are invoked
with a word immediately following the <code>module</code> command. We have already seen
how <code>module avail</code> lists the available modules. The other most important commands
appear in Table <a href="working-on-remote-servers.html#tab:module">7.3</a>.</p>
<table style="width:79%;">
<caption><span id="tab:module">TABLE 7.3: </span> Important subcommands used with <code>module</code>. In the following, <em>modulefile</em>, where it appears, refers to the name of a modulefile.</caption>
<colgroup>
<col width="33%" />
<col width="45%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Module Subcommand</th>
<th align="left">What it does</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>avail</code></td>
<td align="left">Lists available modules (i.e.,
software that can be loaded as
a module)</td>
</tr>
<tr class="even">
<td align="left"><code>add</code> <em>modulefile</em></td>
<td align="left">same as <code>load</code> <em>modulefile</em></td>
</tr>
<tr class="odd">
<td align="left"><code>list</code></td>
<td align="left">list all currently loaded
modulefiles.</td>
</tr>
<tr class="even">
<td align="left"><code>load</code> <em>modulefile</em></td>
<td align="left">add the necessary ingredients
to one’s shell to be able to
run the programs contained in
<em>modulefile</em>.</td>
</tr>
<tr class="odd">
<td align="left"><code>purge</code></td>
<td align="left">unload all the currently
loaded modulefiles.</td>
</tr>
<tr class="even">
<td align="left"><code>rm</code> <em>modulefile</em></td>
<td align="left">same as <code>unload</code> <em>modulefile</em>.</td>
</tr>
<tr class="odd">
<td align="left"><code>show</code> <em>modulefile</em></td>
<td align="left">describe the <em>modulefile</em> and
the changes to the PATH and
other shell evironment
variables that occur when
loading the <em>modulefile</em></td>
</tr>
<tr class="even">
<td align="left"><code>unload</code> <em>modulefile</em></td>
<td align="left">reverse the changes made to
the shell environment made by
<code>load</code> <em>modulefile</em></td>
</tr>
</tbody>
</table>
<p>Let’s play with the modulefiles (if any) on your HPCC! First, get an interactive session
on a compute node. On SUMMIT:</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb241-1"><a href="working-on-remote-servers.html#cb241-1"></a> <span class="ex">srun</span> --partition=shas-interactive --export=ALL --pty /bin/bash</span></code></pre></div>
<p>Then list the modulefiles available:</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb242-1"><a href="working-on-remote-servers.html#cb242-1"></a><span class="ex">module</span> avail</span></code></pre></div>
<p>You might notice that multiple versions of some programs are available, like:</p>
<pre><code>R/3.3.0
R/3.4.3
R/3.5.0</code></pre>
<p>In such a case, the latest version is typically the default version that will be loaded
when you request that a program modulefile be loaded, though you can specifically
request that a particular version be loaded. On SUMMIT, check to make sure that the R program
is not available by default:</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb244-1"><a href="working-on-remote-servers.html#cb244-1"></a><span class="co"># try to launch R</span></span>
<span id="cb244-2"><a href="working-on-remote-servers.html#cb244-2"></a><span class="ex">R</span></span></code></pre></div>
<p>You should be told:</p>
<pre><code>bash: R: command not found</code></pre>
<p>If not, you may have already loaded the R modulefile, or you might have R available from
an activated <code>conda</code> environment (see below).</p>
<p>To make R available via <code>module</code> you use:</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb246-1"><a href="working-on-remote-servers.html#cb246-1"></a><span class="ex">module</span> load R</span>
<span id="cb246-2"><a href="working-on-remote-servers.html#cb246-2"></a></span>
<span id="cb246-3"><a href="working-on-remote-servers.html#cb246-3"></a><span class="co"># now check to see if it works:</span></span>
<span id="cb246-4"><a href="working-on-remote-servers.html#cb246-4"></a><span class="ex">R</span></span>
<span id="cb246-5"><a href="working-on-remote-servers.html#cb246-5"></a></span>
<span id="cb246-6"><a href="working-on-remote-servers.html#cb246-6"></a><span class="co"># check the version number when it launches</span></span>
<span id="cb246-7"><a href="working-on-remote-servers.html#cb246-7"></a><span class="co"># to get out of R, type: quit()  and hit RETURN</span></span></code></pre></div>
<p>To list the active modulefiles, try:</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb247-1"><a href="working-on-remote-servers.html#cb247-1"></a><span class="ex">module</span> list</span></code></pre></div>
<p>This is quite interesting. It shows that several other modulefiles,
above and beyond R,
have been loaded as well. These are additional dependencies that the R module
depends on.</p>
<p>To remove all the modulefiles that have been loaded, do:</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb248-1"><a href="working-on-remote-servers.html#cb248-1"></a><span class="ex">module</span> purge</span>
<span id="cb248-2"><a href="working-on-remote-servers.html#cb248-2"></a></span>
<span id="cb248-3"><a href="working-on-remote-servers.html#cb248-3"></a><span class="co"># after that, check to see that no modules are currently loaded:</span></span>
<span id="cb248-4"><a href="working-on-remote-servers.html#cb248-4"></a><span class="ex">module</span> list</span></code></pre></div>
<p>If you are curious about what happens when a module file is loaded,
you can use the <code>show</code> subcommand, as in <code>module show</code> <em>modulefile</em>:</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb249-1"><a href="working-on-remote-servers.html#cb249-1"></a><span class="ex">module</span> show R</span></code></pre></div>
<p>The output is quite informative.</p>
<p>To get a different version of a program available from <code>module</code>, just
include the modulefile with its version number as it appears when printed
from <code>module avail</code>, like:</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb250-1"><a href="working-on-remote-servers.html#cb250-1"></a><span class="ex">module</span> load R/3.3.0</span>
<span id="cb250-2"><a href="working-on-remote-servers.html#cb250-2"></a></span>
<span id="cb250-3"><a href="working-on-remote-servers.html#cb250-3"></a><span class="co"># check to see which modulefiles got loaded:</span></span>
<span id="cb250-4"><a href="working-on-remote-servers.html#cb250-4"></a><span class="ex">module</span> list  </span>
<span id="cb250-5"><a href="working-on-remote-servers.html#cb250-5"></a><span class="co"># aha! this version of R goes with a different version of the</span></span>
<span id="cb250-6"><a href="working-on-remote-servers.html#cb250-6"></a><span class="co"># intel compiler...</span></span>
<span id="cb250-7"><a href="working-on-remote-servers.html#cb250-7"></a></span>
<span id="cb250-8"><a href="working-on-remote-servers.html#cb250-8"></a><span class="co"># check the version number of R by running it:</span></span>
<span id="cb250-9"><a href="working-on-remote-servers.html#cb250-9"></a><span class="ex">R</span></span>
<span id="cb250-10"><a href="working-on-remote-servers.html#cb250-10"></a></span>
<span id="cb250-11"><a href="working-on-remote-servers.html#cb250-11"></a><span class="co"># use quit() to get out of R.</span></span></code></pre></div>
<p>Once again, purge your modulefiles:</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb251-1"><a href="working-on-remote-servers.html#cb251-1"></a><span class="ex">module</span> purge</span></code></pre></div>
<p>and then try to give the <code>java</code> command:</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb252-1"><a href="working-on-remote-servers.html#cb252-1"></a><span class="ex">java</span></span></code></pre></div>
<p>You should be told that the command <code>java</code> is not found.</p>
<p>There are several useful bioinformatics programs that are written in Java.
Java is a language that can run on many different computer architectures
<em>without being specifically compiled</em> for that architecture. However, in order to
run a program written in Java, the computer must have a “Java Runtime Environment” or JRE.
Running the <code>java</code> command above and having no luck shows that by default, SUMMIT (and most
supercomputers) do not have a JRE available by default. However, almost all HPCCs will
have a JRE available as in a modulefile containing the Java Development Kit, or JDK.</p>
<p>Look at the output of <code>module avail</code> and find <code>jdk</code>, then load that modulefile:</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb253-1"><a href="working-on-remote-servers.html#cb253-1"></a><span class="ex">module</span> load jdk</span>
<span id="cb253-2"><a href="working-on-remote-servers.html#cb253-2"></a></span>
<span id="cb253-3"><a href="working-on-remote-servers.html#cb253-3"></a><span class="co"># after that, check to see if java is available:</span></span>
<span id="cb253-4"><a href="working-on-remote-servers.html#cb253-4"></a><span class="ex">java</span></span></code></pre></div>
<p>You will need to load the <code>jdk</code> module file in order to run the Java-based bioinformatics
program called GATK.</p>
<p>Note that every time you get a start a new shell on your HPCC, you will typically not have
any modulefiles loaded (or will only have a few default modulefiles loaded). For this reason
it is important, when you submit jobs using SLURM (see Section <a href="high-performance-computing-clusters-hpccs.html#slurm-batch">8.4.2</a>) that
require modulefiles, the <code>module load</code> <em>modulefile</em> command for those modules should appear
within the script submitted to SLURM.</p>
<p>Finally, we will note that the <code>module</code> utility works somewhat differently than the
<code>conda</code> environments described in the next section. Namely, <code>conda</code> environments
are “all-or-nothing” environments that include different programs. You can’t activate
a <code>conda</code> environment, and then add more programs to it by activating another
<code>conda</code> environment “on top of” the previous one. Rather, when activating a <code>conda</code>
environment, the configurations of any existing, activated environment are completely
discarded. By contrast, modulefiles can be layered on top of one another. So, for example,
if you needed <code>R</code>, <code>samtools</code>, and <code>bcftools</code>, and these were all maintained in
separate modulefiles on your HPCC, then you could load them all, alongside one another,
with:</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb254-1"><a href="working-on-remote-servers.html#cb254-1"></a><span class="ex">module</span> load R</span>
<span id="cb254-2"><a href="working-on-remote-servers.html#cb254-2"></a><span class="ex">module</span> load samtools</span>
<span id="cb254-3"><a href="working-on-remote-servers.html#cb254-3"></a><span class="ex">module</span> load bcftools</span></code></pre></div>
<p>Unlike a Miniconda environment, when you layer modulefiles no top of one another
like this, conflicts between the dependencies may occur. When that happens,
it is up to the sysadmins to figure it out. This is perhaps why the modulefiles
on a typical HPCC may often carry older (if not
completely antiquated) versions of software. In general, if you want to run
newer versions of software on your HPCC, you will often have to install it yourself.
Doing so has traditionally been difficult, but a packages management system called
Miniconda has made it considerably easier today.</p>
</div>
<div id="miniconda" class="section level3">
<h3><span class="header-section-number">7.5.2</span> Miniconda</h3>
<p>We will first walk you through a few steps with Miniconda to install some
bioinformatic software into an environment on your cluster. After that we will discuss more about
the underlying philosophy of Miniconda, and how it is operating.</p>
<div id="installing-or-updating-miniconda" class="section level4">
<h4><span class="header-section-number">7.5.2.1</span> Installing or updating Miniconda</h4>
<ol style="list-style-type: decimal">
<li><p>To do installation of software, you probably should not be on SUMMIT’s login nodes.
They offer “compile nodes” that should be suitable for installing with Miniconda. So, do this:</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb255-1"><a href="working-on-remote-servers.html#cb255-1"></a><span class="fu">ssh</span> scompile</span></code></pre></div></li>
<li><p>If you are on Hummingbird, be sure to get a <code>bash</code> shell before doing anything else, by typing <code>bash</code>
(if you have not already set <code>bash</code> as your default shell (see the previous chapter)).</p></li>
<li><p>First, check if you have Miniconda. Update it if you do, and install it if you don’t:</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb256-1"><a href="working-on-remote-servers.html#cb256-1"></a><span class="co"># just type conda at the command line:</span></span>
<span id="cb256-2"><a href="working-on-remote-servers.html#cb256-2"></a><span class="ex">conda</span></span></code></pre></div>
<p>If you see some help information, then you already have Miniconda (or Anaconda) and you
should merely update it with:</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb257-1"><a href="working-on-remote-servers.html#cb257-1"></a><span class="ex">conda</span> update conda</span></code></pre></div>
<p>If you get an error telling you that your computer does not know about a command, <code>conda</code>, then
you do not have Miniconda and you must install it. You do that by downloading the Miniconda package
with <code>wget</code> and then running the Miniconda installer, like this:</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb258-1"><a href="working-on-remote-servers.html#cb258-1"></a><span class="co"># start in your home directory and do the following:</span></span>
<span id="cb258-2"><a href="working-on-remote-servers.html#cb258-2"></a><span class="fu">mkdir</span> conda_install</span>
<span id="cb258-3"><a href="working-on-remote-servers.html#cb258-3"></a><span class="bu">cd</span> conda_install/</span>
<span id="cb258-4"><a href="working-on-remote-servers.html#cb258-4"></a><span class="fu">wget</span> https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh</span>
<span id="cb258-5"><a href="working-on-remote-servers.html#cb258-5"></a><span class="fu">chmod</span> u+x Miniconda3-latest-Linux-x86_64.sh </span>
<span id="cb258-6"><a href="working-on-remote-servers.html#cb258-6"></a><span class="ex">./Miniconda3-latest-Linux-x86_64.sh</span> </span></code></pre></div>
<p>That launches the Miniconda installer (it is a shell script). Follow the prompts and agree
to the license and to the default install location and to initialize conda.
At the end, it tells you to log out of your shell and log back in for changes to take
effect. It turns out that it suffices to do <code>cd ~; source .bash_profile</code></p></li>
</ol>
<p>Once you complete the above, your command prompt should have been changed to something that looks like:</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb259-1"><a href="working-on-remote-servers.html#cb259-1"></a><span class="kw">(</span><span class="ex">base</span><span class="kw">)</span> [<span class="ex">~</span>]<span class="ex">--%</span></span></code></pre></div>
<p>The <code>(base)</code> is telling you that you are in Miniconda’s <em>base</em> environment. Typically you want to keep the
<em>base</em> environment clean of installed software, so we will install software into a new environment.</p>
</div>
<div id="installing-software-into-a-bioinformatics-environment" class="section level4">
<h4><span class="header-section-number">7.5.2.2</span> Installing software into a bioinformatics environment</h4>
<p>If everything went according to plan above, then we are ready to use Miniconda to
install some software for bioinformatics. We will install a few programs that we will
use extensively in the next few weeks: <code>bwa</code>, <code>samtools</code>, and <code>bcftools</code>. We will
install these programs into a conda environment that we will name <code>bioinf</code> (short
for “bioinformatics”). It takes just a single command:</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb260-1"><a href="working-on-remote-servers.html#cb260-1"></a><span class="ex">conda</span> create -n bioinf -c bioconda bwa samtools bcftools</span></code></pre></div>
<p>That should only take a few seconds.</p>
<p>To test that we got the programs we must <em>activate</em> the <code>bioinf</code> environment, and then issue
the commands, <code>bwa</code>, <code>samtools</code>, and <code>bcftools</code>. Each of those should spit back some help
information. If so, that means they are installed correctly! It looks like this:</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb261-1"><a href="working-on-remote-servers.html#cb261-1"></a><span class="ex">conda</span> activate bioinf</span></code></pre></div>
<p>After that you should get a command prompt that starts with <code>(bioinf)</code>, telling you that the
active conda environment is <code>bioinf</code>. Now, try these commands:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb262-1"><a href="working-on-remote-servers.html#cb262-1"></a><span class="ex">bwa</span></span>
<span id="cb262-2"><a href="working-on-remote-servers.html#cb262-2"></a><span class="ex">samtools</span></span>
<span id="cb262-3"><a href="working-on-remote-servers.html#cb262-3"></a><span class="ex">bcftools</span></span></code></pre></div>
</div>
<div id="uninstalling-miniconda-and-its-associated-environments" class="section level4">
<h4><span class="header-section-number">7.5.2.3</span> Uninstalling Miniconda and its associated environments</h4>
<p>It may become necessary at some point to uninstall Miniconda. One important case of this
is if you end up overflowing your home directory with conda-installed software. In this case,
unless you have installed numerous, complex environments, the simplest thing to do is
to “uninstall” Miniconda, reinstall it in a location with fewer hard-drive space constraints,
and then simply recreate the environments you need, as you did originally.</p>
<p>This is actually quite germane to SUMMIT users. The size quota on home directories on SUMMIT is
only 2 Gb, so you can easily fill up your home directory by installing a few conda environments.
To check how much of the hard
drive space allocated to you is in use on SUMMIT, use the <code>curc-quota</code> command. (Check the documentation
for how to check space on other HPCCs, but note that Hummingbird users get 1 TB on their home
directories). Instead of
using your home directory to house your Miniconda software, on SUMMIT you can put it in your
<code>projects</code> storage area. Each user gets more storage (like 250 Gb) in a directory
called <code>/projects/username</code> where <code>username</code> is replaced by your SUMMIT username,
for example: <code>/projects/eriq@colostate.edu</code></p>
<p>To “uninstall” Miniconda, you first must delete the <code>miniconda3</code> directory in your
home directory (if that is where it got installed to). This can take a while. It is done with:</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb263-1"><a href="working-on-remote-servers.html#cb263-1"></a><span class="fu">rm</span> -rf ~/miniconda3</span></code></pre></div>
<p>Then you have to delete the lines between <code># &gt;&gt;&gt;</code> and <code># &lt;&lt;&lt;</code>, wherever they occur in your <code>~/.bashrc</code> and <code>~/bash_profile</code>
files, i.e., you will have to remove all of the lines that look
something like thius:</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb264-1"><a href="working-on-remote-servers.html#cb264-1"></a><span class="co"># &gt;&gt;&gt; conda initialize &gt;&gt;&gt;</span></span>
<span id="cb264-2"><a href="working-on-remote-servers.html#cb264-2"></a><span class="co"># !! Contents within this block are managed by &#39;conda init&#39; !!</span></span>
<span id="cb264-3"><a href="working-on-remote-servers.html#cb264-3"></a><span class="va">__conda_setup=</span><span class="st">&quot;</span><span class="va">$(</span><span class="st">&#39;/Users/eriq/miniconda3/bin/conda&#39;</span> <span class="st">&#39;shell.bash&#39;</span> <span class="st">&#39;hook&#39;</span> <span class="op">2&gt;</span> <span class="ex">/dev/null</span><span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb264-4"><a href="working-on-remote-servers.html#cb264-4"></a><span class="kw">if</span><span class="bu"> [</span> <span class="va">$?</span> <span class="ot">-eq</span> 0<span class="bu"> ]</span>; <span class="kw">then</span></span>
<span id="cb264-5"><a href="working-on-remote-servers.html#cb264-5"></a>    <span class="bu">eval</span> <span class="st">&quot;</span><span class="va">$__conda_setup</span><span class="st">&quot;</span></span>
<span id="cb264-6"><a href="working-on-remote-servers.html#cb264-6"></a><span class="kw">else</span></span>
<span id="cb264-7"><a href="working-on-remote-servers.html#cb264-7"></a>    <span class="kw">if</span><span class="bu"> [</span> <span class="ot">-f</span> <span class="st">&quot;/Users/eriq/miniconda3/etc/profile.d/conda.sh&quot;</span><span class="bu"> ]</span>; <span class="kw">then</span></span>
<span id="cb264-8"><a href="working-on-remote-servers.html#cb264-8"></a>        <span class="bu">.</span> <span class="st">&quot;/Users/eriq/miniconda3/etc/profile.d/conda.sh&quot;</span></span>
<span id="cb264-9"><a href="working-on-remote-servers.html#cb264-9"></a>    <span class="kw">else</span></span>
<span id="cb264-10"><a href="working-on-remote-servers.html#cb264-10"></a>        <span class="bu">export</span> <span class="va">PATH=</span><span class="st">&quot;/Users/eriq/miniconda3/bin:</span><span class="va">$PATH</span><span class="st">&quot;</span></span>
<span id="cb264-11"><a href="working-on-remote-servers.html#cb264-11"></a>    <span class="kw">fi</span></span>
<span id="cb264-12"><a href="working-on-remote-servers.html#cb264-12"></a><span class="kw">fi</span></span>
<span id="cb264-13"><a href="working-on-remote-servers.html#cb264-13"></a><span class="bu">unset</span> <span class="va">__conda_setup</span></span>
<span id="cb264-14"><a href="working-on-remote-servers.html#cb264-14"></a><span class="co"># &lt;&lt;&lt; conda initialize &lt;&lt;&lt;</span></span></code></pre></div>
<p>After all those conda lines are removed from your <code>~/.bashrc</code> and <code>~/bash_profile</code>, logging out
and logging back in, you should be free from conda and ready to reinstall it in
a different location.</p>
<p>To reinstall miniconda in a different location, just follow the
installation instructions above, but when you are running the
<code>./Miniconda3-latest-Linux-x86_64.sh</code> script, instead of choosing the default
install location, use a location in your project directory. For example, for me, that is:
<code>/projects/eriq@colostate.edu/miniconda3</code>.</p>
<p>Then, recreate the <code>bioinf</code> environment described above.</p>
<p>If you are having fun making environments and you think that you might like to use R on
the cluster, then you might want to make an environment with some bioinformatics software
that also has
the latest version of R on miniconda installed. At the time of writing that was R 3.6.1. So,
do:</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb265-1"><a href="working-on-remote-servers.html#cb265-1"></a><span class="ex">conda</span> create -n binfr -c bioconda bwa samtools bcftools r-base=3.6.1 r-essentials</span></code></pre></div>
<p>That makes an environment called <code>binfr</code> (which turns out to also be <strong>way</strong> easier to type that <code>bioinfr</code>).
The <code>r-essentials</code> in the above command line is the name for a collection of 200 commonly used R packages (including
the <code>tidyverse</code>). This procedure takes a little while, but it is still far less painful than using the
version of R that is installed on SUMMIT with the <code>modules</code> packages, and then trying to build the tidyverse
from source with <code>install.packages()</code>.</p>
</div>
<div id="what-is-miniconda-doing" class="section level4">
<h4><span class="header-section-number">7.5.2.4</span> What is Miniconda doing?</h4>
<p>This is a good question. We won’t go deeply into the specifics, but will skim the
surface of a few topics that can help you understand what Miniconda is doing.</p>
<p>First, Miniconda is downloading programs and their dependencies into the <code>miniconda3</code>
directory. Based on the lists of dependencies and conflicts for each program that is being
installed, it makes a sort of “equation,” which it can “solve” to find the versions of
different programs and libraries that can be installed and which should “play nicely with
one another (and with your specific computer architecture.” While it is solving this
“equation” it is doing so while also doing its best
to optimize features of the programs (like using the latest versions, if possible).
Solving this “equation” is an example of a Boolean Satisfiability problem, which is a known
class of difficult (time-consuming) problems. If you are requesting a lot of programs, and
especially if you do not constrain your request (by demanding a certain version of
the program) then “solving” the request may take a long time. However, when installing
just a few bioinformatics programs it is unlikely to ever take too terribly long.</p>
<p>Once miniconda has decided on which versions of which programs and dependencies to install,
it downloads them and then places them into the requested environment (or the active environment
if no environment is specifically requested). If a program is installed into an environment, then you
can access that program by activating the environment (i.e. <code>conda activate bioinf</code>). Importantly,
if you don’t activate the environment, you won’t be able to use the programs installed there.
We will see later in writing bioinformatic scripts, you will always have to explicitly
activate a desired conda environment when you run a script on a compute node through the job
scheduler.</p>
<p>The way that Miniconda delivers programs in an environment is by storing all the programs
in a special environment directory (within the <code>miniconda3/envs</code> directory), and then, when
the environment is activated, the main thing that is happening is that <code>conda</code> is manipulating your
PATH variable to include directories within the environment’s directory
within the <code>miniconda3/envs</code> directory. An easy way to see this is simply by
inspecting your path variable while in different environments. Here we compare the PATH
variable in the <code>base</code> environment, versus in the <code>bioinf</code> environment, versus in the
<code>binfr</code> environment:</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb266-1"><a href="working-on-remote-servers.html#cb266-1"></a><span class="kw">(</span><span class="ex">base</span><span class="kw">)</span> [<span class="ex">~</span>]<span class="ex">--%</span> echo <span class="va">$PATH</span></span>
<span id="cb266-2"><a href="working-on-remote-servers.html#cb266-2"></a><span class="ex">/projects/eriq@colostate.edu/miniconda3</span>/bin:<span class="ex">/projects/eriq@colostate.edu/miniconda3</span>/condabin:<span class="ex">/usr/local</span>/bin:/bin:<span class="ex">/usr</span>/bin:<span class="ex">/usr</span>/bin:<span class="ex">/usr/local</span>/sbin:<span class="ex">/usr</span>/sbin:<span class="ex">/home/eriq@colostate.edu</span>/bin:<span class="ex">/home/eriq@colostate.edu/bin</span></span>
<span id="cb266-3"><a href="working-on-remote-servers.html#cb266-3"></a><span class="kw">(</span><span class="ex">base</span><span class="kw">)</span> [<span class="ex">~</span>]<span class="ex">--%</span> conda activate bioinf</span>
<span id="cb266-4"><a href="working-on-remote-servers.html#cb266-4"></a><span class="kw">(</span><span class="ex">bioinf</span><span class="kw">)</span> [<span class="ex">~</span>]<span class="ex">--%</span> echo <span class="va">$PATH</span></span>
<span id="cb266-5"><a href="working-on-remote-servers.html#cb266-5"></a><span class="ex">/projects/eriq@colostate.edu/miniconda3/envs/bioinf</span>/bin:<span class="ex">/projects/eriq@colostate.edu/miniconda3</span>/condabin:<span class="ex">/usr/local</span>/bin:/bin:<span class="ex">/usr</span>/bin:<span class="ex">/usr</span>/bin:<span class="ex">/usr/local</span>/sbin:<span class="ex">/usr</span>/sbin:<span class="ex">/home/eriq@colostate.edu</span>/bin:<span class="ex">/home/eriq@colostate.edu/bin</span></span>
<span id="cb266-6"><a href="working-on-remote-servers.html#cb266-6"></a><span class="kw">(</span><span class="ex">bioinf</span><span class="kw">)</span> [<span class="ex">~</span>]<span class="ex">--%</span> conda activate binfr</span>
<span id="cb266-7"><a href="working-on-remote-servers.html#cb266-7"></a><span class="kw">(</span><span class="ex">binfr</span><span class="kw">)</span> [<span class="ex">~</span>]<span class="ex">--%</span> echo <span class="va">$PATH</span></span>
<span id="cb266-8"><a href="working-on-remote-servers.html#cb266-8"></a><span class="ex">/projects/eriq@colostate.edu/miniconda3/envs/binfr</span>/bin:<span class="ex">/projects/eriq@colostate.edu/miniconda3</span>/condabin:<span class="ex">/usr/local</span>/bin:/bin:<span class="ex">/usr</span>/bin:<span class="ex">/usr</span>/bin:<span class="ex">/usr/local</span>/sbin:<span class="ex">/usr</span>/sbin:<span class="ex">/home/eriq@colostate.edu</span>/bin:<span class="ex">/home/eriq@colostate.edu/bin</span></span></code></pre></div>
<p>(To be sure, <code>miniconda</code> can change a few more things than just your PATH variable when you activate an environment, but
for the typical user, the changes to PATH are most important.)</p>
</div>
<div id="what-programs-are-available-on-minconda" class="section level4">
<h4><span class="header-section-number">7.5.2.5</span> What programs are available on Minconda?</h4>
<p>There are quite a few programs for multiple platforms. If you are wondering
whether a particular program is available from Miniconda, the easiest first
step is to Google it. For example, search for <code>miniconda bowtie</code>.</p>
<p>You can also search from the command line using <code>conda search</code>. Note that most
bioinformatics programs you will be interested in are available on a conda
<em>channel</em> called <code>bioconda</code>. You probably saw the <code>-c bioconda</code> option
applied to the <code>conda create</code> commands above. That options tells conda to search
the Bioconda channel for programs and packages.</p>
<p>Here, you can try searching for a couple of packages that you might
end up using to analyze genomic data:</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb267-1"><a href="working-on-remote-servers.html#cb267-1"></a><span class="ex">conda</span> search -c bioconda plink</span>
<span id="cb267-2"><a href="working-on-remote-servers.html#cb267-2"></a></span>
<span id="cb267-3"><a href="working-on-remote-servers.html#cb267-3"></a><span class="co"># and next:</span></span>
<span id="cb267-4"><a href="working-on-remote-servers.html#cb267-4"></a></span>
<span id="cb267-5"><a href="working-on-remote-servers.html#cb267-5"></a><span class="ex">conda</span> search -c bioconda angsd</span></code></pre></div>
</div>
<div id="can-i-add-more-programs-to-an-environment" class="section level4">
<h4><span class="header-section-number">7.5.2.6</span> Can I add more programs to an environment?</h4>
<p>This is a worthwhile question. Imagine that we have been happily working in our <code>bioinf</code> conda environment
for a few months. We have finished all our tasks with <code>bwa</code>, <code>samtools</code>, and <code>bcftools</code>, but perhaps now we
want to analyze some of the data with <code>angsd</code> or <code>plink</code>. Can we add those programs to our
<code>bioinf</code> environment? The short answer is “Yes!”. The steps are easy.</p>
<ol style="list-style-type: decimal">
<li><p>Activate the environment you wish to add the programs to (i.e. <code>conda activate bioinf</code> for example).</p></li>
<li><p>Then use <code>conda install</code>. For example to install specific versions of <code>plink</code> and <code>angsd</code> that we
saw above while searching for those packages we might do:</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb268-1"><a href="working-on-remote-servers.html#cb268-1"></a><span class="ex">conda</span> install -c bioconda plink=1.90b6.12 angsd=0.931</span></code></pre></div></li>
</ol>
<p>Now, the longer answer is “Yes, but…” The big “but” there occurs because if different
programs require the same dependencies, but rely on different versions of the dependencies,
installing programs over different commands can cause miniconda to not identify some
incompatibilities between program dependencies. A germane example occurs if you first install
<code>samtools</code> into an environment, and then, after that, you install <code>bcftools</code>, like this:</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb269-1"><a href="working-on-remote-servers.html#cb269-1"></a><span class="ex">conda</span> create -n samtools-first        <span class="co"># create an empty environment</span></span>
<span id="cb269-2"><a href="working-on-remote-servers.html#cb269-2"></a><span class="ex">conda</span> activate samtools-first         <span class="co"># activate the environment</span></span>
<span id="cb269-3"><a href="working-on-remote-servers.html#cb269-3"></a><span class="ex">conda</span> install -c bioconda samtools    <span class="co"># install samtools</span></span>
<span id="cb269-4"><a href="working-on-remote-servers.html#cb269-4"></a><span class="ex">conda</span> install -c bioconda bcftools    <span class="co"># install bcftools</span></span>
<span id="cb269-5"><a href="working-on-remote-servers.html#cb269-5"></a><span class="ex">bcftools</span>                              <span class="co"># try running bcftools</span></span></code></pre></div>
<p>When you try running the last line, <code>bcftools</code> barfs on you like so:</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb270-1"><a href="working-on-remote-servers.html#cb270-1"></a><span class="ex">bcftools</span>: error while loading shared libraries: libcrypto.so.1.0.0: cannot open shared object file: No such file or directory</span></code></pre></div>
<p>So, often, installing extra programs does not create problems, but it can. If you find yourself battling
errors from conda-installed programs, see if you can correct that by creating a new environment and installing all the programs
you want at the same time, in one fell swoop, using <code>conda create</code>, as in:</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb271-1"><a href="working-on-remote-servers.html#cb271-1"></a><span class="ex">conda</span> create -n binfr -c bioconda bwa samtools bcftools r-base=3.6.1 r-essentials</span></code></pre></div>
</div>
<div id="exporting-environments" class="section level4">
<h4><span class="header-section-number">7.5.2.7</span> Exporting environments</h4>
<p>In our introduction to Miniconda, we mentioned that it is a great boon to
reproducibility. Clearly, your analyses will be more reproducible if it is
easier for others to install software to repeat your analyses. However, Miniconda
takes that one step further, allowing you to generate a list of
the specific versions of
all software and dependencies in a conda environment. This list is a complete
record of your environment, and, supplied to conda, it is a specification of
exactly how to recreate that environment.</p>
<p>The process of creating such a list is called <em>exporting</em> the conda
environment. Here we demonstrate its use by exporting the <code>bioinf</code>
environment from SUMMIT to a simple text file. Then we use that text file
to recreate the environment on my laptop.</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb272-1"><a href="working-on-remote-servers.html#cb272-1"></a><span class="co"># on summit:</span></span>
<span id="cb272-2"><a href="working-on-remote-servers.html#cb272-2"></a><span class="ex">conda</span> activate bioinf          <span class="co"># activate the environment</span></span>
<span id="cb272-3"><a href="working-on-remote-servers.html#cb272-3"></a><span class="ex">conda</span> env export               <span class="co"># export the environment</span></span></code></pre></div>
<p>The last command above just sends the exported environment
to stdout, looking like this:</p>
<pre><code>name: bioinf
channels:
  - bioconda
  - defaults
dependencies:
  - _libgcc_mutex=0.1=main
  - bcftools=1.9=ha228f0b_4
  - bwa=0.7.17=hed695b0_7
  - bzip2=1.0.8=h7b6447c_0
  - ca-certificates=2020.1.1=0
  - curl=7.68.0=hbc83047_0
  - htslib=1.9=ha228f0b_7
  - krb5=1.17.1=h173b8e3_0
  - libcurl=7.68.0=h20c2e04_0
  - libdeflate=1.0=h14c3975_1
  - libedit=3.1.20181209=hc058e9b_0
  - libgcc-ng=9.1.0=hdf63c60_0
  - libssh2=1.8.2=h1ba5d50_0
  - libstdcxx-ng=9.1.0=hdf63c60_0
  - ncurses=6.1=he6710b0_1
  - openssl=1.1.1d=h7b6447c_4
  - perl=5.26.2=h14c3975_0
  - samtools=1.9=h10a08f8_12
  - tk=8.6.8=hbc83047_0
  - xz=5.2.4=h14c3975_4
  - zlib=1.2.11=h7b6447c_3
prefix: /projects/eriq@colostate.edu/miniconda3/envs/bioinf</code></pre>
<p>The format of this information is YAML (Yet Another Markup Language),
(which we saw in the headers of RMarkdown documents, too).</p>
<p>If we stored that output in a file:</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb274-1"><a href="working-on-remote-servers.html#cb274-1"></a><span class="ex">conda</span> env export <span class="op">&gt;</span> bioinf.yml</span></code></pre></div>
<p>And then copied that file to another computer, then we can recreate
the environment on that other computer with:</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb275-1"><a href="working-on-remote-servers.html#cb275-1"></a><span class="ex">conda</span> env create -f bioinf.yml</span></code></pre></div>
<p>That should work fine if the new computer is of the same architecture (i.e., both
are Linux computers, or both are Macs). However, the specific build numbers
referenced in the YAML (i.e. things like the <code>h7b6447c_3</code> part of the program name)
can create problems when installing on other architectures. In that case, we must
export without the build names:</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb276-1"><a href="working-on-remote-servers.html#cb276-1"></a><span class="ex">conda</span> env export --no-builds <span class="op">&gt;</span> bioinf.yml</span></code></pre></div>
<p>Even that might fail if the dependencies differ on different architectures,
in which case you can export just the list of the actual programs that
you reqested be installed, by using the <code>--from-history</code> option. For example:</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb277-1"><a href="working-on-remote-servers.html#cb277-1"></a><span class="ex">%</span> conda env export --from-history</span>
<span id="cb277-2"><a href="working-on-remote-servers.html#cb277-2"></a><span class="ex">name</span>: bioinf</span>
<span id="cb277-3"><a href="working-on-remote-servers.html#cb277-3"></a><span class="ex">channels</span>:</span>
<span id="cb277-4"><a href="working-on-remote-servers.html#cb277-4"></a>  <span class="ex">-</span> defaults</span>
<span id="cb277-5"><a href="working-on-remote-servers.html#cb277-5"></a><span class="ex">dependencies</span>:</span>
<span id="cb277-6"><a href="working-on-remote-servers.html#cb277-6"></a>  <span class="ex">-</span> bwa</span>
<span id="cb277-7"><a href="working-on-remote-servers.html#cb277-7"></a>  <span class="ex">-</span> bcftools</span>
<span id="cb277-8"><a href="working-on-remote-servers.html#cb277-8"></a>  <span class="ex">-</span> samtools</span>
<span id="cb277-9"><a href="working-on-remote-servers.html#cb277-9"></a><span class="ex">prefix</span>: /projects/eriq@colostate.edu/miniconda3/envs/bioinf</span></code></pre></div>
<p>Though, even that fails, cuz it doesn’t list bioconda in there.</p>
</div>
</div>
<div id="installing-java-programs" class="section level3">
<h3><span class="header-section-number">7.5.3</span> Installing Java Programs</h3>
<p>Java programs run without compilation on many different computer architectures, so long
as the computer has a Java Runtime Environment, or JRE. Thus, the steps to running a Java
program are usually simply:</p>
<ol style="list-style-type: decimal">
<li>Download the Java program, which is usually stored in what is called a Jar file, having a
<code>.jar</code> extension.</li>
<li>Ensure that a JRE is available (either loading a JRE or JDK modulefile, or, if that is not
available, creating a <code>conda</code> environment that includes the JRE.)</li>
<li>Launch the Java program with <code>java -jar progpath.jar</code> where <code>progpath.jar</code> is the path to the
Jar file that you have downloaded and wish to run.</li>
</ol>
<div id="install-gatk" class="section level4">
<h4><span class="header-section-number">7.5.3.1</span> Installing GATK</h4>
<p>The most important Java based program for bioinformatics is GATK (and its companion
program, which is now a part of GATK, called PicardTools). This program,
since version 4,
comes with a python “wrapper” script that takes care of launching the GATK program
without using the <code>java -jar</code> syntax, and it also gives it a much more conventional
Unix command-line program “feel” than it had before, making it somewhat easier
to use if you are familiar with working on the shell.</p>
<p>Here, we describe how to download and install GATK for fairly typical or standard use
cases. There are further dependencies for some GATK analyses that can be installed
using Miniconda, but we won’t cover that here, as we don’t need those dependencies
for what we will be doing. (However, if you have digested the previous sections on Miniconda
you should have no problem installing the other dependencies with <code>conda</code>).</p>
<ol style="list-style-type: decimal">
<li>Download the GATK package. GATK, since version 4, is available online
at GitHub using links found at <a href="https://github.com/broadinstitute/gatk/releases/tag/4.1.6.0">https://github.com/broadinstitute/gatk/releases/tag/4.1.6.0</a>. We use <code>wget</code> on the cluster to download this. I recommend creating a directory called <code>java-programs</code> for
storing your Java programs. If you are working on SUMMIT, this should go in your <code>projects</code> directory, to avoid
filling up your tiny home directory. At the time of writing, the latest GATK release was version 4.1.6.0.
A later version may now be available, and the links below should be modified to get that later
version if desired.</li>
</ol>
<div class="sourceCode" id="cb278"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb278-1"><a href="working-on-remote-servers.html#cb278-1"></a><span class="co"># replace user with your username</span></span>
<span id="cb278-2"><a href="working-on-remote-servers.html#cb278-2"></a><span class="bu">cd</span> /projects/user\@colostate.edu/</span>
<span id="cb278-3"><a href="working-on-remote-servers.html#cb278-3"></a><span class="fu">mkdir</span> java-programs  <span class="co"># if you don&#39;t already have such a directory</span></span>
<span id="cb278-4"><a href="working-on-remote-servers.html#cb278-4"></a><span class="bu">cd</span> java-programs <span class="co"># enter that directory</span></span>
<span id="cb278-5"><a href="working-on-remote-servers.html#cb278-5"></a><span class="fu">wget</span> https://github.com/broadinstitute/gatk/releases/download/4.1.6.0/gatk-4.1.6.0.zip</span>
<span id="cb278-6"><a href="working-on-remote-servers.html#cb278-6"></a><span class="co"># unzip that compressed file into a directory</span></span>
<span id="cb278-7"><a href="working-on-remote-servers.html#cb278-7"></a><span class="fu">unzip</span> gatk-4.1.6.0.zip</span>
<span id="cb278-8"><a href="working-on-remote-servers.html#cb278-8"></a><span class="co"># if that step was successful, remove the zip file</span></span>
<span id="cb278-9"><a href="working-on-remote-servers.html#cb278-9"></a><span class="fu">rm</span> gatk-4.1.6.0.zip</span>
<span id="cb278-10"><a href="working-on-remote-servers.html#cb278-10"></a><span class="co"># cd into the gatk directory</span></span>
<span id="cb278-11"><a href="working-on-remote-servers.html#cb278-11"></a><span class="bu">cd</span> gatk-4.1.6.0</span>
<span id="cb278-12"><a href="working-on-remote-servers.html#cb278-12"></a><span class="co"># finally, print the working directory to get the path</span></span>
<span id="cb278-13"><a href="working-on-remote-servers.html#cb278-13"></a><span class="bu">pwd</span></span></code></pre></div>
<p>When I do the last command, I get: <code>/projects/eriq@colostate.edu/java-programs/gatk-4.1.6.0</code> You will
want to copy the path on your system so that you can include it in your <code>~/.bashrc</code> file. In the following
I refer to the path to the GATK directory on your system as <code>&lt;PATH_TO&gt;</code>. You should replace <code>&lt;PATH_TO&gt;</code>
in the following with the paht to the GATK directory on your system. Edit your <code>~/.bashrc</code> file,
adding the following lines <em>above</em> the <code>&gt;&gt;&gt; conda initialize &gt;&gt;&gt;</code> block:</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb279-1"><a href="working-on-remote-servers.html#cb279-1"></a><span class="bu">export</span> <span class="va">PATH=$PATH</span>:<span class="op">&lt;</span><span class="ex">PATH_TO</span><span class="op">&gt;</span></span>
<span id="cb279-2"><a href="working-on-remote-servers.html#cb279-2"></a><span class="bu">source</span> <span class="op">&lt;</span>PATH_TO<span class="op">&gt;</span>/gatk-completion.sh</span></code></pre></div>
<p>On my system, it looks like the following when I have replaced <PATH_TO>
with the appropriate path:</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb280-1"><a href="working-on-remote-servers.html#cb280-1"></a><span class="bu">export</span> <span class="va">PATH=$PATH</span>:/projects/eriq@colostate.edu/java-programs/gatk-4.1.6.0</span>
<span id="cb280-2"><a href="working-on-remote-servers.html#cb280-2"></a><span class="bu">source</span> /projects/eriq@colostate.edu/java-programs/gatk-4.1.6.0/gatk-completion.sh</span></code></pre></div>
<p>Once that is done, save and close <code>~/.bashrc</code> and then source it for the changes to take
effect. (You don’t typically need to source it if you login to a new shell, but here,
since you are not opening a new shell, you need to source it.)</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb281-1"><a href="working-on-remote-servers.html#cb281-1"></a><span class="bu">source</span> ~/.bashrc</span></code></pre></div>
<p>Now, you should be able to give the command</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb282-1"><a href="working-on-remote-servers.html#cb282-1"></a><span class="bu">cd</span> <span class="co"># return to home directory</span></span>
<span id="cb282-2"><a href="working-on-remote-servers.html#cb282-2"></a><span class="ex">gatk</span></span></code></pre></div>
<p>and you will get back a message about the syntax for using <code>gatk</code>. If not,
then something has gone wrong.</p>
<p>If <code>gatk</code> above worked as expected (gave you a help message), you are ready
to run a very quick experiment to test if we are all set
for calling variants (SNPs and indels) from the .bam files that were
created in the <code>chr-32-bioinformatics</code> homework. Be <em>certain</em> that you
are on a compute node before doing this. (Check it with <code>hostname</code>).</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb283-1"><a href="working-on-remote-servers.html#cb283-1"></a><span class="co"># cd to your homework folder. On my system, that is:</span></span>
<span id="cb283-2"><a href="working-on-remote-servers.html#cb283-2"></a><span class="bu">cd</span> scratch/COURSE_STUFF/chr-32-bioinformatics-eriqande/</span>
<span id="cb283-3"><a href="working-on-remote-servers.html#cb283-3"></a><span class="co"># make a file that holds the paths to all the duplicate-marked</span></span>
<span id="cb283-4"><a href="working-on-remote-servers.html#cb283-4"></a><span class="co"># bam files you created during the homework:</span></span>
<span id="cb283-5"><a href="working-on-remote-servers.html#cb283-5"></a><span class="fu">ls</span> -l mkdup/*_mkdup.bam <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $NF}&#39;</span> <span class="op">&gt;</span> bamfiles.list</span>
<span id="cb283-6"><a href="working-on-remote-servers.html#cb283-6"></a><span class="co"># make sure bamfiles.list has the relative paths to a number</span></span>
<span id="cb283-7"><a href="working-on-remote-servers.html#cb283-7"></a><span class="co"># of different bamfiles in it:</span></span>
<span id="cb283-8"><a href="working-on-remote-servers.html#cb283-8"></a><span class="fu">cat</span> bamfiles.list</span>
<span id="cb283-9"><a href="working-on-remote-servers.html#cb283-9"></a><span class="co"># make a directory to put the output into</span></span>
<span id="cb283-10"><a href="working-on-remote-servers.html#cb283-10"></a><span class="fu">mkdir</span> vcf</span>
<span id="cb283-11"><a href="working-on-remote-servers.html#cb283-11"></a><span class="co"># make sure the JRE is loaded (on SUMMIT)</span></span>
<span id="cb283-12"><a href="working-on-remote-servers.html#cb283-12"></a><span class="ex">module</span> load jdk</span>
<span id="cb283-13"><a href="working-on-remote-servers.html#cb283-13"></a></span>
<span id="cb283-14"><a href="working-on-remote-servers.html#cb283-14"></a><span class="co"># GATK needs two different indexes of the genome.  Unfortunately</span></span>
<span id="cb283-15"><a href="working-on-remote-servers.html#cb283-15"></a><span class="co"># the version we have is not compressed with bgzip, so</span></span>
<span id="cb283-16"><a href="working-on-remote-servers.html#cb283-16"></a><span class="co"># we will have to make an uncompressed version of it and</span></span>
<span id="cb283-17"><a href="working-on-remote-servers.html#cb283-17"></a><span class="co"># then index it. GATK expects the index (or, as they call it, </span></span>
<span id="cb283-18"><a href="working-on-remote-servers.html#cb283-18"></a><span class="co"># the &quot;dictionary&quot; to be named a certain way...)</span></span>
<span id="cb283-19"><a href="working-on-remote-servers.html#cb283-19"></a><span class="fu">gunzip</span> -c genome/GCA_002872995.1_Otsh_v1.0_genomic.fna.gz <span class="op">&gt;</span> genome/GCA_002872995.1_Otsh_v1.0_genomic.fna</span>
<span id="cb283-20"><a href="working-on-remote-servers.html#cb283-20"></a><span class="ex">conda</span> activate bioinf</span>
<span id="cb283-21"><a href="working-on-remote-servers.html#cb283-21"></a><span class="ex">samtools</span> faidx genome/GCA_002872995.1_Otsh_v1.0_genomic.fna</span>
<span id="cb283-22"><a href="working-on-remote-servers.html#cb283-22"></a><span class="ex">gatk</span> CreateSequenceDictionary -R genome/GCA_002872995.1_Otsh_v1.0_genomic.fna \</span>
<span id="cb283-23"><a href="working-on-remote-servers.html#cb283-23"></a>     -O genome/GCA_002872995.1_Otsh_v1.0_genomic.dict</span>
<span id="cb283-24"><a href="working-on-remote-servers.html#cb283-24"></a></span>
<span id="cb283-25"><a href="working-on-remote-servers.html#cb283-25"></a><span class="co"># then we will launch GATK to do variant calling and create a VCF file</span></span>
<span id="cb283-26"><a href="working-on-remote-servers.html#cb283-26"></a><span class="co"># from the BAMs in bamfiles.list in a 5 Kb region (we expect about</span></span>
<span id="cb283-27"><a href="working-on-remote-servers.html#cb283-27"></a><span class="co"># 50 variants in such a small part of the genome) on Chromosome 32</span></span>
<span id="cb283-28"><a href="working-on-remote-servers.html#cb283-28"></a><span class="co"># which is named CM009233.1</span></span>
<span id="cb283-29"><a href="working-on-remote-servers.html#cb283-29"></a><span class="ex">gatk</span> --java-options <span class="st">&quot;-Xmx4g&quot;</span> HaplotypeCaller  \</span>
<span id="cb283-30"><a href="working-on-remote-servers.html#cb283-30"></a>   -R genome/GCA_002872995.1_Otsh_v1.0_genomic.fna \</span>
<span id="cb283-31"><a href="working-on-remote-servers.html#cb283-31"></a>   -I bamfiles.list \</span>
<span id="cb283-32"><a href="working-on-remote-servers.html#cb283-32"></a>   -O vcf/tiny-test.vcf \</span>
<span id="cb283-33"><a href="working-on-remote-servers.html#cb283-33"></a>   -L CM009233.1:2000000-2005000</span></code></pre></div>
<p>Once that finishes, look at the resulting VCF file:</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb284-1"><a href="working-on-remote-servers.html#cb284-1"></a><span class="fu">more</span> vcf/tiny-test.vcf</span>
<span id="cb284-2"><a href="working-on-remote-servers.html#cb284-2"></a></span>
<span id="cb284-3"><a href="working-on-remote-servers.html#cb284-3"></a><span class="co"># if you get tired of scrolling through the header lines (with</span></span>
<span id="cb284-4"><a href="working-on-remote-servers.html#cb284-4"></a><span class="co"># endless small genome fragment names). Then quit that (hit q)</span></span>
<span id="cb284-5"><a href="working-on-remote-servers.html#cb284-5"></a><span class="co"># and view it without the header:</span></span>
<span id="cb284-6"><a href="working-on-remote-servers.html#cb284-6"></a><span class="ex">bcftools</span> view -H vcf/tiny-test.vcf</span></code></pre></div>
<p>If that looks like a bunch of gibberish, rejoice! We will learn about the VCF file
format soon!</p>
</div>
</div>
</div>
<div id="vim-its-time-to-get-serious-with-text-editing" class="section level2">
<h2><span class="header-section-number">7.6</span> <code>vim</code>: it’s time to get serious with text editing</h2>
<p>Introduce newbs to the <code>vimtutor</code>.</p>
<p>Note, on a Mac, add these lines to your <code>~/.vimrc</code> file:</p>
<pre><code>filetype plugin indent on
syntax on</code></pre>
<p>That will provide syntax highlighting.</p>
<div id="using-neovim-and-nvim-r-and-tmux-to-use-r-well-on-the-cluster" class="section level3">
<h3><span class="header-section-number">7.6.1</span> Using neovim and Nvim-R and tmux to use R well on the cluster</h3>
<p>These are currently just notes to myself. And I won’t end up doing this anyway..
I should probably replace with with my own rView package…</p>
<p>On Summit you can follow the directions install Neovim and Nvim-R etc, found
at section 2 of <a href="https://gist.github.com/tgirke/7a7c197b443243937f68c422e5471899#ucrhpcc">https://gist.github.com/tgirke/7a7c197b443243937f68c422e5471899#ucrhpcc</a>.
You can just do 2.1 to 2.6. 2.7 is the routine for user accounts. You don’t need to install Tmux.</p>
<p>You need to get an interactive session on a compute node and then</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb286-1"><a href="working-on-remote-servers.html#cb286-1"></a><span class="ex">module</span> load R/3.5.0</span>
<span id="cb286-2"><a href="working-on-remote-servers.html#cb286-2"></a><span class="ex">module</span> load intel</span>
<span id="cb286-3"><a href="working-on-remote-servers.html#cb286-3"></a><span class="ex">module</span> load mkl  </span></code></pre></div>
<p>The last two are needed to get a random number to start up client through R.
It is amazing to me that they call a specific Intel library to do that, and apparently
loading the R module alone doesn’t get you that.</p>
<p>Uncomment the lines:</p>
<pre><code>let R_in_buffer = 0                                                       
let R_tmux_split = 1 </code></pre>
<p>in your <code>~/.config/nvim/init.vim</code>. Wait! You don’t want to do that, necessarily, because tmux with NVim-R
is no longer supported (Neovim now has native terminal splitting support.)</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sed-awk-and-regular-expressions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="high-performance-computing-clusters-hpccs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/eriqande/eca-bioinf-handbook/edit/master/1.030-working-on-remote-servers.Rmd",
"text": "Edit"
},
"history": {
"link": "https://github.com/eriqande/eca-bioinf-handbook/commits/master/1.030-working-on-remote-servers.Rmd",
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["eca-bioinf-handbook.pdf", "eca-bioinf-handbook.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
