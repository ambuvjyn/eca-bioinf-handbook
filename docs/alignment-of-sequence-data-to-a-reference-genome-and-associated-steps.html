<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 19 Alignment of sequence data to a reference genome (and associated steps) | Practical Computing and Bioinformatics for Conservation and Evolutionary Genomics</title>
  <meta name="description" content="A book example for a Chapman &amp; Hall book." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 19 Alignment of sequence data to a reference genome (and associated steps) | Practical Computing and Bioinformatics for Conservation and Evolutionary Genomics" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A book example for a Chapman &amp; Hall book." />
  <meta name="github-repo" content="yihui/bookdown-crc" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 19 Alignment of sequence data to a reference genome (and associated steps) | Practical Computing and Bioinformatics for Conservation and Evolutionary Genomics" />
  
  <meta name="twitter:description" content="A book example for a Chapman &amp; Hall book." />
  

<meta name="author" content="Eric C. Anderson" />


<meta name="date" content="2021-04-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="genome-assembly.html"/>
<link rel="next" href="variant-calling.html"/>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">ECA's Bioinformatics Handbook</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="erics-notes-of-what-he-might-do.html"><a href="erics-notes-of-what-he-might-do.html"><i class="fa fa-check"></i><b>2</b> Eric’s Notes of what he might do</a><ul>
<li class="chapter" data-level="2.1" data-path="erics-notes-of-what-he-might-do.html"><a href="erics-notes-of-what-he-might-do.html#table-of-topics"><i class="fa fa-check"></i><b>2.1</b> Table of topics</a></li>
</ul></li>
<li class="part"><span><b>I Part I: Essential Computing Skills</b></span></li>
<li class="chapter" data-level="3" data-path="overview-of-essential-computing-skills.html"><a href="overview-of-essential-computing-skills.html"><i class="fa fa-check"></i><b>3</b> Overview of Essential Computing Skills</a></li>
<li class="chapter" data-level="4" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html"><i class="fa fa-check"></i><b>4</b> Essential Unix/Linux Terminal Knowledge</a><ul>
<li class="chapter" data-level="4.1" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#getting-a-bash-shell-on-your-system"><i class="fa fa-check"></i><b>4.1</b> Getting a bash shell on your system</a></li>
<li class="chapter" data-level="4.2" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#navigating-the-unix-filesystem"><i class="fa fa-check"></i><b>4.2</b> Navigating the Unix filesystem</a><ul>
<li class="chapter" data-level="4.2.1" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#changing-the-working-directory-with-cd"><i class="fa fa-check"></i><b>4.2.1</b> Changing the working directory with <code>cd</code></a></li>
<li class="chapter" data-level="4.2.2" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#comm-prompt"><i class="fa fa-check"></i><b>4.2.2</b> Updating your command prompt</a></li>
<li class="chapter" data-level="4.2.3" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#tab-completion-for-paths"><i class="fa fa-check"></i><b>4.2.3</b> TAB-completion for paths</a></li>
<li class="chapter" data-level="4.2.4" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#listing-the-contents-of-a-directory-with-ls"><i class="fa fa-check"></i><b>4.2.4</b> Listing the contents of a directory with <code>ls</code></a></li>
<li class="chapter" data-level="4.2.5" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#globbing"><i class="fa fa-check"></i><b>4.2.5</b> Globbing</a></li>
<li class="chapter" data-level="4.2.6" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#what-makes-a-good-file-name"><i class="fa fa-check"></i><b>4.2.6</b> What makes a good file-name?</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#the-anatomy-of-a-unix-command"><i class="fa fa-check"></i><b>4.3</b> The anatomy of a Unix command</a><ul>
<li class="chapter" data-level="4.3.1" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#anatomy-command"><i class="fa fa-check"></i><b>4.3.1</b> The <code>command</code></a></li>
<li class="chapter" data-level="4.3.2" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#the-options"><i class="fa fa-check"></i><b>4.3.2</b> The <em>options</em></a></li>
<li class="chapter" data-level="4.3.3" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#arguments"><i class="fa fa-check"></i><b>4.3.3</b> Arguments</a></li>
<li class="chapter" data-level="4.3.4" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#getting-information-about-unix-commands"><i class="fa fa-check"></i><b>4.3.4</b> Getting information about Unix commands</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#handling-manipulating-and-viewing-files-and-streams"><i class="fa fa-check"></i><b>4.4</b> Handling, Manipulating, and Viewing files and streams</a><ul>
<li class="chapter" data-level="4.4.1" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#creating-new-directories"><i class="fa fa-check"></i><b>4.4.1</b> Creating new directories</a></li>
<li class="chapter" data-level="4.4.2" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#fundamental-file-handling-commands"><i class="fa fa-check"></i><b>4.4.2</b> Fundamental file-handling commands</a></li>
<li class="chapter" data-level="4.4.3" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#viewing-files"><i class="fa fa-check"></i><b>4.4.3</b> “Viewing” Files</a></li>
<li class="chapter" data-level="4.4.4" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#redirecting-standard-output-and"><i class="fa fa-check"></i><b>4.4.4</b> Redirecting standard output: <code>&gt;</code> and <code>&gt;&gt;</code></a></li>
<li class="chapter" data-level="4.4.5" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#stdin-and"><i class="fa fa-check"></i><b>4.4.5</b> stdin, <code>&lt;</code> and <code>|</code></a></li>
<li class="chapter" data-level="4.4.6" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#stderr"><i class="fa fa-check"></i><b>4.4.6</b> stderr</a></li>
<li class="chapter" data-level="4.4.7" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#symbolic-links"><i class="fa fa-check"></i><b>4.4.7</b> Symbolic links</a></li>
<li class="chapter" data-level="4.4.8" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#file-permissions"><i class="fa fa-check"></i><b>4.4.8</b> File Permissions</a></li>
<li class="chapter" data-level="4.4.9" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#editing-text-files-at-the-terminal"><i class="fa fa-check"></i><b>4.4.9</b> Editing text files at the terminal</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#unix-env"><i class="fa fa-check"></i><b>4.5</b> Customizing your Environment</a><ul>
<li class="chapter" data-level="4.5.1" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#appearances-matter"><i class="fa fa-check"></i><b>4.5.1</b> Appearances matter</a></li>
<li class="chapter" data-level="4.5.2" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#where-are-my-programscommands-at"><i class="fa fa-check"></i><b>4.5.2</b> Where are my programs/commands at?!</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#a-few-more-important-keystrokes"><i class="fa fa-check"></i><b>4.6</b> A Few More Important Keystrokes</a></li>
<li class="chapter" data-level="4.7" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#a-short-list-of-additional-useful-commands."><i class="fa fa-check"></i><b>4.7</b> A short list of additional useful commands.</a></li>
<li class="chapter" data-level="4.8" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#two-important-computing-concepts"><i class="fa fa-check"></i><b>4.8</b> Two important computing concepts</a><ul>
<li class="chapter" data-level="4.8.1" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#compression"><i class="fa fa-check"></i><b>4.8.1</b> Compression</a></li>
<li class="chapter" data-level="4.8.2" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#hashing"><i class="fa fa-check"></i><b>4.8.2</b> Hashing</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="essential-unixlinux-terminal-knowledge.html"><a href="essential-unixlinux-terminal-knowledge.html#unix-quick-study-guide"><i class="fa fa-check"></i><b>4.9</b> Unix: Quick Study Guide</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="shell-programming.html"><a href="shell-programming.html"><i class="fa fa-check"></i><b>5</b> Shell programming</a><ul>
<li class="chapter" data-level="5.1" data-path="shell-programming.html"><a href="shell-programming.html#an-example-script"><i class="fa fa-check"></i><b>5.1</b> An example script</a></li>
<li class="chapter" data-level="5.2" data-path="shell-programming.html"><a href="shell-programming.html#the-structure-of-a-bash-script"><i class="fa fa-check"></i><b>5.2</b> The Structure of a Bash Script</a><ul>
<li class="chapter" data-level="5.2.1" data-path="shell-programming.html"><a href="shell-programming.html#paragraph-before-shebang"><i class="fa fa-check"></i><b>5.2.1</b> A bit more on <code>;</code> and <code>&amp;</code></a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="shell-programming.html"><a href="shell-programming.html#variables"><i class="fa fa-check"></i><b>5.3</b> Variables</a><ul>
<li class="chapter" data-level="5.3.1" data-path="shell-programming.html"><a href="shell-programming.html#assigning-values-to-variables"><i class="fa fa-check"></i><b>5.3.1</b> Assigning values to variables</a></li>
<li class="chapter" data-level="5.3.2" data-path="shell-programming.html"><a href="shell-programming.html#accessing-values-from-variables"><i class="fa fa-check"></i><b>5.3.2</b> Accessing values from variables</a></li>
<li class="chapter" data-level="5.3.3" data-path="shell-programming.html"><a href="shell-programming.html#what-does-the-shell-do-with-the-value-substituted-for-a-variable"><i class="fa fa-check"></i><b>5.3.3</b> What does the shell do with the value substituted for a variable?</a></li>
<li class="chapter" data-level="5.3.4" data-path="shell-programming.html"><a href="shell-programming.html#quotes-and-var-subs"><i class="fa fa-check"></i><b>5.3.4</b> Double and Single Quotation Marks and Variable Substitution</a></li>
<li class="chapter" data-level="5.3.5" data-path="shell-programming.html"><a href="shell-programming.html#one-useful-fancy-variable-substitution-method"><i class="fa fa-check"></i><b>5.3.5</b> One useful, fancy, variable-substitution method</a></li>
<li class="chapter" data-level="5.3.6" data-path="shell-programming.html"><a href="shell-programming.html#bash-arithmetic"><i class="fa fa-check"></i><b>5.3.6</b> Integer Arithmetic with Shell Variables</a></li>
<li class="chapter" data-level="5.3.7" data-path="shell-programming.html"><a href="shell-programming.html#variable-arrays"><i class="fa fa-check"></i><b>5.3.7</b> Variable arrays</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="shell-programming.html"><a href="shell-programming.html#evaluate-a-command-and-substitute-the-result-on-the-command-line"><i class="fa fa-check"></i><b>5.4</b> Evaluate a command and substitute the result on the command line</a></li>
<li class="chapter" data-level="5.5" data-path="shell-programming.html"><a href="shell-programming.html#groupingcollecting-output-from-multiple-commands-commands-and-commands"><i class="fa fa-check"></i><b>5.5</b> Grouping/Collecting output from multiple commands: <code>(commands)</code> and <code>{ commands; }</code></a></li>
<li class="chapter" data-level="5.6" data-path="shell-programming.html"><a href="shell-programming.html#exit-status"><i class="fa fa-check"></i><b>5.6</b> Exit Status</a><ul>
<li class="chapter" data-level="5.6.1" data-path="shell-programming.html"><a href="shell-programming.html#combinations-of-exit-statuses"><i class="fa fa-check"></i><b>5.6.1</b> Combinations of exit statuses</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="shell-programming.html"><a href="shell-programming.html#unix-for-loops"><i class="fa fa-check"></i><b>5.7</b> Loops and repetition</a></li>
<li class="chapter" data-level="5.8" data-path="shell-programming.html"><a href="shell-programming.html#more-conditional-evaluation-if-then-else-and-friends"><i class="fa fa-check"></i><b>5.8</b> More Conditional Evaluation: <code>if</code>, <code>then</code>, <code>else</code>, and friends</a></li>
<li class="chapter" data-level="5.9" data-path="shell-programming.html"><a href="shell-programming.html#finallypositional-parameters"><i class="fa fa-check"></i><b>5.9</b> Finally…positional parameters</a></li>
<li class="chapter" data-level="5.10" data-path="shell-programming.html"><a href="shell-programming.html#basename-and-dirname-two-useful-little-utilities"><i class="fa fa-check"></i><b>5.10</b> <code>basename</code> and <code>dirname</code> two useful little utilities</a></li>
<li class="chapter" data-level="5.11" data-path="shell-programming.html"><a href="shell-programming.html#bash-functions"><i class="fa fa-check"></i><b>5.11</b> <code>bash</code> functions</a></li>
<li class="chapter" data-level="5.12" data-path="shell-programming.html"><a href="shell-programming.html#reading-files-line-by-line"><i class="fa fa-check"></i><b>5.12</b> reading files line by line</a></li>
<li class="chapter" data-level="5.13" data-path="shell-programming.html"><a href="shell-programming.html#further-reading"><i class="fa fa-check"></i><b>5.13</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="sed-awk-and-regular-expressions.html"><a href="sed-awk-and-regular-expressions.html"><i class="fa fa-check"></i><b>6</b> Sed, awk, and regular expressions</a><ul>
<li class="chapter" data-level="6.1" data-path="sed-awk-and-regular-expressions.html"><a href="sed-awk-and-regular-expressions.html#awk"><i class="fa fa-check"></i><b>6.1</b> awk</a><ul>
<li class="chapter" data-level="6.1.1" data-path="sed-awk-and-regular-expressions.html"><a href="sed-awk-and-regular-expressions.html#line-cycling-tests-and-actions"><i class="fa fa-check"></i><b>6.1.1</b> Line-cycling, tests and actions</a></li>
<li class="chapter" data-level="6.1.2" data-path="sed-awk-and-regular-expressions.html"><a href="sed-awk-and-regular-expressions.html#column-splitting-fields--f-nf-print-ofs-and-begin"><i class="fa fa-check"></i><b>6.1.2</b> Column splitting, fields, <code>-F</code>, <code>$</code>, <code>NF</code>, <code>print</code>, <code>OFS</code> and <code>BEGIN</code></a></li>
<li class="chapter" data-level="6.1.3" data-path="sed-awk-and-regular-expressions.html"><a href="sed-awk-and-regular-expressions.html#a-brief-introduction-to-regular-expressions"><i class="fa fa-check"></i><b>6.1.3</b> A brief introduction to regular expressions</a></li>
<li class="chapter" data-level="6.1.4" data-path="sed-awk-and-regular-expressions.html"><a href="sed-awk-and-regular-expressions.html#a-variety-of-tests"><i class="fa fa-check"></i><b>6.1.4</b> A variety of tests</a></li>
<li class="chapter" data-level="6.1.5" data-path="sed-awk-and-regular-expressions.html"><a href="sed-awk-and-regular-expressions.html#code-in-the-action-blocks"><i class="fa fa-check"></i><b>6.1.5</b> Code in the action blocks</a></li>
<li class="chapter" data-level="6.1.6" data-path="sed-awk-and-regular-expressions.html"><a href="sed-awk-and-regular-expressions.html#using-awk-to-assign-to-shell-variables"><i class="fa fa-check"></i><b>6.1.6</b> Using <code>awk</code> to assign to shell variables</a></li>
<li class="chapter" data-level="6.1.7" data-path="sed-awk-and-regular-expressions.html"><a href="sed-awk-and-regular-expressions.html#passing-variables-into-awk-with--v"><i class="fa fa-check"></i><b>6.1.7</b> Passing Variables into <code>awk</code> with <code>-v</code></a></li>
<li class="chapter" data-level="6.1.8" data-path="sed-awk-and-regular-expressions.html"><a href="sed-awk-and-regular-expressions.html#writing-awk-scripts-in-files"><i class="fa fa-check"></i><b>6.1.8</b> Writing awk scripts in files</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="sed-awk-and-regular-expressions.html"><a href="sed-awk-and-regular-expressions.html#sed"><i class="fa fa-check"></i><b>6.2</b> sed</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html"><i class="fa fa-check"></i><b>7</b> Working on remote servers</a><ul>
<li class="chapter" data-level="7.1" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#accessing-remote-computers"><i class="fa fa-check"></i><b>7.1</b> Accessing remote computers</a><ul>
<li class="chapter" data-level="7.1.1" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#windows"><i class="fa fa-check"></i><b>7.1.1</b> Windows</a></li>
<li class="chapter" data-level="7.1.2" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#hummingbird"><i class="fa fa-check"></i><b>7.1.2</b> Hummingbird</a></li>
<li class="chapter" data-level="7.1.3" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#summit"><i class="fa fa-check"></i><b>7.1.3</b> Summit</a></li>
<li class="chapter" data-level="7.1.4" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#sedna"><i class="fa fa-check"></i><b>7.1.4</b> Sedna</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#transferring-files-to-remote-computers"><i class="fa fa-check"></i><b>7.2</b> Transferring files to remote computers</a><ul>
<li class="chapter" data-level="7.2.1" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#sftp-via-lftp"><i class="fa fa-check"></i><b>7.2.1</b> <code>sftp</code> (via <code>lftp</code>)</a></li>
<li class="chapter" data-level="7.2.2" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#git"><i class="fa fa-check"></i><b>7.2.2</b> git</a></li>
<li class="chapter" data-level="7.2.3" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#globus"><i class="fa fa-check"></i><b>7.2.3</b> Globus</a></li>
<li class="chapter" data-level="7.2.4" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#interfacing-with-the-cloud"><i class="fa fa-check"></i><b>7.2.4</b> Interfacing with “The Cloud”</a></li>
<li class="chapter" data-level="7.2.5" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#get-seqs"><i class="fa fa-check"></i><b>7.2.5</b> Getting files from a sequencing center</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#tmux"><i class="fa fa-check"></i><b>7.3</b> <code>tmux</code>: the terminal multiplexer</a><ul>
<li class="chapter" data-level="7.3.1" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#an-analogy-for-how-tmux-works"><i class="fa fa-check"></i><b>7.3.1</b> An analogy for how <code>tmux</code> works</a></li>
<li class="chapter" data-level="7.3.2" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#first-steps-with-tmux"><i class="fa fa-check"></i><b>7.3.2</b> First steps with <code>tmux</code></a></li>
<li class="chapter" data-level="7.3.3" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#further-steps-with-tmux"><i class="fa fa-check"></i><b>7.3.3</b> Further steps with <code>tmux</code></a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#tmux-for-mac-users"><i class="fa fa-check"></i><b>7.4</b> <code>tmux</code> for Mac users</a></li>
<li class="chapter" data-level="7.5" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#installing-software-on-an-hpcc"><i class="fa fa-check"></i><b>7.5</b> Installing Software on an HPCC</a><ul>
<li class="chapter" data-level="7.5.1" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#modules"><i class="fa fa-check"></i><b>7.5.1</b> Modules</a></li>
<li class="chapter" data-level="7.5.2" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#miniconda"><i class="fa fa-check"></i><b>7.5.2</b> Miniconda</a></li>
<li class="chapter" data-level="7.5.3" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#installing-java-programs"><i class="fa fa-check"></i><b>7.5.3</b> Installing Java Programs</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#vim-its-time-to-get-serious-with-text-editing"><i class="fa fa-check"></i><b>7.6</b> <code>vim</code>: it’s time to get serious with text editing</a><ul>
<li class="chapter" data-level="7.6.1" data-path="working-on-remote-servers.html"><a href="working-on-remote-servers.html#using-neovim-and-nvim-r-and-tmux-to-use-r-well-on-the-cluster"><i class="fa fa-check"></i><b>7.6.1</b> Using neovim and Nvim-R and tmux to use R well on the cluster</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="chap-HPCC.html"><a href="chap-HPCC.html"><i class="fa fa-check"></i><b>8</b> High Performance Computing Clusters (HPCC’s)</a><ul>
<li class="chapter" data-level="8.1" data-path="chap-HPCC.html"><a href="chap-HPCC.html#an-oversimplified-but-useful-view-of-a-computing-cluster"><i class="fa fa-check"></i><b>8.1</b> An oversimplified, but useful, view of a computing cluster</a></li>
<li class="chapter" data-level="8.2" data-path="chap-HPCC.html"><a href="chap-HPCC.html#cluster-computing-and-the-job-scheduler"><i class="fa fa-check"></i><b>8.2</b> Cluster computing and the job scheduler</a></li>
<li class="chapter" data-level="8.3" data-path="chap-HPCC.html"><a href="chap-HPCC.html#slurm-info"><i class="fa fa-check"></i><b>8.3</b> Learning about the resources on your HPCC</a></li>
<li class="chapter" data-level="8.4" data-path="chap-HPCC.html"><a href="chap-HPCC.html#getting-compute-resources-allocated-to-your-jobs-on-an-hpcc"><i class="fa fa-check"></i><b>8.4</b> Getting compute resources allocated to your jobs on an HPCC</a><ul>
<li class="chapter" data-level="8.4.1" data-path="chap-HPCC.html"><a href="chap-HPCC.html#interactive-sessions"><i class="fa fa-check"></i><b>8.4.1</b> Interactive sessions</a></li>
<li class="chapter" data-level="8.4.2" data-path="chap-HPCC.html"><a href="chap-HPCC.html#slurm-batch"><i class="fa fa-check"></i><b>8.4.2</b> Batch jobs</a></li>
<li class="chapter" data-level="8.4.3" data-path="chap-HPCC.html"><a href="chap-HPCC.html#slurm-job-arrays"><i class="fa fa-check"></i><b>8.4.3</b> SLURM Job Arrays</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="chap-HPCC.html"><a href="chap-HPCC.html#prepation-interlude-an-in-class-exercise-to-make-sure-everything-is-configured-correctly"><i class="fa fa-check"></i><b>8.5</b> PREPATION INTERLUDE: An in-class exercise to make sure everything is configured correctly</a></li>
<li class="chapter" data-level="8.6" data-path="chap-HPCC.html"><a href="chap-HPCC.html#more-boneyard"><i class="fa fa-check"></i><b>8.6</b> More Boneyard…</a></li>
<li class="chapter" data-level="8.7" data-path="chap-HPCC.html"><a href="chap-HPCC.html#the-queue-slurmsgeuge"><i class="fa fa-check"></i><b>8.7</b> The Queue (SLURM/SGE/UGE)</a></li>
<li class="chapter" data-level="8.8" data-path="chap-HPCC.html"><a href="chap-HPCC.html#modules-package"><i class="fa fa-check"></i><b>8.8</b> Modules package</a></li>
<li class="chapter" data-level="8.9" data-path="chap-HPCC.html"><a href="chap-HPCC.html#compiling-programs-without-admin-privileges"><i class="fa fa-check"></i><b>8.9</b> Compiling programs without admin privileges</a></li>
<li class="chapter" data-level="8.10" data-path="chap-HPCC.html"><a href="chap-HPCC.html#job-arrays"><i class="fa fa-check"></i><b>8.10</b> Job arrays</a></li>
<li class="chapter" data-level="8.11" data-path="chap-HPCC.html"><a href="chap-HPCC.html#writing-stdout-and-stderr-to-files"><i class="fa fa-check"></i><b>8.11</b> Writing stdout and stderr to files</a></li>
<li class="chapter" data-level="8.12" data-path="chap-HPCC.html"><a href="chap-HPCC.html#breaking-stuff-down"><i class="fa fa-check"></i><b>8.12</b> Breaking stuff down</a></li>
</ul></li>
<li class="part"><span><b>II Part II: Reproducible Research Strategies</b></span></li>
<li class="chapter" data-level="9" data-path="introduction-to-reproducible-research.html"><a href="introduction-to-reproducible-research.html"><i class="fa fa-check"></i><b>9</b> Introduction to Reproducible Research</a></li>
<li class="chapter" data-level="10" data-path="rstudio-and-project-centered-organization.html"><a href="rstudio-and-project-centered-organization.html"><i class="fa fa-check"></i><b>10</b> Rstudio and Project-centered Organization</a><ul>
<li class="chapter" data-level="10.1" data-path="rstudio-and-project-centered-organization.html"><a href="rstudio-and-project-centered-organization.html#organizing-big-projects"><i class="fa fa-check"></i><b>10.1</b> Organizing big projects</a></li>
<li class="chapter" data-level="10.2" data-path="rstudio-and-project-centered-organization.html"><a href="rstudio-and-project-centered-organization.html#using-rstudio-in-workflows-with-remote-computers-and-hpccs"><i class="fa fa-check"></i><b>10.2</b> Using RStudio in workflows with remote computers and HPCCs</a><ul>
<li class="chapter" data-level="10.2.1" data-path="rstudio-and-project-centered-organization.html"><a href="rstudio-and-project-centered-organization.html#keeping-an-rstudio-project-in-sync-with-github"><i class="fa fa-check"></i><b>10.2.1</b> Keeping an RStudio project “in sync” with GitHub</a></li>
<li class="chapter" data-level="10.2.2" data-path="rstudio-and-project-centered-organization.html"><a href="rstudio-and-project-centered-organization.html#evaluating-scripts-line-by-line-on-a-remote-machine-from-within-rstudio"><i class="fa fa-check"></i><b>10.2.2</b> Evaluating scripts line by line on a remote machine from within RStudio</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="version-control.html"><a href="version-control.html"><i class="fa fa-check"></i><b>11</b> Version control</a><ul>
<li class="chapter" data-level="11.1" data-path="version-control.html"><a href="version-control.html#why-use-version-control"><i class="fa fa-check"></i><b>11.1</b> Why use version control?</a></li>
<li class="chapter" data-level="11.2" data-path="version-control.html"><a href="version-control.html#git-workings"><i class="fa fa-check"></i><b>11.2</b> How git works</a></li>
<li class="chapter" data-level="11.3" data-path="version-control.html"><a href="version-control.html#git-workflow-patterns"><i class="fa fa-check"></i><b>11.3</b> git workflow patterns</a></li>
<li class="chapter" data-level="11.4" data-path="version-control.html"><a href="version-control.html#using-git-with-rstudio"><i class="fa fa-check"></i><b>11.4</b> using git with Rstudio</a></li>
<li class="chapter" data-level="11.5" data-path="version-control.html"><a href="version-control.html#git-on-the-command-line"><i class="fa fa-check"></i><b>11.5</b> git on the command line</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="a-fast-furious-overview-of-the-tidyverse.html"><a href="a-fast-furious-overview-of-the-tidyverse.html"><i class="fa fa-check"></i><b>12</b> A fast, furious overview of the tidyverse</a></li>
<li class="chapter" data-level="13" data-path="authoring-reproducibly-with-rmarkdown.html"><a href="authoring-reproducibly-with-rmarkdown.html"><i class="fa fa-check"></i><b>13</b> Authoring reproducibly with Rmarkdown</a><ul>
<li class="chapter" data-level="13.1" data-path="authoring-reproducibly-with-rmarkdown.html"><a href="authoring-reproducibly-with-rmarkdown.html#notebooks"><i class="fa fa-check"></i><b>13.1</b> Notebooks</a></li>
<li class="chapter" data-level="13.2" data-path="authoring-reproducibly-with-rmarkdown.html"><a href="authoring-reproducibly-with-rmarkdown.html#references"><i class="fa fa-check"></i><b>13.2</b> References</a><ul>
<li class="chapter" data-level="13.2.1" data-path="authoring-reproducibly-with-rmarkdown.html"><a href="authoring-reproducibly-with-rmarkdown.html#zotero-and-rmarkdown"><i class="fa fa-check"></i><b>13.2.1</b> Zotero and Rmarkdown</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="authoring-reproducibly-with-rmarkdown.html"><a href="authoring-reproducibly-with-rmarkdown.html#bookdown"><i class="fa fa-check"></i><b>13.3</b> Bookdown</a></li>
<li class="chapter" data-level="13.4" data-path="authoring-reproducibly-with-rmarkdown.html"><a href="authoring-reproducibly-with-rmarkdown.html#google-docs"><i class="fa fa-check"></i><b>13.4</b> Google Docs</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="managing-workflows-with-snakemake.html"><a href="managing-workflows-with-snakemake.html"><i class="fa fa-check"></i><b>14</b> Managing Workflows with Snakemake</a><ul>
<li class="chapter" data-level="14.1" data-path="managing-workflows-with-snakemake.html"><a href="managing-workflows-with-snakemake.html#a-simple-snakemake-example"><i class="fa fa-check"></i><b>14.1</b> A Simple Snakemake Example</a><ul>
<li class="chapter" data-level="14.1.1" data-path="managing-workflows-with-snakemake.html"><a href="managing-workflows-with-snakemake.html#snakefile-1-a-simple-rule-to-trimmomcawesome-the-files-from-001"><i class="fa fa-check"></i><b>14.1.1</b> Snakefile #1: A simple rule to TrimmoMcAwesome the files from 001</a></li>
<li class="chapter" data-level="14.1.2" data-path="managing-workflows-with-snakemake.html"><a href="managing-workflows-with-snakemake.html#snakefile-2-a-single-trimmomcawesome-rule-using-wildcards"><i class="fa fa-check"></i><b>14.1.2</b> Snakefile #2: A single TrimmoMcAwesome rule using wildcards</a></li>
<li class="chapter" data-level="14.1.3" data-path="managing-workflows-with-snakemake.html"><a href="managing-workflows-with-snakemake.html#snakefile-3-add-trim_stupendous-in-there"><i class="fa fa-check"></i><b>14.1.3</b> Snakefile #3: Add <code>trim_stupendous</code> in there</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="managing-workflows-with-snakemake.html"><a href="managing-workflows-with-snakemake.html#ugly-complex-file-namesa-job-for-snakemake-input-functions"><i class="fa fa-check"></i><b>14.2</b> Ugly, complex file names…a job for Snakemake input functions!</a><ul>
<li class="chapter" data-level="14.2.1" data-path="managing-workflows-with-snakemake.html"><a href="managing-workflows-with-snakemake.html#playing-with-pandas"><i class="fa fa-check"></i><b>14.2.1</b> Playing with Pandas</a></li>
<li class="chapter" data-level="14.2.2" data-path="managing-workflows-with-snakemake.html"><a href="managing-workflows-with-snakemake.html#a-quick-sidebar-spoofing-a-snakemake-input-function"><i class="fa fa-check"></i><b>14.2.2</b> A Quick Sidebar: Spoofing a Snakemake input function</a></li>
<li class="chapter" data-level="14.2.3" data-path="managing-workflows-with-snakemake.html"><a href="managing-workflows-with-snakemake.html#snakefile-4-an-input-function-for-trim_awesome"><i class="fa fa-check"></i><b>14.2.3</b> Snakefile #4: an input function for trim_awesome</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="managing-workflows-with-snakemake.html"><a href="managing-workflows-with-snakemake.html#input-functions-from-python-dictionaries"><i class="fa fa-check"></i><b>14.3</b> Input functions from Python Dictionaries</a></li>
<li class="chapter" data-level="14.4" data-path="managing-workflows-with-snakemake.html"><a href="managing-workflows-with-snakemake.html#generating-lists-of-files-with-expand"><i class="fa fa-check"></i><b>14.4</b> Generating lists of files with expand()</a></li>
<li class="chapter" data-level="14.5" data-path="managing-workflows-with-snakemake.html"><a href="managing-workflows-with-snakemake.html#a-python-primer-for-using-snakemake"><i class="fa fa-check"></i><b>14.5</b> A Python Primer for Using Snakemake</a></li>
<li class="chapter" data-level="14.6" data-path="managing-workflows-with-snakemake.html"><a href="managing-workflows-with-snakemake.html#using-snakemake-on-a-computing-cluster"><i class="fa fa-check"></i><b>14.6</b> Using Snakemake on a Computing Cluster</a><ul>
<li class="chapter" data-level="14.6.1" data-path="managing-workflows-with-snakemake.html"><a href="managing-workflows-with-snakemake.html#installing-and-configuring-the-snakemake-slurm-profile"><i class="fa fa-check"></i><b>14.6.1</b> Installing and Configuring the Snakemake SLURM profile</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Part III: Bioinformatic Analyses</b></span></li>
<li class="chapter" data-level="15" data-path="overview-of-bioinformatic-analyses.html"><a href="overview-of-bioinformatic-analyses.html"><i class="fa fa-check"></i><b>15</b> Overview of Bioinformatic Analyses</a></li>
<li class="chapter" data-level="16" data-path="dna-sequences-and-sequencing.html"><a href="dna-sequences-and-sequencing.html"><i class="fa fa-check"></i><b>16</b> DNA Sequences and Sequencing</a><ul>
<li class="chapter" data-level="16.1" data-path="dna-sequences-and-sequencing.html"><a href="dna-sequences-and-sequencing.html#dna-stuff"><i class="fa fa-check"></i><b>16.1</b> DNA Stuff</a><ul>
<li class="chapter" data-level="16.1.1" data-path="dna-sequences-and-sequencing.html"><a href="dna-sequences-and-sequencing.html#dna-replication-with-dna-polymerase"><i class="fa fa-check"></i><b>16.1.1</b> DNA Replication with DNA Polymerase</a></li>
<li class="chapter" data-level="16.1.2" data-path="dna-sequences-and-sequencing.html"><a href="dna-sequences-and-sequencing.html#the-importance-of-the-3-hydroxyl"><i class="fa fa-check"></i><b>16.1.2</b> The importance of the 3’ hydroxyl…</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="dna-sequences-and-sequencing.html"><a href="dna-sequences-and-sequencing.html#sanger-sequencing"><i class="fa fa-check"></i><b>16.2</b> Sanger sequencing</a></li>
<li class="chapter" data-level="16.3" data-path="dna-sequences-and-sequencing.html"><a href="dna-sequences-and-sequencing.html#illumina-sequencing-by-synthesis"><i class="fa fa-check"></i><b>16.3</b> Illumina Sequencing by Synthesis</a></li>
<li class="chapter" data-level="16.4" data-path="dna-sequences-and-sequencing.html"><a href="dna-sequences-and-sequencing.html#library-prep-protocols"><i class="fa fa-check"></i><b>16.4</b> Library Prep Protocols</a><ul>
<li class="chapter" data-level="16.4.1" data-path="dna-sequences-and-sequencing.html"><a href="dna-sequences-and-sequencing.html#wgs"><i class="fa fa-check"></i><b>16.4.1</b> WGS</a></li>
<li class="chapter" data-level="16.4.2" data-path="dna-sequences-and-sequencing.html"><a href="dna-sequences-and-sequencing.html#rad-seq-methods"><i class="fa fa-check"></i><b>16.4.2</b> RAD-Seq methods</a></li>
<li class="chapter" data-level="16.4.3" data-path="dna-sequences-and-sequencing.html"><a href="dna-sequences-and-sequencing.html#amplicon-sequencing"><i class="fa fa-check"></i><b>16.4.3</b> Amplicon Sequencing</a></li>
<li class="chapter" data-level="16.4.4" data-path="dna-sequences-and-sequencing.html"><a href="dna-sequences-and-sequencing.html#capture-arrays-rapture-etc."><i class="fa fa-check"></i><b>16.4.4</b> Capture arrays, RAPTURE, etc.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html"><i class="fa fa-check"></i><b>17</b> Bioinformatic file formats</a><ul>
<li class="chapter" data-level="17.1" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#sequences"><i class="fa fa-check"></i><b>17.1</b> Sequences</a></li>
<li class="chapter" data-level="17.2" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#fastq"><i class="fa fa-check"></i><b>17.2</b> FASTQ</a><ul>
<li class="chapter" data-level="17.2.1" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#illumina-ids"><i class="fa fa-check"></i><b>17.2.1</b> Line 1: Illumina identifier lines</a></li>
<li class="chapter" data-level="17.2.2" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#bqscores"><i class="fa fa-check"></i><b>17.2.2</b> Line 4: Base quality scores</a></li>
<li class="chapter" data-level="17.2.3" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#a-fastq-tidyverse-interlude"><i class="fa fa-check"></i><b>17.2.3</b> A FASTQ ‘tidyverse’ Interlude</a></li>
<li class="chapter" data-level="17.2.4" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#comparing-read-1-to-read-2"><i class="fa fa-check"></i><b>17.2.4</b> Comparing read 1 to read 2</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#fasta"><i class="fa fa-check"></i><b>17.3</b> FASTA</a><ul>
<li class="chapter" data-level="17.3.1" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#genomic-ranges"><i class="fa fa-check"></i><b>17.3.1</b> Genomic ranges</a></li>
<li class="chapter" data-level="17.3.2" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#extracting-genomic-ranges-from-a-fasta-file"><i class="fa fa-check"></i><b>17.3.2</b> Extracting genomic ranges from a FASTA file</a></li>
<li class="chapter" data-level="17.3.3" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#downloading-reference-genomes-from-ncbi"><i class="fa fa-check"></i><b>17.3.3</b> Downloading reference genomes from NCBI</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#alignments"><i class="fa fa-check"></i><b>17.4</b> Alignments</a><ul>
<li class="chapter" data-level="17.4.1" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#how-might-i-align-to-thee-let-me-count-the-ways"><i class="fa fa-check"></i><b>17.4.1</b> How might I align to thee? Let me count the ways…</a></li>
<li class="chapter" data-level="17.4.2" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#play-with-simple-alignments"><i class="fa fa-check"></i><b>17.4.2</b> Play with simple alignments</a></li>
<li class="chapter" data-level="17.4.3" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#sam-flags"><i class="fa fa-check"></i><b>17.4.3</b> SAM Flags</a></li>
<li class="chapter" data-level="17.4.4" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#cigar"><i class="fa fa-check"></i><b>17.4.4</b> The CIGAR string</a></li>
<li class="chapter" data-level="17.4.5" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#the-seq-and-qual-columns"><i class="fa fa-check"></i><b>17.4.5</b> The SEQ and QUAL columns</a></li>
<li class="chapter" data-level="17.4.6" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#sam-headers"><i class="fa fa-check"></i><b>17.4.6</b> SAM File Headers</a></li>
<li class="chapter" data-level="17.4.7" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#the-bam-format"><i class="fa fa-check"></i><b>17.4.7</b> The BAM format</a></li>
<li class="chapter" data-level="17.4.8" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#quick-self-study"><i class="fa fa-check"></i><b>17.4.8</b> Quick self study</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#variants"><i class="fa fa-check"></i><b>17.5</b> Variants</a><ul>
<li class="chapter" data-level="17.5.1" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#vcf-format-the-body"><i class="fa fa-check"></i><b>17.5.1</b> VCF Format – The Body</a></li>
<li class="chapter" data-level="17.5.2" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#vcf-format-the-header"><i class="fa fa-check"></i><b>17.5.2</b> VCF Format – The Header</a></li>
<li class="chapter" data-level="17.5.3" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#boneyard"><i class="fa fa-check"></i><b>17.5.3</b> Boneyard</a></li>
</ul></li>
<li class="chapter" data-level="17.6" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#segments"><i class="fa fa-check"></i><b>17.6</b> Segments</a></li>
<li class="chapter" data-level="17.7" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#conversionextractions-between-different-formats"><i class="fa fa-check"></i><b>17.7</b> Conversion/Extractions between different formats</a></li>
<li class="chapter" data-level="17.8" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#visualization-of-genomic-data"><i class="fa fa-check"></i><b>17.8</b> Visualization of Genomic Data</a><ul>
<li class="chapter" data-level="17.8.1" data-path="bioinformatic-file-formats.html"><a href="bioinformatic-file-formats.html#sample-data"><i class="fa fa-check"></i><b>17.8.1</b> Sample Data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="genome-assembly.html"><a href="genome-assembly.html"><i class="fa fa-check"></i><b>18</b> Genome Assembly</a></li>
<li class="chapter" data-level="19" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><i class="fa fa-check"></i><b>19</b> Alignment of sequence data to a reference genome (and associated steps)</a><ul>
<li class="chapter" data-level="19.1" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#the-journey-of-each-dna-fragment-from-organism-to-sequencing-read"><i class="fa fa-check"></i><b>19.1</b> The Journey of each DNA Fragment from Organism to Sequencing Read</a></li>
<li class="chapter" data-level="19.2" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#read-groups"><i class="fa fa-check"></i><b>19.2</b> Read Groups</a></li>
<li class="chapter" data-level="19.3" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#aligning-reads-with-bwa"><i class="fa fa-check"></i><b>19.3</b> Aligning reads with <code>bwa</code></a><ul>
<li class="chapter" data-level="19.3.1" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#indexing-the-genome-for-alignment"><i class="fa fa-check"></i><b>19.3.1</b> Indexing the genome for alignment</a></li>
<li class="chapter" data-level="19.3.2" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#mapping-reads-with-bwa-mem"><i class="fa fa-check"></i><b>19.3.2</b> Mapping reads with <code>bwa mem</code></a></li>
<li class="chapter" data-level="19.3.3" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#hold-it-right-there-buddy-what-about-the-read-groups"><i class="fa fa-check"></i><b>19.3.3</b> Hold it Right There, Buddy! What about the Read Groups?</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#processing-alignment-output-with-samtools"><i class="fa fa-check"></i><b>19.4</b> Processing alignment output with <code>samtools</code></a><ul>
<li class="chapter" data-level="19.4.1" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#samtools-subcommands"><i class="fa fa-check"></i><b>19.4.1</b> <code>samtools</code> subcommands</a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#boneyard-below-here"><i class="fa fa-check"></i><b>19.5</b> BONEYARD BELOW HERE</a></li>
<li class="chapter" data-level="19.6" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#preprocess"><i class="fa fa-check"></i><b>19.6</b> Preprocess ?</a></li>
<li class="chapter" data-level="19.7" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#quick-notes-to-self-on-chaining-things"><i class="fa fa-check"></i><b>19.7</b> Quick notes to self on chaining things:</a></li>
<li class="chapter" data-level="19.8" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#merging-bam-files"><i class="fa fa-check"></i><b>19.8</b> Merging BAM files</a></li>
<li class="chapter" data-level="19.9" data-path="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#divide-and-conquer-strategies"><i class="fa fa-check"></i><b>19.9</b> Divide and Conquer Strategies</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="variant-calling.html"><a href="variant-calling.html"><i class="fa fa-check"></i><b>20</b> Variant calling</a><ul>
<li class="chapter" data-level="20.1" data-path="variant-calling.html"><a href="variant-calling.html#genotype-likelihoods"><i class="fa fa-check"></i><b>20.1</b> Genotype Likelihoods</a><ul>
<li class="chapter" data-level="20.1.1" data-path="variant-calling.html"><a href="variant-calling.html#basic-sketch-of-genotype-likelihood-calculations"><i class="fa fa-check"></i><b>20.1.1</b> Basic Sketch of Genotype Likelihood Calculations</a></li>
<li class="chapter" data-level="20.1.2" data-path="variant-calling.html"><a href="variant-calling.html#specifics-of-different-genotype-likelihoods"><i class="fa fa-check"></i><b>20.1.2</b> Specifics of different genotype likelihoods</a></li>
<li class="chapter" data-level="20.1.3" data-path="variant-calling.html"><a href="variant-calling.html#computing-genotype-likelihoods-with-three-different-softwares"><i class="fa fa-check"></i><b>20.1.3</b> Computing genotype likelihoods with three different softwares</a></li>
<li class="chapter" data-level="20.1.4" data-path="variant-calling.html"><a href="variant-calling.html#a-directed-acyclic-graph-for-genotype-likelihoods"><i class="fa fa-check"></i><b>20.1.4</b> A Directed Acyclic Graph For Genotype Likelihoods</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="21" data-path="boneyard-1.html"><a href="boneyard-1.html"><i class="fa fa-check"></i><b>21</b> Boneyard</a></li>
<li class="chapter" data-level="22" data-path="basic-handling-of-vcf-files.html"><a href="basic-handling-of-vcf-files.html"><i class="fa fa-check"></i><b>22</b> Basic Handling of VCF files</a><ul>
<li class="chapter" data-level="22.1" data-path="basic-handling-of-vcf-files.html"><a href="basic-handling-of-vcf-files.html#bcftools"><i class="fa fa-check"></i><b>22.1</b> bcftools</a><ul>
<li class="chapter" data-level="22.1.1" data-path="basic-handling-of-vcf-files.html"><a href="basic-handling-of-vcf-files.html#tell-me-about-my-vcf-file"><i class="fa fa-check"></i><b>22.1.1</b> Tell me about my VCF file!</a></li>
<li class="chapter" data-level="22.1.2" data-path="basic-handling-of-vcf-files.html"><a href="basic-handling-of-vcf-files.html#get-fragmentsparts-of-my-vcf-file"><i class="fa fa-check"></i><b>22.1.2</b> Get fragments/parts of my VCF file</a></li>
<li class="chapter" data-level="22.1.3" data-path="basic-handling-of-vcf-files.html"><a href="basic-handling-of-vcf-files.html#combine-vcf-files-in-various-ways"><i class="fa fa-check"></i><b>22.1.3</b> Combine VCF files in various ways</a></li>
<li class="chapter" data-level="22.1.4" data-path="basic-handling-of-vcf-files.html"><a href="basic-handling-of-vcf-files.html#filter-out-variants-for-a-variety-of-reasons"><i class="fa fa-check"></i><b>22.1.4</b> Filter out variants for a variety of reasons</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="23" data-path="bioinformatics-for-rad-seq-data-with-and-without-a-reference-genome.html"><a href="bioinformatics-for-rad-seq-data-with-and-without-a-reference-genome.html"><i class="fa fa-check"></i><b>23</b> Bioinformatics for RAD seq data with and without a reference genome</a></li>
<li class="chapter" data-level="24" data-path="processing-amplicon-sequencing-data.html"><a href="processing-amplicon-sequencing-data.html"><i class="fa fa-check"></i><b>24</b> Processing amplicon sequencing data</a></li>
<li class="chapter" data-level="25" data-path="genome-annotation.html"><a href="genome-annotation.html"><i class="fa fa-check"></i><b>25</b> Genome Annotation</a></li>
<li class="chapter" data-level="26" data-path="whole-genome-alignment-strategies.html"><a href="whole-genome-alignment-strategies.html"><i class="fa fa-check"></i><b>26</b> Whole genome alignment strategies</a><ul>
<li class="chapter" data-level="26.1" data-path="whole-genome-alignment-strategies.html"><a href="whole-genome-alignment-strategies.html#mapping-of-scaffolds-to-a-closely-related-genome"><i class="fa fa-check"></i><b>26.1</b> Mapping of scaffolds to a closely related genome</a></li>
<li class="chapter" data-level="26.2" data-path="whole-genome-alignment-strategies.html"><a href="whole-genome-alignment-strategies.html#obtaining-ancestral-states-from-an-outgroup-genome"><i class="fa fa-check"></i><b>26.2</b> Obtaining Ancestral States from an Outgroup Genome</a><ul>
<li class="chapter" data-level="26.2.1" data-path="whole-genome-alignment-strategies.html"><a href="whole-genome-alignment-strategies.html#using-lastz-to-align-coho-to-the-chinook-genome"><i class="fa fa-check"></i><b>26.2.1</b> Using LASTZ to align coho to the chinook genome</a></li>
<li class="chapter" data-level="26.2.2" data-path="whole-genome-alignment-strategies.html"><a href="whole-genome-alignment-strategies.html#try-on-the-chinook-chromosomes"><i class="fa fa-check"></i><b>26.2.2</b> Try on the chinook chromosomes</a></li>
<li class="chapter" data-level="26.2.3" data-path="whole-genome-alignment-strategies.html"><a href="whole-genome-alignment-strategies.html#explore-the-other-parameters-more"><i class="fa fa-check"></i><b>26.2.3</b> Explore the other parameters more</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Part IV: Analysis of Big Variant Data</b></span></li>
<li class="chapter" data-level="27" data-path="bioinformatic-analysis-on-variant-data.html"><a href="bioinformatic-analysis-on-variant-data.html"><i class="fa fa-check"></i><b>27</b> Bioinformatic analysis on variant data</a></li>
<li class="part"><span><b>V Part V: Population Genomics</b></span></li>
<li class="chapter" data-level="28" data-path="topics-in-pop-gen.html"><a href="topics-in-pop-gen.html"><i class="fa fa-check"></i><b>28</b> Topics in pop gen</a><ul>
<li class="chapter" data-level="28.1" data-path="topics-in-pop-gen.html"><a href="topics-in-pop-gen.html#coalescent"><i class="fa fa-check"></i><b>28.1</b> Coalescent</a></li>
<li class="chapter" data-level="28.2" data-path="topics-in-pop-gen.html"><a href="topics-in-pop-gen.html#measures-of-genetic-diversity-and-such"><i class="fa fa-check"></i><b>28.2</b> Measures of genetic diversity and such</a></li>
<li class="chapter" data-level="28.3" data-path="topics-in-pop-gen.html"><a href="topics-in-pop-gen.html#demographic-inference-with-partial-a-partial-i-and-moments"><i class="fa fa-check"></i><b>28.3</b> Demographic inference with <span class="math inline">\(\partial a \partial i\)</span> and <em>moments</em></a></li>
<li class="chapter" data-level="28.4" data-path="topics-in-pop-gen.html"><a href="topics-in-pop-gen.html#balls-in-boxes"><i class="fa fa-check"></i><b>28.4</b> Balls in Boxes</a></li>
<li class="chapter" data-level="28.5" data-path="topics-in-pop-gen.html"><a href="topics-in-pop-gen.html#some-landscape-genetics"><i class="fa fa-check"></i><b>28.5</b> Some landscape genetics</a></li>
<li class="chapter" data-level="28.6" data-path="topics-in-pop-gen.html"><a href="topics-in-pop-gen.html#relationship-inference"><i class="fa fa-check"></i><b>28.6</b> Relationship Inference</a></li>
<li class="chapter" data-level="28.7" data-path="topics-in-pop-gen.html"><a href="topics-in-pop-gen.html#tests-for-selection"><i class="fa fa-check"></i><b>28.7</b> Tests for Selection</a></li>
<li class="chapter" data-level="28.8" data-path="topics-in-pop-gen.html"><a href="topics-in-pop-gen.html#multivariate-associations-gea-etc."><i class="fa fa-check"></i><b>28.8</b> Multivariate Associations, GEA, etc.</a></li>
<li class="chapter" data-level="28.9" data-path="topics-in-pop-gen.html"><a href="topics-in-pop-gen.html#estimating-heritability-in-the-wild"><i class="fa fa-check"></i><b>28.9</b> Estimating heritability in the wild</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-1.html"><a href="references-1.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Practical Computing and Bioinformatics for Conservation and Evolutionary Genomics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps" class="section level1">
<h1><span class="header-section-number">Chapter 19</span> Alignment of sequence data to a reference genome (and associated steps)</h1>
<p>Upon receiving next generation sequencing data (and when already in possession
of a decent reference genome to which you can align those sequences), there are
effectively three main phases of bioinformatic analysis. The first phase (<em>Alignment</em>) involves
<em>aligning</em> or <em>mapping</em> the reads to the reference genome. This tells you which precise
location in the
genome each base pair in each sequencing read comes from. The second phase (<em>Variant Calling</em>)
uses those mapped reads to identify genetic variation—and the genotypes of individuals—at
different locations in the genome. In the final phase (<em>Analysis</em>) you bring the outputs of
the first two phases to bear upon the questions you want to answer about the organism
or system you are studying. The final phase is often the most interesting, and the one that
requires the most understanding of population genetics in order to be conducted well
and correctly. However, the first two phases are essential steps that must be undertaken
to get to the “fun part.”</p>
<p>This chapter describes the tools used, and the steps taken, to produce aligned reads from raw
sequencing data. The computer commands used to simply map
reads to a reference are quite straightforward;
however, right at the beginning of this phase of analysis, it is prudent to attach to each
read some information about the journey that it took to finally arrive in your bioinformatics
workflow. Such extra information about each sequencing read is called <em>read group</em> information.
Read group information is used, for example, to combine all the reads from
a single individual to call genotypes from that individual.
Read group information can
also be used to correct issues that occurred in the library preparation and
the sequencing steps. Though a good understanding and a faithful recording of read group
information is central to principled bioinformatic analysis, any cursory perusal of
bioinformatics help sites like <a href="https://www.biostars.org/">BioStars</a> indicates that
there is sustained and abiding confusion about the role and meaning of read groups.
The first section of this chapter attempts to provide some background that we hope
will alleviate such confusion for you.</p>
<p>Following that section, we cover the workings of <code>bwa</code>, a popular piece of software
for performing alignments. Subsequent sections detail the use of <code>samtools</code>, for
manipulating SAM and BAM files, and show ways to use <code>samtools</code> to prepare
BAM files for variant calling. Finally, we wrap up this chapter with
a description of the program <code>bedtools</code>, and how to use it to investigate the
depth of reads aligning to different portions of the reference genome.</p>
<div id="the-journey-of-each-dna-fragment-from-organism-to-sequencing-read" class="section level2">
<h2><span class="header-section-number">19.1</span> The Journey of each DNA Fragment from Organism to Sequencing Read</h2>
<p>In Section <a href="working-on-remote-servers.html#get-seqs">7.2.5</a> we discussed one solution for downloading gzipped FASTQ
files from a sequencing center. This turns out to be the last step in a very long
process of acquiring sequencing data from a collection of organisms that you
are studying. We could say that the DNA of each organism that you are studying
took an extraordinary journey to get to you. This journey included, 1) you (or a
colleague) sampling tissue or blood from that organism, 2) DNA being extracted from
that tissue or blood, 3) that DNA getting Illumina adapters (with sample-specific
barcodes) attached to it and then getting
PCR amplified some number of times in the <em>library preparation stage</em>, 4) the
products of the library preparations are sequenced, sometimes on multiple flow
cells and often across multiple lanes, during the <em>sequencing stage</em>, 5) the
sequencer processes the read data into FASTQ files, 6) finally, you download the
data.</p>
<p>Anyone who has ever been involved in research knows that at every stage
of the above process there are opportunities for errors or biases to occur
that could affect the final data (and inferences) produced. The effects of some
of the errors and biases that occur during the library prep stage and the
sequencing stage can be eliminated or lessened. Doing so requires that
we keep careful track of the route that each read took during those
those steps in its journey. This is the role of read groups, which
we discuss below.
For now, however, we will offer that the main errors/effects that can
be controlled for by careful accounting of reads into read groups are:
1) controlling for effects on the reported
base quality scores of the particular flowcell
or the particular lane on a flowcell that a read was sequenced on;
2) The identification of sequencing reads which are PCR duplicates of another
read in the data set. Thus,
most of the focus on defining read groups is concerned with identifying
features of a read’s journey that can be used to ameliorate those two
types of errors/biases.</p>
<p>The process of controlling for batch effects of flowcells and lanes on base quality scores
is called, unsurprisingly, Base Quality Score recalibration. This might be discussed
in a later section. It is a very important process when one is searching for <em>de novo</em>
mutations, or otherwise attempting to very accurately identify variants that occur
at very low frequency. Doing base quality score recalibration is considered a “best practice”
when using GATK (Section XX), but I have my doubts as to whether it will make appreciable differences
in analyses where the importance of rare variants is downweighted. Nonetheless, whether
you are going to do base quality score recalibration or not, you should certainly prepare
your data so that you can do it should you decide to. In order to do it, you must know
which flowcell and upon which lane each read was sequenced. That information can be found in the
FASTQ file as part of the name for each sequence, however, methods for doing base quality score
recalibration do not typically use the names of the reads to access that information. Rather it
must be stored in the read group information.</p>
<p>A PCR duplicate is a template sequence that happens to be a copy (made by PCR)
of another sequence that has also been sequenced. They are considered “errors”
in bioinformatics, because many of the models for inferring genotypes from
next generation sequencing data assume a process of independent sampling of gene
copies (i.e. the maternal and paternal copies of a choromosome) within a diploid
individual, and that model and the data are used to estimate how likely an individual
is a homozygote versus a heterozygote at each position. For example, if Individual X
produces one read covering position Y—a position known to be a variable SNP
with alleles <code>A</code> and <code>G</code> in the species—and the read carries an <code>A</code> at position Y,
then you would conclude that Individual X likely has genotype <code>AA</code> or <code>AG</code> at position
Y, and is less likely to have genotype <code>GG</code>, because our observed read with an <code>A</code> at that
position would have only occurred because of a sequencing error in that case.
If we saw 10 reads from individual X, and they all had the <code>A</code> base at position Y, however,
we could be quite confident that the genotype is <code>AA</code> rather than <code>AG</code>, because if the indvidual
had genotype <code>AG</code>, then each read should have a 50% chance of carrying an <code>A</code>
and a 50% chance of carrying a <code>G</code>, and it is very unlikely, in that case, that
all 10 would carry the <code>A</code> allele. However, imagine how your conclusions would
change if someone were to tell you that 95% of the reads were PCR duplicates of another one of
the reads. In that case, even if the individual has genotype <code>AG</code>, there is high probability
that only a single, true template carrying an <code>A</code> came from the individual, and the remaining
9 reads that carry an <code>A</code> are just PCR copies of that first original template.</p>
<p>PCR duplicates are copies of the same template fragments. Therefore in paired-end data
if a pair of reads maps to exactly the same location as another pair of reads, it is likely
that one of them is a PCR duplicate of the other.
Figure <a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#fig:pcr-duplicates">19.1</a> provides a simplified schematic (with merely
single-end data) describing a situation with high and
low numbers of PCR duplicates. The PCR duplicate fragments are denoted with gray-colored
flanking sequence. In the figure, note that the length of the fragments gives
information about which fragments are duplicated and which are not—if two fragments of the
same length are identified, then one of them is considered a PCR duplicate. It is worth
noting that it isn’t (to my knowledge) really known which fragment is the
duplicate and which is the “original,” but, in order to correct the situtation, one (or more of them) will be identified
as duplicates, and one of them will be identified as an “original.”</p>
<div class="figure" style="text-align: center"><span id="fig:pcr-duplicates"></span>
<img src="figs/pcr-duplicates.svg" alt="An example of PCR duplicates.  Note that in paired end data, duplicates are identified by the lengths of both reads as well as the insert length.  This figure represents a simplified, toy, situation, showing just single-end data."  />
<p class="caption">
FIGURE 19.1: An example of PCR duplicates. Note that in paired end data, duplicates are identified by the lengths of both reads as well as the insert length. This figure represents a simplified, toy, situation, showing just single-end data.
</p>
</div>
<p>PCR duplicates occur during the library prep stage, and also are only possible for
fragments originating from the same individual sample. In other words, if you found
two different paired-end reads that mapped to the same location in the genome, but they
were from different individuals (i.e. had different sample-specific DNA barcodes),
you would not suspect that they were PCR duplicates.
Likewise, DNA fragments from two different library preps, even if they came from the
same individual—in the case that DNA from that individual had been prepared
in two separate libraries—would not be considered to be PCR duplicates.
(We should pause here to note what is considered a “library prep.” Basically,
if a batch of samples were all processed together in the same day with reagents
from the same kit, that is considered a single “library prep.”)
Accordingly, when keeping track of read groups <em>for the purposes of identifying PCR duplicates</em>,
the most important information is which individuals the DNA came from
and which library preparation it was prepared in.</p>
<p>What we can conclude from this section is that, for downstream analyses,
we need a way to quickly (and efficiently, in terms of data storage space)
identify, for each read the:</p>
<ul>
<li>Sample it originated from</li>
<li>The library in which it was prepared for sequencing.</li>
<li>The flowcell that it was sequenced on.</li>
<li>The lane on that flowcell that it was sequenced on</li>
</ul>
<p>This information can be strored in the alignment file using
read group information as described below.</p>
</div>
<div id="read-groups" class="section level2">
<h2><span class="header-section-number">19.2</span> Read Groups</h2>
<p>We touched briefly on read groups in Section <a href="bioinformatic-file-formats.html#sam-headers">17.4.6</a>, where we
noted that the SAM file header can contain lines like this one:</p>
<pre><code>@RG ID:HTYYCBBXX.1.CH_plate1_A01    SM:CH_plate1_A01    LB:Lib-1    PU:HTYYCBBXX.1.TCAATCCG+TTCGCAGT    PL:ILLUMINA</code></pre>
<p>The purpose of this line is to identify a read group that is named via the <code>ID</code> tag. In the above
case the read group is named <code>HTYYCBBXX.1.CH_plate1_A01</code>. The attributes of this read group are stored
using the remaining tags in the <code>@RG</code> line. Happily, those attributes mirror exactly what we might need to know to
identify PCR duplicates and to perform base quality score recalibration; namely:</p>
<ul>
<li><code>SM</code> : give the name of the sample, <code>CH_plate1_A01</code>, the read is from,</li>
<li><code>LB</code> : gives the name of the library prep, <code>Lib-1</code>, the read is from,</li>
<li><code>PU</code> : gives the name of the flowcell, <code>HTYYCBBXX</code>, and the lane, <code>1</code>, the read is from.</li>
</ul>
<p>It is important to note that this line in the SAM header is just a header line that gives
information about a particular read group that is found in the file. It is not, <em>by itself</em>
giving you information about any particular read found in the alignment file. Read group information
about a particular read in the alignment file is given on the alignment line in a column (way off near the
end of the line typically) tagged with <code>RG:Z</code>. That <code>RG:Z</code> column in an alignment row simply holds the <code>ID</code> of the read group
that the read belongs to. In this way, all the information that applies to the read—i.e., the sample it
came from, (<code>SM</code>), the library prep it was in (<code>LB</code>), and information about the flowcell and lane (<code>PU</code>)—can
be assigned to the read, <em>without writing all of that information on every line in the alignment file</em>.
Accordingly, it should be obvious why the read group IDs must be unique across all the different
read groups (<code>@RG</code> tags) in a SAM/BAM file: the ID is used to identify all the other information
that goes along with that read, and is used to differentiate those different read groups!</p>
<p>You can download the first 100 lines (without the <code>@SQ</code> lines) of a SAM file that has 8 different
read groups in it <a href="https://eriqande.github.io/eca-bioinf-handbook/downloads/CH_plate1_A01_mkdup-100-lines.sam">here</a>.
Let’s do that and have a look at it.</p>
<p>The way that read group information—particularly the platform unit, or <code>PU</code> information—is recorded
is dictated by which software will be used for downstream processing.
We describe the
conventions that are useful for
passing the aligned data to the Genome Analysis Toolkit (GATK), an extensive
and well-supported piece
of software developed by the Broad Institute. Currently, the GATK conventions for
read group tags are these:</p>
<ul>
<li><code>ID</code> : any string that uniquely identifies a read group. The user must make sure that
these uniquely identify the read groups. If you have multiple samples, libraries, flowcells, and
lanes, and easy way to ensure this is to just bung those all together in a format like
<code>{Sample}.{Library}.{Flowcell}.{Lane}</code>, where the parts in curly braces should be replaced by the
actual names of those items. As long as there is a <code>PU</code> field, however, you can make the ID
anything you want, as long as it is unique for each read group.</li>
<li><code>SM</code> : any string (no spaces please!) that serves as an identifier for the individual the sample
was taken from. This is used to assign genotypes to indvididuals, so even if you have different
“samples” from the same individual (i.e. some blood and some tissue, prepped in different libraries;
or an original extraction prepared in an earlier library and a later extraction prepared in a library
for individuals that needed more sequening coverage after an initial sequencing run)
you should still assign them <em>all</em> the same <code>SM</code> tag because they are the same individual, and you will’
want all of the DNA sequences from them to apply to calling genotypes for them.</li>
<li><code>LB</code> : any string which gives the name of the library prep these reads were prepared in. If you prepped
192 individuals in one day, they are all part of the same library.</li>
<li><code>PU</code> : GATK expects this information to be given in a specific format. You can provide it as
<code>{Flowcell}.{Lane}</code> (for example, <code>HTYYCBBXX.1</code>), but with later versions of the base quality score
recalibration methods in GATK, it appears that it might be useful to also add information about
the particular individual/library the read came from. It is suggested that this be done by
including the barcode of reads, as <code>{Flowcell}.{Lane}.{Barcode}</code>, like
<code>HTYYCBBXX.1.TCAATCCG+TTCGCAGT</code>.</li>
<li><code>PL</code> : It is also important for base calibration to indicate what type of sequencer was used.
Most of the time, currently, that will be <code>ILLUMINA</code>.</li>
</ul>
<p>Usually, when you get data back from the sequencing center, it will be in a series
of different FASTQ files, each one containing reads from a single DNA sample well (on a plate
that you sent to them), that was sequenced on a certain lane on a given flow cell. The files
will often be named something like: <code>DPCh_plate1_C07_S31_L7_R2.fq.gz</code> where the first part
gives a sample identifier, the part after the <code>L</code> gives the lane, and the part after the
<code>R</code> tells whether the file holds read 1 or read 2 of paired end reads. You can get the flowcell
name by looking at the sequence names inside the file (See Section <a href="bioinformatic-file-formats.html#illumina-ids">17.2.1</a>). You
will map the reads in each file separately, and when you do so, you will attach the read group
information to them (see below). Accordingly, it is a great idea to maintain a spreadsheet
that links the different files to the attributes and the read group information of the reads inside
them, like this:</p>
<pre><code>index   file_prefix ID  PU  SM  PL  LB  Flowcell    Lane
1   DPCh_plate1_A01_S1_L1_R HTYYCBBXX.1.CH_plate1_A01   HTYYCBBXX.1.TCAATCCG+TTCGCAGT   CH_plate1_A01   ILLUMINA    Lib-1   HTYYCBBXX   1
2   DPCh_plate1_A01_S1_L2_R HTYYCBBXX.2.CH_plate1_A01   HTYYCBBXX.2.TCAATCCG+TTCGCAGT   CH_plate1_A01   ILLUMINA    Lib-1   HTYYCBBXX   2
3   DPCh_plate1_A01_S1_L3_R HTYYCBBXX.3.CH_plate1_A01   HTYYCBBXX.3.TCAATCCG+TTCGCAGT   CH_plate1_A01   ILLUMINA    Lib-1   HTYYCBBXX   3
4   DPCh_plate1_A01_S1_L4_R HTYYCBBXX.4.CH_plate1_A01   HTYYCBBXX.4.TCAATCCG+TTCGCAGT   CH_plate1_A01   ILLUMINA    Lib-1   HTYYCBBXX   4
5   DPCh_plate1_A01_S1_L5_R HTYYCBBXX.5.CH_plate1_A01   HTYYCBBXX.5.TCAATCCG+TTCGCAGT   CH_plate1_A01   ILLUMINA    Lib-1   HTYYCBBXX   5
6   DPCh_plate1_A01_S1_L6_R HTYYCBBXX.6.CH_plate1_A01   HTYYCBBXX.6.TCAATCCG+TTCGCAGT   CH_plate1_A01   ILLUMINA    Lib-1   HTYYCBBXX   6
7   DPCh_plate1_A01_S1_L7_R HTYYCBBXX.7.CH_plate1_A01   HTYYCBBXX.7.TCAATCCG+TTCGCAGT   CH_plate1_A01   ILLUMINA    Lib-1   HTYYCBBXX   7
8   DPCh_plate1_A01_S1_L8_R HTYYCBBXX.8.CH_plate1_A01   HTYYCBBXX.8.TCAATCCG+TTCGCAGT   CH_plate1_A01   ILLUMINA    Lib-1   HTYYCBBXX   8
9   DPCh_plate1_A02_S2_L1_R HTYYCBBXX.1.CH_plate1_A02   HTYYCBBXX.1.CGCTACAT+CGAGACTA   CH_plate1_A02   ILLUMINA    Lib-1   HTYYCBBXX   1</code></pre>
<p>In the exercise we will see how to use such a file to assign read groups when mapping.</p>
</div>
<div id="aligning-reads-with-bwa" class="section level2">
<h2><span class="header-section-number">19.3</span> Aligning reads with <code>bwa</code></h2>
<p>There are several programs for aligning reads to a reference genome. We focus on <code>bwa</code> which is
an industry standard aligner written by Heng Li and Richard Durbin <span class="citation">(Li and Durbin <a href="#ref-liFastAccurateShort2009" role="doc-biblioref">2009</a>)</span>. The name
stands for “Burrows-Wheeler Aligner.” We won’t go deeply into the guts of this alignment algorithm, but we
will briefly state that nearly all alignment methods rely on pre-processing the reference genome into a
data-structure (like a suffix tree) that provides an <em>index</em> which makes it fast to find the place in
a genome where a query sequence matches. Such indexes can take up a large amount of computer memory.
The Burrows-Wheeler Transform (BWT) provides a way of decreasing the size of such indexes. The BWT is an
operation that takes a sequence of characters (in this case DNA bases) and re-orders them so that similar
characters tend to appear together in long runs of the same character. Sequences with long runs of
the same character can be easily compressed to take up less space using <em>run length encoding</em>, for example.
(We have already seen an example of run length encoding in the CIGAR string (Section <a href="bioinformatic-file-formats.html#cigar">17.4.4</a>), in which
runs of the same kind of alignment characteristic (Matches, Deletions, etc) where encoded by their type
and the length of the run.) The remarkable thing about the BWT is that it is <em>invertible</em>: if someone gives
you a sequence and says that it is the result of applying the BWT to an original sequence, you can
actually recover the original sequence without any other information! The program <code>bwa</code> uses the BWT to
compress the index used for alignment so that it can easily fit into memory—even for very large genomes—on most any computer system, even a low-powered laptop produced in the last half decade.</p>
<div id="indexing-the-genome-for-alignment" class="section level3">
<h3><span class="header-section-number">19.3.1</span> Indexing the genome for alignment</h3>
<p>As the foregoing discussion suggests, it is necessary to index a genome before aligning to it
with <code>bwa</code>. This is a step that only needs to be done once, since the process creates an index
that is stored on the hard drive alongside the genome. So, after you download a reference genome,
before you can start aligning sequences to it, you must index it using <code>bwa</code>. The syntax for this
is very straightforward:</p>
<div class="sourceCode" id="cb522"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb522-1"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb522-1"></a><span class="ex">bwa</span> index path-to-genome</span></code></pre></div>
<p>For example:</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb523-1"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb523-1"></a><span class="ex">bwa</span> index genome/GCA_002872995.1_Otsh_v1.0_genomic.fna.gz</span></code></pre></div>
<p>The reference genome must be stored as a FASTA file (Section <a href="bioinformatic-file-formats.html#fasta">17.3</a>), which can
be compressed using <code>gzip</code>. (In the above example, the <code>.fna.gz</code> prefix means that the
file is a FASTA file of nucleotides (<code>.fna</code>) and has been gzipped (<code>.gz</code>)).</p>
<p>This process may take several hours, depending upon the size of the reference
genome. When it is complete, several new files with names that are the
orginal reference genome file plus several extensions will have been produced
and saved in the same directory as the reference genome. In the above example,
after indexing, a long listing of the directory with the genome file in it
shows these files:</p>
<pre><code>% ls -hl
total 3.8G
-rw-rw-r-- 1 eanderson eanderson 704M Mar  5 00:08 GCA_002872995.1_Otsh_v1.0_genomic.fna.gz
-rw-rw-r-- 1 eanderson eanderson 4.4M Mar  5 00:47 GCA_002872995.1_Otsh_v1.0_genomic.fna.gz.amb
-rw-rw-r-- 1 eanderson eanderson 2.1M Mar  5 00:47 GCA_002872995.1_Otsh_v1.0_genomic.fna.gz.ann
-rw-rw-r-- 1 eanderson eanderson 2.3G Mar  5 00:47 GCA_002872995.1_Otsh_v1.0_genomic.fna.gz.bwt
-rw-rw-r-- 1 eanderson eanderson 579M Mar  5 00:47 GCA_002872995.1_Otsh_v1.0_genomic.fna.gz.pac
-rw-rw-r-- 1 eanderson eanderson 1.2G Mar  5 00:58 GCA_002872995.1_Otsh_v1.0_genomic.fna.gz.sa</code></pre>
<p>The first file is the original gzipped compressed reference genome, and the remaining files
are all part of the index. Note that the index files occupy considerably more space than
the original reference file (but not so much as they would if the BWT were not used to
reduce the size of the index).</p>
<p>If you ever wonder whether you have indexed a certain reference genome with <code>bwa</code>, it is
a simple matter to go to the directory holding the reference genome and see what other files
are there. If you find files with the same name, but having the suffixes, <code>.amb</code>, <code>.ann</code>, <code>.bwt</code>, <code>.pac</code>
and <code>.sa</code>, that means that the reference genome <em>has</em> already been indexed.</p>
</div>
<div id="mapping-reads-with-bwa-mem" class="section level3">
<h3><span class="header-section-number">19.3.2</span> Mapping reads with <code>bwa mem</code></h3>
<p>Once the reference genome has been indexed, you are ready to align reads to
it. The program <code>bwa</code> includes several different alignment algorithms. For paired-end Illumina data,
the best available <code>bwa</code> algorithm, today, is the <code>mem</code> algorithm. The syntax is very simple. While there
are many options available to tune the parameters used for alignment, the default values
usually give good performance. Thus, at its
simplest, <code>bwa mem</code> simply takes three file arguments:</p>
<div class="sourceCode" id="cb525"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb525-1"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb525-1"></a><span class="ex">bwa</span> mem   path-to-reference-genome   path-to-read1-fastq-file   path-to-read2-fastq-file</span></code></pre></div>
<p>An example might look like:</p>
<div class="sourceCode" id="cb526"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb526-1"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb526-1"></a><span class="ex">bwa</span> mem genome/GCA_002872995.1_Otsh_v1.0_genomic.fna.gz fastqs/DPCh_plate1_A01_S1_L1_R1.fq.gz fastqs/DPCh_plate1_A01_S1_L1_R2.fq.gz</span></code></pre></div>
<p><code>bwa mem</code> prints progress messages to <em>stderr</em> and prints its output in SAM format to <em>stdout</em>. The read alignments
come spewing out in the order they are listed in the FASTQ files, such that each read and its
paired-end mate appear in adjacent rows in the output. It’s all super simple!</p>
</div>
<div id="hold-it-right-there-buddy-what-about-the-read-groups" class="section level3">
<h3><span class="header-section-number">19.3.3</span> Hold it Right There, Buddy! What about the Read Groups?</h3>
<p>Indeed! It is during the mapping with <code>bwa mem</code> that we must include
read group tags for our reads. This is straightforward if the pair of
FASTQ files contains reads that are all from a single read group, we
merely have to give the read group information that we want to see as the
argument to the <code>-R</code> option of <code>bwa mem</code>. This argument must be a single
token on the command line, so, if it does not include spaces or other whitespace
it can be supplied unquoted; however, it is usually safer to quote the argument on
the command line. The tabs that occur between read group tags are given as <code>\t</code>
in the argument to the <code>-R</code> option.</p>
<p>Thus, in the <code>bwa mem</code> documentation, the example invocation of the <code>-R</code> option
shows it single quoted as <code>'@RG\tID:foo\tSM:bar'</code>. In other words, you pass it
the read group header line, complete with the <code>@RG</code> header tag, encoding the tabs
between identifiers with <code>\t</code>. What this example does not make clear is that
you can also use <em>double quotes</em> around that argument. Double quotes, you will recall,
allow variable substitution (Section <a href="shell-programming.html#quotes-and-var-subs">5.3.4</a>) to occur inside them.
So, in your own scripts, especially when cycling over very many different pairs of
FASTQ files, it is extremely useful to be able to define the values of the read group
tags, and then supply them on the command line. Coarsely this would look like:</p>
<div class="sourceCode" id="cb527"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb527-1"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb527-1"></a><span class="va">ID=</span>HTYYCBBXX.1.CH_plate1_A01</span>
<span id="cb527-2"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb527-2"></a><span class="va">SM=</span>CH_plate1_A01</span>
<span id="cb527-3"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb527-3"></a><span class="va">LB=</span>Lib-1</span>
<span id="cb527-4"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb527-4"></a><span class="va">PU=</span>HTYYCBBXX.1.TCAATCCG+TTCGCAGT</span>
<span id="cb527-5"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb527-5"></a><span class="va">PL=</span>ILLUMINA</span>
<span id="cb527-6"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb527-6"></a></span>
<span id="cb527-7"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb527-7"></a><span class="ex">bwa</span> mem -R <span class="st">&quot;@RG\tID:</span><span class="va">$ID</span><span class="st">\tSM:</span><span class="va">$SM</span><span class="st">\tLB:</span><span class="va">$LB</span><span class="st">\tPU:</span><span class="va">$PU</span><span class="st">\tPL:</span><span class="va">$PL</span><span class="st">&quot;</span>  genome.fasta  file_R1.fq file_R2.fq</span></code></pre></div>
<p>However, you would probably want some way of assigning the values of the
shell variables <code>ID</code>, <code>SM</code>, etc., programmatically, perhaps from the spreadsheet
that holds all that information. The exercise this week shows one example of that
using <code>awk</code> and a TAB-delimited spreadsheet.</p>
</div>
</div>
<div id="processing-alignment-output-with-samtools" class="section level2">
<h2><span class="header-section-number">19.4</span> Processing alignment output with <code>samtools</code></h2>
<p>Doing the alignment with <code>bwa mem</code> is only the first step of getting data ready to do
variant calling. Once the SAM format data comes out of <code>bwa mem</code>, a number of things
must happen to it before it can be used for variant calling:</p>
<ol style="list-style-type: decimal">
<li>It must be converted to BAM format (the compressed binary companion format to SAM)</li>
<li>Additional information about mate pairs might need to be attached to sequences</li>
<li>You must sort the BAM files from the original ordering produced by <code>bwa mem</code> into a
<em>coordinate-ordered</em> format, in which the reads are sorted by where they appear within the
reference genome.</li>
<li>If you started with multiple pairs of FASTQ files for a single individual (i.e. from different lanes
or from different sequencing runs or libraries) you might want to merge those all into a single BAM
file.</li>
<li>You might want to mark PCR duplicates as such in the BAM file.</li>
<li>Finally when you have your BAM file all ready for variant calling, you typically
will need to index it for rapid access by the variant caller program.</li>
</ol>
<p>Phew! That is a lot of steps! Fortunately, there is a single “go-to” program (one-stop shopping!)
that can manage all of that for you. It is the program <code>samtools</code>, brought to you by the
same people who developed the SAM/BAM formats <span class="citation">(Li et al. <a href="#ref-liSequenceAlignmentMap2009" role="doc-biblioref">2009</a>)</span> and the <code>bwa</code> aligner
(and <code>bcftools</code> for that matter). If you want to get anywhere in bioinformatics, it is
important to become good friends with <code>samtools</code>.</p>
<p>The program <code>samtools</code> includes a large number of different subcommands.
We will cover just a few of them, here, that are used in our typical paired-end workflow,
and in a somewhat cursory fashion, including only the most commonly used options.
All readers are encouraged to completely read the online <a href="http://www.htslib.org/doc/samtools.html">manual page</a>
for samtools for a complete account of its uses.</p>
<p>In the samtools manual. The usage patterns of the subcommands can broadly be categorized into
two groups:</p>
<ol style="list-style-type: decimal">
<li><p>Subcommands that explicitly require an argument that gives the name of an output file.
These subcommands are usually described like this:</p>
<div class="sourceCode" id="cb528"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb528-1"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb528-1"></a><span class="ex">samtools</span> subcommand [options] out.bam in.bam</span></code></pre></div>
<p>where an output file is explicitly called for. These commands
<em>do not write output to stdout</em>! They must be given an output file name. It is
<em>not possible</em> to pipe output from one of these subcommands to another program or utility.</p></li>
<li><p>Subcommands that don’t explicitly require an argument giving an output file:</p>
<div class="sourceCode" id="cb529"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb529-1"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb529-1"></a><span class="ex">samtools</span> subcommand [options] in.bam</span></code></pre></div>
<p>These subcommands write their output to stdout, and that output can be piped into other programs or can
be redirected into a file (some also provide a <code>-o file</code> option to write output to <code>file</code> rather than
to stdout.)</p></li>
</ol>
<p>In short, if the syntax of the subcommand explicitly calls for an output file on the command line (not as part
of a <code>-o file</code> option), then that subcommand does not write its output to <em>stdout</em> and you can’t pipe it into
the next part of your pipeline.</p>
<p>On the other hand, if you can write output from samtools to <em>stdout</em>, you might be interested in knowing
how you can pipe that into the input for another <code>samtools</code> subcommand. Rejoice! There is a syntactically
economical and lovely way to do that. Any subcommand which expects a single input file will be described
like:</p>
<div class="sourceCode" id="cb530"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb530-1"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb530-1"></a><span class="ex">samtools</span> subcommand [options]  in.bam</span></code></pre></div>
<p>You would typically put the path to the input file in the place of <code>in.bam</code> there.
However, if you put <code>-</code> in place of <code>in.bam</code> then samtools will take input for
<code>in.bam</code> from <em>stdin</em>.</p>
<p>So, for example, you can do something like this:</p>
<div class="sourceCode" id="cb531"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb531-1"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb531-1"></a><span class="ex">bwa</span> mem genome.fna R1.fq R2.fq <span class="kw">|</span></span>
<span id="cb531-2"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb531-2"></a>  <span class="ex">samtools</span> view -b -  <span class="kw">|</span>   <span class="co"># convert the SAM output from bwa mem into BAM format</span></span>
<span id="cb531-3"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb531-3"></a>  <span class="ex">samtools</span> fixmate -m - output_file  <span class="co"># take stdin as the input and write output to output_file</span></span></code></pre></div>
<p>You can download an 11 Mb BAM file to play around with <a href="https://eriqande.github.io/eca-bioinf-handbook/downloads/CH_plate1_A01_mkdup.bam">here</a>.
If you are on your HPCC and want to download it, you can use:</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb532-1"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb532-1"></a><span class="fu">wget</span> https://eriqande.github.io/eca-bioinf-handbook/downloads/CH_plate1_A01_mkdup.bam</span></code></pre></div>
<div id="samtools-subcommands" class="section level3">
<h3><span class="header-section-number">19.4.1</span> <code>samtools</code> subcommands</h3>
<p>We will go through some of the subcommands used in the exercises, in a
more step-by-step fashion, so you can get some experience with them, rather
than just running them as parts of long and complex pipelines.</p>
<p>To follow along, you will need to download (using rclone) a “tarball” and decompress it
into a directory full of a variety of SAM and BAM files.</p>
<p>NOTE! I recommend that you do these exercises connected to your HPCC with Terminal or
iTerm on a Mac, or PuTTy on Windows. The RStudio Terminal is just too slow for streaming
text…</p>
<p>These are the commands
needed to prepare yourself to go through the following in-class exercises. You
should be doing this <em>on a compute node</em>.</p>
<div class="sourceCode" id="cb533"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb533-1"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb533-1"></a></span>
<span id="cb533-2"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb533-2"></a><span class="co"># rclone the file here.  Change the remote name from &quot;gdrive-pers&quot; to whatever</span></span>
<span id="cb533-3"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb533-3"></a><span class="co"># you have named your rclone google drive remote:</span></span>
<span id="cb533-4"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb533-4"></a><span class="ex">rclone</span> copyto -P  --drive-shared-with-me  gdrive-pers:CSU-con-gen-2020/in-class-bam-play-session.tar.gz in-class-bam-play-session.tar.gz</span>
<span id="cb533-5"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb533-5"></a></span>
<span id="cb533-6"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb533-6"></a><span class="co"># extract the contents of the tarball:</span></span>
<span id="cb533-7"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb533-7"></a><span class="fu">gunzip</span> in-class-bam-play-session.tar.gz</span>
<span id="cb533-8"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb533-8"></a><span class="fu">tar</span> -xvf in-class-bam-play-session.tar</span>
<span id="cb533-9"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb533-9"></a></span>
<span id="cb533-10"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb533-10"></a><span class="co"># cd into the directory we will be working in:</span></span>
<span id="cb533-11"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb533-11"></a><span class="bu">cd</span> in-class-bam-play-session</span>
<span id="cb533-12"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb533-12"></a></span>
<span id="cb533-13"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb533-13"></a><span class="co"># make sure you have activated your conda environment that</span></span>
<span id="cb533-14"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb533-14"></a><span class="co"># has samtools</span></span>
<span id="cb533-15"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb533-15"></a><span class="ex">conda</span> activate bioinf</span></code></pre></div>
<div id="samtools-view" class="section level4">
<h4><span class="header-section-number">19.4.1.1</span> <code>samtools view</code></h4>
<p>The <code>view</code> command is a major <code>samtools</code> workhorse.</p>
<p>It is primarily used for viewing BAM files (-h/-H), which, you will recall,
are not otherwise human readable.</p>
<p>View a BAM (or SAM) file like this:</p>
<div class="sourceCode" id="cb534"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb534-1"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb534-1"></a><span class="co"># from a BAM file</span></span>
<span id="cb534-2"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb534-2"></a><span class="ex">samtools</span> view bam-from-sam-from-bwa/DPCh_plate1_A01_S1_L1_R.bam <span class="kw">|</span> <span class="fu">head</span></span>
<span id="cb534-3"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb534-3"></a></span>
<span id="cb534-4"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb534-4"></a><span class="co"># from a SAM file</span></span>
<span id="cb534-5"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb534-5"></a><span class="ex">samtools</span> view sam-from-bwa/DPCh_plate1_A01_S1_L1_R.sam <span class="kw">|</span> <span class="fu">head</span></span></code></pre></div>
<p>That shows the first 10 lines of output.</p>
<p>Note that there is no header in that output. To see the header also, you
use the <code>-h</code> option:</p>
<div class="sourceCode" id="cb535"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb535-1"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb535-1"></a><span class="ex">samtools</span> view -h bam-from-sam-from-bwa/DPCh_plate1_A01_S1_L1_R.bam <span class="kw">|</span> <span class="fu">head</span></span></code></pre></div>
<p>If all you want to print is the SAM header, then use the <code>-H</code> command:</p>
<div class="sourceCode" id="cb536"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb536-1"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb536-1"></a><span class="co"># this is a handy way to get the last N (5 in this case) lines of the</span></span>
<span id="cb536-2"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb536-2"></a><span class="co"># SAM header:</span></span>
<span id="cb536-3"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb536-3"></a><span class="ex">samtools</span> view -H bam-from-sam-from-bwa/DPCh_plate1_A01_S1_L1_R.bam <span class="kw">|</span> <span class="fu">tail</span> -n 5</span></code></pre></div>
<p>Check out that read group line!</p>
<p><code>samtools view</code> is also used for converting from the text-based SAM format
to BAM format. Whenever processing SAM/BAM files, you want it to be in BAM format
(and that is required for some operations) because it is much faster to process
binary BAM files than text-based SAM files. Conversion from SAM to BAB is done with the <code>-b</code> option,
which produces BAM output, or by using the <code>-1</code> option which produces compressed
BAM output using fast compression, or by using the <code>-u</code> option which outputs
uncompressed BAM format. If you are not writing output to the disk, the
<code>-u</code> option is preferred, since it saves the time that would be spent compressing
and then decompressing the data as it gets piped from one <code>samtools</code> command
to the next.</p>
<div class="sourceCode" id="cb537"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb537-1"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb537-1"></a><span class="co"># write SAM output to BAM file</span></span>
<span id="cb537-2"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb537-2"></a><span class="ex">samtools</span> view -1 sam-from-bwa/DPCh_plate1_A01_S1_L1_R.sam  <span class="op">&gt;</span> one.bam</span>
<span id="cb537-3"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb537-3"></a></span>
<span id="cb537-4"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb537-4"></a><span class="co"># write it to a file directly, not through redirection</span></span>
<span id="cb537-5"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb537-5"></a><span class="ex">samtools</span> view -1 -o two.bam sam-from-bwa/DPCh_plate1_A01_S1_L1_R.sam</span>
<span id="cb537-6"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb537-6"></a></span>
<span id="cb537-7"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb537-7"></a><span class="co"># see that those are the same:</span></span>
<span id="cb537-8"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb537-8"></a><span class="ex">shasum</span> two.bam one.bam</span>
<span id="cb537-9"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb537-9"></a></span>
<span id="cb537-10"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb537-10"></a><span class="co"># do the same with -b instead of -1</span></span>
<span id="cb537-11"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb537-11"></a><span class="ex">samtools</span> view -b -o three.bam sam-from-bwa/DPCh_plate1_A01_S1_L1_R.sam</span></code></pre></div>
<p>Finally, if the you have <em>indexed</em> a BAM file, you can use <code>samtools view</code>
to retrieve and print all the reads in that indexed BAM file covering one
or more genomic regions as specified using genomic coordinates:</p>
<div class="sourceCode" id="cb538"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb538-1"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb538-1"></a><span class="ex">samtools</span> view duplicates-marked/DPCh_plate1_A01_mkdup.bam  CM009233.1:11271560-11271570  CM009233.1:1907820-1907830</span></code></pre></div>
</div>
<div id="samtools-fixmate" class="section level4">
<h4><span class="header-section-number">19.4.1.2</span> <code>samtools fixmate</code></h4>
<p>This utility adds information about mates. In our pipeline, it is used
with the <code>-m</code> option to add
a “mate-score” field to each alignment. This is used later by <code>samtools markdup</code>.
Mates must be adjacent to one another in the input BAM. This is how mates are arranged
right after running <code>bwa mem</code>, so it is best to run this right after alignment.</p>
<p>This subcommand does not write to <em>stdout</em>, so output must be written to a file.</p>
<div class="sourceCode" id="cb539"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb539-1"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb539-1"></a><span class="co"># run it on the BAM</span></span>
<span id="cb539-2"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb539-2"></a><span class="ex">samtools</span> fixmate -m bam-from-sam-from-bwa/DPCh_plate1_A01_S1_L1_R.bam  fixed.bam</span>
<span id="cb539-3"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb539-3"></a></span>
<span id="cb539-4"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb539-4"></a><span class="co"># do the same, but take input on stdin from the SAM getting coverted</span></span>
<span id="cb539-5"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb539-5"></a><span class="co"># to BAM. Notice the use of &quot;-&quot; in place of the filename for input from stdin.</span></span>
<span id="cb539-6"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb539-6"></a><span class="ex">samtools</span> view -b sam-from-bwa/DPCh_plate1_A01_S1_L1_R.sam <span class="kw">|</span> <span class="ex">samtools</span> fixmate -m - fixed2.bam</span>
<span id="cb539-7"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb539-7"></a></span>
<span id="cb539-8"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb539-8"></a><span class="co"># note that both give the same result:</span></span>
<span id="cb539-9"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb539-9"></a><span class="ex">shasum</span> fixed*.bam</span>
<span id="cb539-10"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb539-10"></a></span>
<span id="cb539-11"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb539-11"></a><span class="co"># compare the first alignment in the BAMs before and after running fixmate:</span></span>
<span id="cb539-12"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb539-12"></a><span class="ex">samtools</span> view bam-from-sam-from-bwa/DPCh_plate1_A01_S1_L1_R.bam <span class="kw">|</span> <span class="fu">head</span> -n 1</span>
<span id="cb539-13"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb539-13"></a><span class="ex">samtools</span> view fixed.bam <span class="kw">|</span> <span class="fu">head</span> -n 1</span>
<span id="cb539-14"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb539-14"></a></span>
<span id="cb539-15"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb539-15"></a><span class="co"># how do the above two outputs differ?</span></span>
<span id="cb539-16"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb539-16"></a><span class="co"># What new information is in fixed.bam?</span></span></code></pre></div>
</div>
<div id="samtools-sort" class="section level4">
<h4><span class="header-section-number">19.4.1.3</span> <code>samtools sort</code></h4>
<p>This subcommand sorts the alignments in a BAM file in order of their placement
in the reference genome. This must be done for
most downstream operations—especially for merging and for marking duplicates—so
it is something that you will always do to alignments from <code>bwa mem</code> or any
other aligner.</p>
<div class="sourceCode" id="cb540"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb540-1"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb540-1"></a><span class="co"># first note that, when it comes off the seqencer, it is not sorted</span></span>
<span id="cb540-2"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb540-2"></a><span class="ex">samtools</span> view bam-from-sam-from-bwa/DPCh_plate1_A01_S1_L1_R.bam <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $1, $3, $4}&#39;</span> <span class="kw">|</span> <span class="fu">less</span></span>
<span id="cb540-3"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb540-3"></a></span>
<span id="cb540-4"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb540-4"></a><span class="co"># how is it sorted?</span></span>
<span id="cb540-5"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb540-5"></a></span>
<span id="cb540-6"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb540-6"></a><span class="co"># coordinate-sort that file:</span></span>
<span id="cb540-7"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb540-7"></a><span class="ex">samtools</span> sort bam-from-sam-from-bwa/DPCh_plate1_A01_S1_L1_R.bam <span class="op">&gt;</span> sorted1.bam</span>
<span id="cb540-8"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb540-8"></a></span>
<span id="cb540-9"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb540-9"></a><span class="co"># rather than redirecting sort&#39;s stdout to a file you can use the -o option</span></span>
<span id="cb540-10"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb540-10"></a><span class="ex">samtools</span> sort -o sorted2.bam bam-from-sam-from-bwa/DPCh_plate1_A01_S1_L1_R.bam</span>
<span id="cb540-11"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb540-11"></a></span>
<span id="cb540-12"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb540-12"></a><span class="co"># check they are the same with shasum (this is left for you to do)</span></span>
<span id="cb540-13"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb540-13"></a></span>
<span id="cb540-14"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb540-14"></a><span class="co"># now, look at the order of the positions in the sorted file</span></span>
<span id="cb540-15"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb540-15"></a><span class="ex">samtools</span> view sorted1.bam <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{print $3, $4}&#39;</span> <span class="kw">|</span> <span class="fu">less</span></span></code></pre></div>
<p><code>samtools sort</code> produces intermediate files when it is sorting large BAM files.
You will sometimes see them if <code>ls</code>-ing the contents of directories while running
a sort job.
You used to have to be very careful if sorting multiple files at the same time
that those intermediate files didn’t overwrite one another, but that is largely
fixed/taken care of automatically by versions of <code>samtools sort</code> available today.</p>
</div>
<div id="samtools-merge" class="section level4">
<h4><span class="header-section-number">19.4.1.4</span> <code>samtools merge</code></h4>
<p>If you have multiple <em>sorted</em> BAM files that you wish to merge into a single
BAM file, you can use <code>samtools merge</code>. This subcommand opens up connections
to each of the files and steps through each of them, alignment-by-alignment, copying
alignments from each of the original BAMs into the merged BAM file. Thought of this
way, it is clear why the input BAM files must be sorted. The merged BAM in outputted in
sorted order.</p>
<p>There is some arcana with this utility when you have different reference genomes
represented in your different BAMs, and older versions of <code>samtools merge</code> didn’t always
play nicely with mutliple read groups in different files. For the most part, those issues
were resolved in later releases. So, if you have just mapped a bunch of fastqs into BAMs and
have sorted them, <code>samtools merge</code> should work and behave appropriately when merging those files.</p>
<p>Why should you merge file? The reason we do so here is to run <code>samtools markdup</code> on all the
reads that came from one individual in one library prep. Originally we had 8 BAMs per individual
because each individual was sequenced on 8 different lanes. However, PCR duplicates formed during the
library prep could be found on any of those 8 lanes. So, the 8 bams all have to be merged
together into a single BAM to do a proper marking of PCR duplicates.</p>
<p>Back in the “old days” people would sometimes merge all the BAMs from multiple individuals.
This is definitely <em>not</em> recommended today. The resulting files can be huge and difficult to
manage! Furthermore, most variant callers (like GATK) allow you to input long lists of BAM files—one
per individual, for doing variant calling. Some utilities, like ANGSD, even require that input
for variant discovery be done with one individual per BAM. So, you should almost never take
BAM-merging further than merging all the alignments for a sinble individual (i.e., when you are
done you should have one BAM file per
individual.)</p>
<p>The syntax for <code>samtools merge</code> is:</p>
<pre><code>samtools merge [options] output-bam-name.bam  sorted-input-bam-1.bam sorted-input-bam-2.bam ...</code></pre>
<p>In other words, you give it the name of the output file you want it to produce,
followed by all the input file names. If you get the order of the filenames wrong—for
example putting the output file last, then it will usually bark you an error because
you are, in effect, asking it to overwrite an existing input file.</p>
<div class="sourceCode" id="cb542"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb542-1"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb542-1"></a><span class="co"># merge 8 input BAMs into a single BAM</span></span>
<span id="cb542-2"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb542-2"></a><span class="ex">samtools</span> merge merged.bam   8-sorted-bams/*.bam</span>
<span id="cb542-3"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb542-3"></a></span>
<span id="cb542-4"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb542-4"></a><span class="co"># now, look at the read groups in the header of that new, merged file:</span></span>
<span id="cb542-5"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb542-5"></a><span class="ex">samtools</span> view -H merged.bam <span class="kw">|</span> <span class="fu">tail</span> -n 20</span></code></pre></div>
</div>
<div id="samtools-markdup" class="section level4">
<h4><span class="header-section-number">19.4.1.5</span> <code>samtools markdup</code></h4>
<p>Mark PCR (or optical) duplicates. Input must have a mate-score field (obtained
from running <code>samtools fixmate -m</code>). And, it must be coordinate-sorted. <em>And</em> it must
include all the alignments from a single sample from a single library prep.</p>
<div class="sourceCode" id="cb543"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb543-1"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb543-1"></a><span class="co"># mark duplicates in the merged bam</span></span>
<span id="cb543-2"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb543-2"></a><span class="ex">samtools</span> markdup 8-sorted-bams-merged-into-1/DPCh_plate1_A01.bam marked.bam</span></code></pre></div>
<p>How does this file differ now? Well, reads that look like PCR duplicates have
been marked as such by including the bits 0x400 to its SAM Flag. We can verify
that by using the <code>-f</code> option to <code>samtools view</code> to print alignments that have the
0x400 bit set:</p>
<div class="sourceCode" id="cb544"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb544-1"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb544-1"></a><span class="co"># see the reads marked as PCR duplicates:</span></span>
<span id="cb544-2"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb544-2"></a><span class="ex">samtools</span> view -f 0x400 marked.bam <span class="kw">|</span> <span class="fu">less</span></span>
<span id="cb544-3"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb544-3"></a></span>
<span id="cb544-4"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb544-4"></a><span class="co"># note that there are none before marking duplicates</span></span>
<span id="cb544-5"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb544-5"></a><span class="ex">samtools</span> view -f 0x400 8-sorted-bams-merged-into-1/DPCh_plate1_A01.bam</span>
<span id="cb544-6"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb544-6"></a></span>
<span id="cb544-7"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb544-7"></a><span class="co"># (nothing, nada, zip, goose-eggs...)</span></span></code></pre></div>
<p>The file produced here (<code>marked.bam</code>) is ready to go for variant calling, but
you will also want to index it for rapid access to reads aligned to any genomic
regions. Indexing is required for most variant callers.</p>
</div>
<div id="samtools-index" class="section level4">
<h4><span class="header-section-number">19.4.1.6</span> <code>samtools index</code></h4>
<p>Once you have a sorted BAM file that is ready for variant calling, you will want
to <em>index</em> it. This is also necessary for some other operations, like <code>idxstats</code>.
The syntax is simple:</p>
<div class="sourceCode" id="cb545"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb545-1"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb545-1"></a><span class="ex">samtools</span> index duplicates-marked/DPCh_plate1_A01_mkdup.bam</span></code></pre></div>
<p>The index for file <code>FILE.bam</code> is stored alongside the file in
<code>FILE.bam.bai</code>. The <code>bai</code> extension means “bam index.”</p>
<p>Now, your file would be read to go for variant calling!
But there are a few things one might want to do with it to check how well
the mapping went and to learn more about where and how the reads align
to the reference genome.</p>
</div>
<div id="samtools-flagstats" class="section level4">
<h4><span class="header-section-number">19.4.1.7</span> <code>samtools flagstats</code></h4>
<p>Provide summary information about the SAM flags of the alignments.
This is a great utility to assess how many reads mapped, how many didn’t,
and the nature of their mapping (as relayed by their SAM flags).</p>
<div class="sourceCode" id="cb546"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb546-1"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb546-1"></a><span class="co"># SAM flag summary for the final dupe-marked file</span></span>
<span id="cb546-2"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb546-2"></a><span class="ex">samtools</span> flagstat duplicates-marked/DPCh_plate1_A01_mkdup.bam</span>
<span id="cb546-3"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb546-3"></a></span>
<span id="cb546-4"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb546-4"></a><span class="co"># Summary for the merged file before dupe-marking</span></span>
<span id="cb546-5"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb546-5"></a><span class="ex">samtools</span> flagstat  8-sorted-bams-merged-into-1/DPCh_plate1_A01.bam</span>
<span id="cb546-6"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb546-6"></a></span>
<span id="cb546-7"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb546-7"></a><span class="co"># how do those two differ?</span></span></code></pre></div>
</div>
<div id="samtools-idxstats" class="section level4">
<h4><span class="header-section-number">19.4.1.8</span> <code>samtools idxstats</code></h4>
<p>From an indexed BAM file, report how many reads map to each
sequence in the reference genome.</p>
<div class="sourceCode" id="cb547"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb547-1"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb547-1"></a><span class="co"># see how many reads mapped to each of the &quot;named&quot; chromosomes</span></span>
<span id="cb547-2"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb547-2"></a><span class="co"># in the reference genome (those that start with &quot;CM&quot;)</span></span>
<span id="cb547-3"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb547-3"></a><span class="ex">samtools</span> idxstats duplicates-marked/DPCh_plate1_A01_mkdup.bam <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;/^CM/&#39;</span></span></code></pre></div>
<p>The columns that come out of this are:</p>
<ol style="list-style-type: decimal">
<li>Reference sequence name</li>
<li>Length of reference sequence</li>
<li>Number of reads that properly paired-end-map to the reference sequence</li>
<li>Number of reads that align to the reference sequence, but not as part of a properly paired read</li>
</ol>
</div>
<div id="samtools-stats" class="section level4">
<h4><span class="header-section-number">19.4.1.9</span> <code>samtools stats</code></h4>
<p>Comprehensive summaries of features of the alignments.</p>
<div class="sourceCode" id="cb548"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb548-1"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb548-1"></a><span class="co"># check them all out:</span></span>
<span id="cb548-2"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb548-2"></a><span class="ex">samtools</span> stats duplicates-marked/DPCh_plate1_A01_mkdup.bam <span class="kw">|</span> <span class="fu">more</span></span>
<span id="cb548-3"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb548-3"></a></span>
<span id="cb548-4"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb548-4"></a><span class="co"># look at the headers for each of the different sections:</span></span>
<span id="cb548-5"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb548-5"></a><span class="ex">samtools</span> stats duplicates-marked/DPCh_plate1_A01_mkdup.bam <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;/^#/&#39;</span></span></code></pre></div>
<p>Note that, in the headers for each of the different summaries in the output
from <code>samtools stats</code>, instructions are given on how to extract just that
summary. For example,</p>
<div class="sourceCode" id="cb549"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb549-1"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb549-1"></a><span class="co"># extract the Summary Numbers:</span></span>
<span id="cb549-2"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb549-2"></a><span class="ex">samtools</span> stats duplicates-marked/DPCh_plate1_A01_mkdup.bam <span class="kw">|</span> <span class="fu">grep</span> ^SN <span class="kw">|</span> <span class="fu">cut</span> -f 2-</span>
<span id="cb549-3"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb549-3"></a></span>
<span id="cb549-4"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb549-4"></a><span class="co"># extract the distribution of read lengths</span></span>
<span id="cb549-5"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb549-5"></a><span class="ex">samtools</span> stats duplicates-marked/DPCh_plate1_A01_mkdup.bam <span class="kw">|</span> <span class="fu">grep</span> ^RL <span class="kw">|</span> <span class="fu">cut</span> -f 2-</span></code></pre></div>
</div>
</div>
</div>
<div id="boneyard-below-here" class="section level2">
<h2><span class="header-section-number">19.5</span> BONEYARD BELOW HERE</h2>
</div>
<div id="preprocess" class="section level2">
<h2><span class="header-section-number">19.6</span> Preprocess ?</h2>
<p>Will have a bit about sequence pre-processing (with WGS data it already
comes demultiplexed, so maybe we can hold off on this until we get to
RAD data). No, we need to talk about trimming and maybe slicing. Perhaps
put that in a separate chapter of “preliminaries”</p>
</div>
<div id="quick-notes-to-self-on-chaining-things" class="section level2">
<h2><span class="header-section-number">19.7</span> Quick notes to self on chaining things:</h2>
<p>When using samtools markdup you can do like this:</p>
<div class="sourceCode" id="cb550"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb550-1"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb550-1"></a><span class="co"># first step</span></span>
<span id="cb550-2"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb550-2"></a><span class="ex">bwa</span> mem chinook-play/chinook-genome-idx/GCA_002872995.1_Otsh_v1.0_genomic.fna.gz chr32-160-chinook/laned/DPCh_plate1_A01_S1_L1_R1.fq chr32-160-chinook/laned/DPCh_plate1_A01_S1_L1_R2.fq <span class="kw">|</span> <span class="kw">\</span></span>
<span id="cb550-3"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb550-3"></a>    <span class="ex">samtools</span> view -b -1 - <span class="kw">|</span> <span class="kw">\</span></span>
<span id="cb550-4"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb550-4"></a>    <span class="ex">samtools</span> fixmate -m -O BAM - fixed.bam</span>
<span id="cb550-5"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb550-5"></a>    </span>
<span id="cb550-6"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb550-6"></a><span class="co"># unfortunately, fixmate can&#39;t write to stdout.</span></span>
<span id="cb550-7"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb550-7"></a><span class="co"># then, after this, we have to sort it into coordinate order and</span></span>
<span id="cb550-8"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb550-8"></a><span class="co"># markdup them.</span></span>
<span id="cb550-9"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb550-9"></a><span class="ex">samtools</span> sort fixed.bam <span class="kw">|</span> <span class="ex">samtools</span> markdup - marked.bam</span>
<span id="cb550-10"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb550-10"></a></span>
<span id="cb550-11"><a href="alignment-of-sequence-data-to-a-reference-genome-and-associated-steps.html#cb550-11"></a><span class="co"># after that, fixed.bam could get tossed.</span></span></code></pre></div>
</div>
<div id="merging-bam-files" class="section level2">
<h2><span class="header-section-number">19.8</span> Merging BAM files</h2>
<p>There is a lot of discussion on biostars about how samtools does not reconstruct the
<code>@RG</code> dictionary. But I think that this must be a problem with an older version. The
newer version works just fine. That said, Picard’s MergeSamFiles seems to be just about
as fast (in fact, faster. For a comparably sized file it took 25 minutes, and gives informative
output telling you where it is at). And samtools merge is at well over 30 and only about
3/4 of the way through. Ultimately it took 37 minutes. Might have been on a slower machine…</p>
<p>However, if you have sliced your fastqs and mapped each separately, then
samtools let’s you not alter duplicate read group IDs, and so you can merge
those all together faithfully, as I did in the impute project. Cool.</p>
</div>
<div id="divide-and-conquer-strategies" class="section level2">
<h2><span class="header-section-number">19.9</span> Divide and Conquer Strategies</h2>
<p>At the end of each of these chapters, I think I will
have a special section talking about ways that things can be divided
up so that you can do it quickly, or at least, within time limits
on your cluster.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-liFastAccurateShort2009">
<p>Li, Heng, and Richard Durbin. 2009. “Fast and Accurate Short Read Alignment with BurrowsWheeler Transform.” <em>Bioinformatics</em> 25 (14): 1754–60. <a href="https://doi.org/10.1093/bioinformatics/btp324">https://doi.org/10.1093/bioinformatics/btp324</a>.</p>
</div>
<div id="ref-liSequenceAlignmentMap2009">
<p>Li, Heng, Bob Handsaker, Alec Wysoker, Tim Fennell, Jue Ruan, Nils Homer, Gabor Marth, Goncalo Abecasis, and Richard Durbin. 2009. “The Sequence Alignment/Map Format and SAMtools.” <em>Bioinformatics</em> 25 (16): 2078–9. <a href="https://doi.org/10.1093/bioinformatics/btp352">https://doi.org/10.1093/bioinformatics/btp352</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="genome-assembly.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="variant-calling.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/eriqande/eca-bioinf-handbook/edit/master/3.04-sequence-alignment.Rmd",
"text": "Edit"
},
"history": {
"link": "https://github.com/eriqande/eca-bioinf-handbook/commits/master/3.04-sequence-alignment.Rmd",
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["eca-bioinf-handbook.pdf", "eca-bioinf-handbook.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
